[0m12:50:34.824139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7966e618bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7966e5001630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7966e50015d0>]}


============================== 12:50:34.827622 | 64fcd8d6-b76a-4fb3-a870-eec902e4c12a ==============================
[0m12:50:34.827622 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:50:34.828572 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:50:34.840760 [info ] [MainThread]: dbt version: 1.10.3
[0m12:50:34.841461 [info ] [MainThread]: python version: 3.10.12
[0m12:50:34.842053 [info ] [MainThread]: python path: /usr/bin/python3
[0m12:50:34.842727 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m12:50:34.846723 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m12:50:34.847916 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m12:50:34.848573 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m12:50:35.089907 [info ] [MainThread]: Configuration:
[0m12:50:35.090779 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m12:50:35.091363 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:50:35.091934 [info ] [MainThread]: Required dependencies:
[0m12:50:35.092517 [debug] [MainThread]: Executing "git --help"
[0m12:50:35.100094 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:50:35.101491 [debug] [MainThread]: STDERR: "b''"
[0m12:50:35.102511 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:50:35.103844 [info ] [MainThread]: Connection test skipped since no profile was found
[0m12:50:35.105085 [info ] [MainThread]: [31m1 check failed:[0m
[0m12:50:35.106302 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Could not find profile named 'gasag'


[0m12:50:35.108619 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.40248665, "process_in_blocks": "960", "process_kernel_time": 0.14206, "process_mem_max_rss": "102840", "process_out_blocks": "16", "process_user_time": 2.52308}
[0m12:50:35.110342 [debug] [MainThread]: Command `dbt debug` failed at 12:50:35.110067 after 0.40 seconds
[0m12:50:35.111259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7966e618bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7966e6131180>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7966e60d70a0>]}
[0m12:50:35.112358 [debug] [MainThread]: Flushing usage events
[0m12:50:35.753491 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:51:43.496292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7886ebf8be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7886eadfef20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7886eadfef80>]}


============================== 12:51:43.500502 | 91112ca8-44e1-4311-baa2-a4258e9b99c8 ==============================
[0m12:51:43.500502 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:51:43.502223 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:51:43.513122 [info ] [MainThread]: dbt version: 1.10.3
[0m12:51:43.513871 [info ] [MainThread]: python version: 3.10.12
[0m12:51:43.514461 [info ] [MainThread]: python path: /usr/bin/python3
[0m12:51:43.515446 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m12:51:43.520250 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m12:51:43.521065 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m12:51:43.521740 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m12:51:43.769575 [info ] [MainThread]: Configuration:
[0m12:51:43.770306 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m12:51:43.771048 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:51:43.771635 [info ] [MainThread]: Required dependencies:
[0m12:51:43.772224 [debug] [MainThread]: Executing "git --help"
[0m12:51:43.779417 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:51:43.780213 [debug] [MainThread]: STDERR: "b''"
[0m12:51:43.781011 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:51:43.781899 [info ] [MainThread]: Connection test skipped since no profile was found
[0m12:51:43.782871 [info ] [MainThread]: [31m1 check failed:[0m
[0m12:51:43.783479 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Could not find profile named 'gasag'


[0m12:51:43.785073 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.41520903, "process_in_blocks": "0", "process_kernel_time": 0.163874, "process_mem_max_rss": "102800", "process_out_blocks": "16", "process_user_time": 2.587021}
[0m12:51:43.786595 [debug] [MainThread]: Command `dbt debug` failed at 12:51:43.786356 after 0.42 seconds
[0m12:51:43.787306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7886ebf8be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7886eace3eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7886eadfefe0>]}
[0m12:51:43.788040 [debug] [MainThread]: Flushing usage events
[0m12:51:44.530034 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:52:43.139092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77591295be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759117ceec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759117cef20>]}


============================== 12:52:43.144741 | a49980ed-3b8b-41af-93d9-1180f4ce7356 ==============================
[0m12:52:43.144741 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:52:43.146078 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:52:43.157407 [info ] [MainThread]: dbt version: 1.10.3
[0m12:52:43.158239 [info ] [MainThread]: python version: 3.10.12
[0m12:52:43.159097 [info ] [MainThread]: python path: /usr/bin/python3
[0m12:52:43.159868 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m12:52:43.165227 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m12:52:43.166019 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m12:52:43.166663 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m12:52:43.405836 [info ] [MainThread]: Configuration:
[0m12:52:43.406605 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m12:52:43.407225 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:52:43.407881 [info ] [MainThread]: Required dependencies:
[0m12:52:43.408841 [debug] [MainThread]: Executing "git --help"
[0m12:52:43.416933 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:52:43.418464 [debug] [MainThread]: STDERR: "b''"
[0m12:52:43.419465 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:52:43.420489 [info ] [MainThread]: Connection test skipped since no profile was found
[0m12:52:43.421513 [info ] [MainThread]: [31m1 check failed:[0m
[0m12:52:43.422517 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Could not find profile named 'gasag'


[0m12:52:43.424249 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.41427115, "process_in_blocks": "0", "process_kernel_time": 0.146068, "process_mem_max_rss": "102792", "process_out_blocks": "24", "process_user_time": 2.576209}
[0m12:52:43.425120 [debug] [MainThread]: Command `dbt debug` failed at 12:52:43.424975 after 0.42 seconds
[0m12:52:43.426206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77591295be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759128d61d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759121ea830>]}
[0m12:52:43.427514 [debug] [MainThread]: Flushing usage events
[0m12:52:44.048745 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:53:30.892067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750dea473e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750de92e95a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750de92e9540>]}


============================== 12:53:30.895190 | 3bec6b24-5fcc-49c0-a7e6-dbb5ea48922d ==============================
[0m12:53:30.895190 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:53:30.896055 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:53:30.904864 [info ] [MainThread]: dbt version: 1.10.3
[0m12:53:30.905477 [info ] [MainThread]: python version: 3.10.12
[0m12:53:30.906003 [info ] [MainThread]: python path: /usr/bin/python3
[0m12:53:30.906541 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m12:53:30.910234 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m12:53:30.910920 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m12:53:30.911656 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m12:53:31.103638 [info ] [MainThread]: Configuration:
[0m12:53:31.104270 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m12:53:31.104784 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:53:31.105272 [info ] [MainThread]: Required dependencies:
[0m12:53:31.105792 [debug] [MainThread]: Executing "git --help"
[0m12:53:31.111918 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:53:31.112636 [debug] [MainThread]: STDERR: "b''"
[0m12:53:31.113194 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:53:31.113807 [info ] [MainThread]: Connection test skipped since no profile was found
[0m12:53:31.114380 [info ] [MainThread]: [31m1 check failed:[0m
[0m12:53:31.115044 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Could not find profile named 'gasag'


[0m12:53:31.116772 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 0.32195553, "process_in_blocks": "0", "process_kernel_time": 0.151999, "process_mem_max_rss": "103044", "process_out_blocks": "16", "process_user_time": 2.165993}
[0m12:53:31.117733 [debug] [MainThread]: Command `dbt debug` failed at 12:53:31.117580 after 0.32 seconds
[0m12:53:31.118361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750dea473e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750de92e94e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x750dea3f1fc0>]}
[0m12:53:31.119342 [debug] [MainThread]: Flushing usage events
[0m12:53:31.811248 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:54:05.860426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732db74beb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732da599600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732da5995a0>]}


============================== 12:54:05.863984 | 38a0500e-c643-4e33-9b75-dab8deae555f ==============================
[0m12:54:05.863984 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:54:05.864990 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:54:05.875371 [info ] [MainThread]: dbt version: 1.10.3
[0m12:54:05.876135 [info ] [MainThread]: python version: 3.10.12
[0m12:54:05.876788 [info ] [MainThread]: python path: /usr/bin/python3
[0m12:54:05.877415 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m12:54:08.466208 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m12:54:08.466928 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m12:54:08.467476 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m12:54:08.468054 [info ] [MainThread]: adapter type: bigquery
[0m12:54:08.468595 [info ] [MainThread]: adapter version: 1.9.2
[0m12:54:08.675188 [info ] [MainThread]: Configuration:
[0m12:54:08.675928 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m12:54:08.676504 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:54:08.677201 [info ] [MainThread]: Required dependencies:
[0m12:54:08.678047 [debug] [MainThread]: Executing "git --help"
[0m12:54:08.685130 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:54:08.686740 [debug] [MainThread]: STDERR: "b''"
[0m12:54:08.687856 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:54:08.689014 [info ] [MainThread]: Connection:
[0m12:54:08.690156 [info ] [MainThread]:   method: oauth
[0m12:54:08.691259 [info ] [MainThread]:   database: gasag-465208
[0m12:54:08.692347 [info ] [MainThread]:   execution_project: gasag-465208
[0m12:54:08.693526 [info ] [MainThread]:   schema: raw
[0m12:54:08.694648 [info ] [MainThread]:   location: EU
[0m12:54:08.695863 [info ] [MainThread]:   priority: None
[0m12:54:08.696967 [info ] [MainThread]:   maximum_bytes_billed: None
[0m12:54:08.698058 [info ] [MainThread]:   impersonate_service_account: None
[0m12:54:08.699118 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m12:54:08.700253 [info ] [MainThread]:   job_retries: 1
[0m12:54:08.701378 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m12:54:08.702496 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m12:54:08.703527 [info ] [MainThread]:   timeout_seconds: None
[0m12:54:08.704696 [info ] [MainThread]:   client_id: None
[0m12:54:08.706152 [info ] [MainThread]:   token_uri: None
[0m12:54:08.707824 [info ] [MainThread]:   compute_region: None
[0m12:54:08.709048 [info ] [MainThread]:   dataproc_cluster_name: None
[0m12:54:08.710233 [info ] [MainThread]:   gcs_bucket: None
[0m12:54:08.711423 [info ] [MainThread]:   dataproc_batch: None
[0m12:54:08.712937 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:54:09.026518 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m12:54:09.027374 [debug] [MainThread]: On debug: select 1 as id
[0m12:54:09.028014 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:54:09.921526 [error] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:969a9cac-cb65-4623-9066-a5ed0ec5eeac&page=queryresults
[0m12:54:09.924164 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m12:54:09.925548 [info ] [MainThread]: [31m1 check failed:[0m
[0m12:54:09.927363 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  Access Denied: Project gasag-465208: User does not have bigquery.jobs.create permission in project gasag-465208.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m12:54:09.931161 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 4.209937, "process_in_blocks": "88", "process_kernel_time": 0.413736, "process_mem_max_rss": "351652", "process_out_blocks": "24", "process_user_time": 5.631804}
[0m12:54:09.932948 [debug] [MainThread]: Command `dbt debug` failed at 12:54:09.932713 after 4.21 seconds
[0m12:54:09.933784 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m12:54:09.935233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732db74beb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732b0a64940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732b0a65960>]}
[0m12:54:09.936133 [debug] [MainThread]: Flushing usage events
[0m12:54:10.512236 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:56:17.760650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b99f8be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b98dfef20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b98dfef80>]}


============================== 12:56:17.765128 | b2d52080-d8eb-46e3-99e1-931a598da332 ==============================
[0m12:56:17.765128 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:56:17.766088 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/anton/.dbt', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:56:17.778054 [info ] [MainThread]: dbt version: 1.10.3
[0m12:56:17.779362 [info ] [MainThread]: python version: 3.10.12
[0m12:56:17.780150 [info ] [MainThread]: python path: /usr/bin/python3
[0m12:56:17.780928 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m12:56:20.832544 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m12:56:20.833287 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m12:56:20.833874 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m12:56:20.834463 [info ] [MainThread]: adapter type: bigquery
[0m12:56:20.835031 [info ] [MainThread]: adapter version: 1.9.2
[0m12:56:21.116920 [info ] [MainThread]: Configuration:
[0m12:56:21.117661 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m12:56:21.118239 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:56:21.118828 [info ] [MainThread]: Required dependencies:
[0m12:56:21.119425 [debug] [MainThread]: Executing "git --help"
[0m12:56:21.127717 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:56:21.128918 [debug] [MainThread]: STDERR: "b''"
[0m12:56:21.129817 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:56:21.130607 [info ] [MainThread]: Connection:
[0m12:56:21.131360 [info ] [MainThread]:   method: oauth
[0m12:56:21.132094 [info ] [MainThread]:   database: gasag-465208
[0m12:56:21.132982 [info ] [MainThread]:   execution_project: gasag-465208
[0m12:56:21.134056 [info ] [MainThread]:   schema: raw
[0m12:56:21.135299 [info ] [MainThread]:   location: EU
[0m12:56:21.136084 [info ] [MainThread]:   priority: None
[0m12:56:21.136808 [info ] [MainThread]:   maximum_bytes_billed: None
[0m12:56:21.137520 [info ] [MainThread]:   impersonate_service_account: None
[0m12:56:21.138345 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m12:56:21.139048 [info ] [MainThread]:   job_retries: 1
[0m12:56:21.139842 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m12:56:21.141263 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m12:56:21.142167 [info ] [MainThread]:   timeout_seconds: None
[0m12:56:21.143284 [info ] [MainThread]:   client_id: None
[0m12:56:21.144567 [info ] [MainThread]:   token_uri: None
[0m12:56:21.145828 [info ] [MainThread]:   compute_region: None
[0m12:56:21.146701 [info ] [MainThread]:   dataproc_cluster_name: None
[0m12:56:21.147544 [info ] [MainThread]:   gcs_bucket: None
[0m12:56:21.148263 [info ] [MainThread]:   dataproc_batch: None
[0m12:56:21.149194 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:56:21.465087 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m12:56:21.465763 [debug] [MainThread]: On debug: select 1 as id
[0m12:56:21.466329 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:56:22.655024 [error] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:d5c4dfc7-c589-41a9-912c-1a027e2982d8&page=queryresults
[0m12:56:22.657860 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m12:56:22.659366 [info ] [MainThread]: [31m1 check failed:[0m
[0m12:56:22.661526 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  Access Denied: Project gasag-465208: User does not have bigquery.jobs.create permission in project gasag-465208.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m12:56:22.664166 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 5.0261393, "process_in_blocks": "0", "process_kernel_time": 0.464854, "process_mem_max_rss": "351536", "process_out_blocks": "32", "process_user_time": 6.577794}
[0m12:56:22.665689 [debug] [MainThread]: Command `dbt debug` failed at 12:56:22.665409 after 5.03 seconds
[0m12:56:22.666645 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m12:56:22.667695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b99f8be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b6f28cf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738b6f240b50>]}
[0m12:56:22.669317 [debug] [MainThread]: Flushing usage events
[0m12:56:23.351599 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:56:52.746863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de441273e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de4400e6ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de4400e6f20>]}


============================== 12:56:52.750873 | d8781f67-c9b9-46fe-8b1f-2650bb7cde7e ==============================
[0m12:56:52.750873 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:56:52.752599 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:56:52.763295 [info ] [MainThread]: dbt version: 1.10.3
[0m12:56:52.764358 [info ] [MainThread]: python version: 3.10.12
[0m12:56:52.765087 [info ] [MainThread]: python path: /usr/bin/python3
[0m12:56:52.765754 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m12:56:55.963074 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m12:56:55.964210 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m12:56:55.964896 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m12:56:55.966172 [info ] [MainThread]: adapter type: bigquery
[0m12:56:55.967298 [info ] [MainThread]: adapter version: 1.9.2
[0m12:56:56.205684 [info ] [MainThread]: Configuration:
[0m12:56:56.206984 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m12:56:56.208106 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:56:56.208722 [info ] [MainThread]: Required dependencies:
[0m12:56:56.209318 [debug] [MainThread]: Executing "git --help"
[0m12:56:56.217363 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:56:56.218238 [debug] [MainThread]: STDERR: "b''"
[0m12:56:56.218841 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:56:56.219499 [info ] [MainThread]: Connection:
[0m12:56:56.220192 [info ] [MainThread]:   method: oauth
[0m12:56:56.220798 [info ] [MainThread]:   database: gasag-465208
[0m12:56:56.221420 [info ] [MainThread]:   execution_project: gasag-465208
[0m12:56:56.222108 [info ] [MainThread]:   schema: raw
[0m12:56:56.222722 [info ] [MainThread]:   location: EU
[0m12:56:56.223298 [info ] [MainThread]:   priority: None
[0m12:56:56.223914 [info ] [MainThread]:   maximum_bytes_billed: None
[0m12:56:56.224595 [info ] [MainThread]:   impersonate_service_account: None
[0m12:56:56.225170 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m12:56:56.225741 [info ] [MainThread]:   job_retries: 1
[0m12:56:56.226297 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m12:56:56.227070 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m12:56:56.227660 [info ] [MainThread]:   timeout_seconds: None
[0m12:56:56.228218 [info ] [MainThread]:   client_id: None
[0m12:56:56.228890 [info ] [MainThread]:   token_uri: None
[0m12:56:56.230115 [info ] [MainThread]:   compute_region: None
[0m12:56:56.230832 [info ] [MainThread]:   dataproc_cluster_name: None
[0m12:56:56.231597 [info ] [MainThread]:   gcs_bucket: None
[0m12:56:56.232728 [info ] [MainThread]:   dataproc_batch: None
[0m12:56:56.234474 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:56:56.530800 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m12:56:56.531502 [debug] [MainThread]: On debug: select 1 as id
[0m12:56:56.533037 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:56:57.535415 [error] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:c803b910-80d3-46a5-9b7a-a62a2ff49c21&page=queryresults
[0m12:56:57.536931 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m12:56:57.537633 [info ] [MainThread]: [31m1 check failed:[0m
[0m12:56:57.538577 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  Access Denied: Project gasag-465208: User does not have bigquery.jobs.create permission in project gasag-465208.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m12:56:57.539961 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 4.9204307, "process_in_blocks": "0", "process_kernel_time": 0.44681, "process_mem_max_rss": "351648", "process_out_blocks": "24", "process_user_time": 6.52762}
[0m12:56:57.540861 [debug] [MainThread]: Command `dbt debug` failed at 12:56:57.540714 after 4.92 seconds
[0m12:56:57.541477 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m12:56:57.542239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de441273e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de41651d960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de416569780>]}
[0m12:56:57.542937 [debug] [MainThread]: Flushing usage events
[0m12:56:58.150826 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:57:34.291922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5262e47eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5261c95600>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5261c955a0>]}


============================== 12:57:34.295260 | f8ec3081-abc0-4bf9-b0cc-0a20e9f47d77 ==============================
[0m12:57:34.295260 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:57:34.296263 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt debug', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:57:34.308513 [info ] [MainThread]: dbt version: 1.10.3
[0m12:57:34.309204 [info ] [MainThread]: python version: 3.10.12
[0m12:57:34.309769 [info ] [MainThread]: python path: /usr/bin/python3
[0m12:57:34.310312 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m12:57:37.435910 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m12:57:37.437394 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m12:57:37.438397 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m12:57:37.439200 [info ] [MainThread]: adapter type: bigquery
[0m12:57:37.439842 [info ] [MainThread]: adapter version: 1.9.2
[0m12:57:37.662713 [info ] [MainThread]: Configuration:
[0m12:57:37.663452 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m12:57:37.664118 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:57:37.664770 [info ] [MainThread]: Required dependencies:
[0m12:57:37.665438 [debug] [MainThread]: Executing "git --help"
[0m12:57:37.673260 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:57:37.674019 [debug] [MainThread]: STDERR: "b''"
[0m12:57:37.674606 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:57:37.675471 [info ] [MainThread]: Connection:
[0m12:57:37.676504 [info ] [MainThread]:   method: oauth
[0m12:57:37.677947 [info ] [MainThread]:   database: gasag-465208
[0m12:57:37.679255 [info ] [MainThread]:   execution_project: gasag-465208
[0m12:57:37.679961 [info ] [MainThread]:   schema: raw
[0m12:57:37.680801 [info ] [MainThread]:   location: EU
[0m12:57:37.681438 [info ] [MainThread]:   priority: None
[0m12:57:37.682278 [info ] [MainThread]:   maximum_bytes_billed: None
[0m12:57:37.683556 [info ] [MainThread]:   impersonate_service_account: None
[0m12:57:37.684293 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m12:57:37.685160 [info ] [MainThread]:   job_retries: 1
[0m12:57:37.686038 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m12:57:37.686979 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m12:57:37.687734 [info ] [MainThread]:   timeout_seconds: None
[0m12:57:37.688516 [info ] [MainThread]:   client_id: None
[0m12:57:37.689136 [info ] [MainThread]:   token_uri: None
[0m12:57:37.689712 [info ] [MainThread]:   compute_region: None
[0m12:57:37.690426 [info ] [MainThread]:   dataproc_cluster_name: None
[0m12:57:37.691248 [info ] [MainThread]:   gcs_bucket: None
[0m12:57:37.691880 [info ] [MainThread]:   dataproc_batch: None
[0m12:57:37.692670 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:57:38.014769 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m12:57:38.015586 [debug] [MainThread]: On debug: select 1 as id
[0m12:57:38.016690 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:57:39.038028 [error] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:ac7ba1e4-31d0-4096-85ab-627d40e03d8f&page=queryresults
[0m12:57:39.041961 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m12:57:39.044393 [info ] [MainThread]: [31m1 check failed:[0m
[0m12:57:39.046837 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  Access Denied: Project gasag-465208: User does not have bigquery.jobs.create permission in project gasag-465208.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m12:57:39.051127 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 4.8844094, "process_in_blocks": "0", "process_kernel_time": 0.490308, "process_mem_max_rss": "351376", "process_out_blocks": "24", "process_user_time": 6.432924}
[0m12:57:39.053428 [debug] [MainThread]: Command `dbt debug` failed at 12:57:39.053051 after 4.89 seconds
[0m12:57:39.055032 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m12:57:39.056131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5262e47eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5238164940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c5238165960>]}
[0m12:57:39.057302 [debug] [MainThread]: Flushing usage events
[0m12:57:39.710720 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:59:39.150245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad6ae473eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad6ad2e2ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad6ad2e2f20>]}


============================== 12:59:39.154343 | 888f5064-b5ef-4558-9fb7-5fdda859ab15 ==============================
[0m12:59:39.154343 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:59:39.155292 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m12:59:39.168091 [info ] [MainThread]: dbt version: 1.10.3
[0m12:59:39.168983 [info ] [MainThread]: python version: 3.10.12
[0m12:59:39.169558 [info ] [MainThread]: python path: /usr/bin/python3
[0m12:59:39.170113 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m12:59:42.158987 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m12:59:42.160002 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m12:59:42.161219 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m12:59:42.162264 [info ] [MainThread]: adapter type: bigquery
[0m12:59:42.163343 [info ] [MainThread]: adapter version: 1.9.2
[0m12:59:42.403683 [info ] [MainThread]: Configuration:
[0m12:59:42.404460 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m12:59:42.405072 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m12:59:42.405652 [info ] [MainThread]: Required dependencies:
[0m12:59:42.406233 [debug] [MainThread]: Executing "git --help"
[0m12:59:42.413782 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m12:59:42.414811 [debug] [MainThread]: STDERR: "b''"
[0m12:59:42.415724 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m12:59:42.416601 [info ] [MainThread]: Connection:
[0m12:59:42.417348 [info ] [MainThread]:   method: oauth
[0m12:59:42.418125 [info ] [MainThread]:   database: gasag-465208
[0m12:59:42.418768 [info ] [MainThread]:   execution_project: gasag-465208
[0m12:59:42.419362 [info ] [MainThread]:   schema: raw
[0m12:59:42.419977 [info ] [MainThread]:   location: EU
[0m12:59:42.420582 [info ] [MainThread]:   priority: None
[0m12:59:42.421226 [info ] [MainThread]:   maximum_bytes_billed: None
[0m12:59:42.422268 [info ] [MainThread]:   impersonate_service_account: None
[0m12:59:42.423462 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m12:59:42.424653 [info ] [MainThread]:   job_retries: 1
[0m12:59:42.425811 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m12:59:42.427359 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m12:59:42.428725 [info ] [MainThread]:   timeout_seconds: None
[0m12:59:42.430049 [info ] [MainThread]:   client_id: None
[0m12:59:42.431357 [info ] [MainThread]:   token_uri: None
[0m12:59:42.432601 [info ] [MainThread]:   compute_region: None
[0m12:59:42.433828 [info ] [MainThread]:   dataproc_cluster_name: None
[0m12:59:42.435116 [info ] [MainThread]:   gcs_bucket: None
[0m12:59:42.436272 [info ] [MainThread]:   dataproc_batch: None
[0m12:59:42.437644 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m12:59:42.839026 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m12:59:42.839738 [debug] [MainThread]: On debug: select 1 as id
[0m12:59:42.840332 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:59:47.459208 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:06a9ee29-a9b8-4d57-93f6-ba4dac3228e5&page=queryresults
[0m12:59:47.926182 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m12:59:47.929787 [info ] [MainThread]: [32mAll checks passed![0m
[0m12:59:47.934892 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 8.907183, "process_in_blocks": "160", "process_kernel_time": 0.476224, "process_mem_max_rss": "355816", "process_out_blocks": "24", "process_user_time": 6.479448}
[0m12:59:47.939058 [debug] [MainThread]: Command `dbt debug` succeeded at 12:59:47.938399 after 8.91 seconds
[0m12:59:47.941326 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m12:59:47.945877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad6ae473eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad68386aaa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ad68386b910>]}
[0m12:59:47.949081 [debug] [MainThread]: Flushing usage events
[0m12:59:48.597793 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:59:58.673628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b389847e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b388696ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b388696f50>]}


============================== 12:59:58.678636 | 9a9c2ca7-5799-4524-89f7-11de997e926b ==============================
[0m12:59:58.678636 [info ] [MainThread]: Running with dbt=1.10.3
[0m12:59:58.679566 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:00:01.957396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a9c2ca7-5799-4524-89f7-11de997e926b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b35ec2c250>]}
[0m13:00:02.094019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9a9c2ca7-5799-4524-89f7-11de997e926b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b388695360>]}
[0m13:00:02.095018 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:00:02.401388 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:00:02.402444 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m13:00:02.403203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9a9c2ca7-5799-4524-89f7-11de997e926b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b35eb7f670>]}
[0m13:00:04.537910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9a9c2ca7-5799-4524-89f7-11de997e926b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b35d382830>]}
[0m13:00:04.666618 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:00:04.668872 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:00:04.691369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9a9c2ca7-5799-4524-89f7-11de997e926b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b35d389f30>]}
[0m13:00:04.692213 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m13:00:04.692860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9a9c2ca7-5799-4524-89f7-11de997e926b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b35e519b70>]}
[0m13:00:04.695188 [info ] [MainThread]: 
[0m13:00:04.695838 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:00:04.696402 [info ] [MainThread]: 
[0m13:00:04.697205 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:00:04.704663 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m13:00:04.705978 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:00:06.377811 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_raw)
[0m13:00:06.379452 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:00:06.917432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9a9c2ca7-5799-4524-89f7-11de997e926b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b35ea0b5e0>]}
[0m13:00:06.920924 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:00:06.934841 [debug] [Thread-1 (]: Began running node model.gasag.last_day_exceptions
[0m13:00:06.937995 [debug] [Thread-2 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m13:00:06.940919 [info ] [Thread-1 (]: 1 of 3 START sql table model raw.last_day_exceptions ........................... [RUN]
[0m13:00:06.944019 [info ] [Thread-2 (]: 2 of 3 START sql table model raw.stg_kraftwerksdaten ........................... [RUN]
[0m13:00:06.946928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_raw, now model.gasag.last_day_exceptions)
[0m13:00:06.949085 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.gasag.stg_kraftwerksdaten'
[0m13:00:06.950663 [debug] [Thread-1 (]: Began compiling node model.gasag.last_day_exceptions
[0m13:00:06.952202 [debug] [Thread-2 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m13:00:06.977085 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.last_day_exceptions"
[0m13:00:06.978799 [debug] [Thread-2 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m13:00:06.980183 [debug] [Thread-2 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m13:00:06.996581 [debug] [Thread-1 (]: Began executing node model.gasag.last_day_exceptions
[0m13:00:07.080934 [debug] [Thread-2 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m13:00:07.079337 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.last_day_exceptions"
[0m13:00:07.082759 [debug] [Thread-2 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`raw`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp) > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(Timestamp)) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
)

SELECT
    Kraftwerk,
    Timestamp,
    Zaehlerstand,
    is_decreasing_zaehlerstand,
    is_last_day,
    leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN leistung IS NOT NULL AND leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load
FROM cleaned_data
WHERE Timestamp > '2024-01-01 00:00:00'
    );
  
[0m13:00:07.083719 [debug] [Thread-1 (]: On model.gasag.last_day_exceptions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.last_day_exceptions"} */

  
    

    create or replace table `gasag-465208`.`raw`.`last_day_exceptions`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        -- Calculate raw Leistung (including negative values)
        Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp) AS raw_leistung
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(Timestamp)) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

last_day_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        raw_leistung,
        -- Flag for peak load (> 50MW)
        CASE
            WHEN raw_leistung > 50 THEN TRUE
            ELSE FALSE
        END AS is_peak_load,
        -- Flag for negative Leistung
        CASE
            WHEN raw_leistung < 0 THEN TRUE
            ELSE FALSE
        END AS is_negative_leistung
    FROM raw_data
    WHERE DATE(Timestamp) = (SELECT last_date FROM max_date)
)

SELECT
    hour_of_day,
    Kraftwerk,
    is_peak_load,
    is_negative_leistung,
    raw_leistung AS leistung
FROM last_day_data
WHERE raw_leistung IS NOT NULL  -- Only show rows with valid Leistung
ORDER BY hour_of_day, Kraftwerk
    );
  
[0m13:00:07.084587 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:00:07.086128 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:00:07.512071 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:8c72f9df-4b42-422e-bf8d-bd2c4daac6ee&page=queryresults
[0m13:00:07.513222 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:8c72f9df-4b42-422e-bf8d-bd2c4daac6ee&page=queryresults
[0m13:00:07.516054 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:af0e2ae4-5200-4ad0-ba6a-fcde58c91b86&page=queryresults
[0m13:00:07.517243 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:af0e2ae4-5200-4ad0-ba6a-fcde58c91b86&page=queryresults
[0m13:00:07.526880 [debug] [Thread-1 (]: Database Error in model last_day_exceptions (models/marts/last_day_exceptions.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/marts/last_day_exceptions.sql
[0m13:00:07.529739 [debug] [Thread-2 (]: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m13:00:07.533229 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a9c2ca7-5799-4524-89f7-11de997e926b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b389939330>]}
[0m13:00:07.534178 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a9c2ca7-5799-4524-89f7-11de997e926b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b35d3cb070>]}
[0m13:00:07.536501 [error] [Thread-1 (]: 1 of 3 ERROR creating sql table model raw.last_day_exceptions .................. [[31mERROR[0m in 0.58s]
[0m13:00:07.538275 [error] [Thread-2 (]: 2 of 3 ERROR creating sql table model raw.stg_kraftwerksdaten .................. [[31mERROR[0m in 0.58s]
[0m13:00:07.540945 [debug] [Thread-1 (]: Finished running node model.gasag.last_day_exceptions
[0m13:00:07.542580 [debug] [Thread-2 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m13:00:07.543873 [debug] [Thread-7 (]: Marking all children of 'model.gasag.last_day_exceptions' to be skipped because of status 'error'.  Reason: Database Error in model last_day_exceptions (models/marts/last_day_exceptions.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/marts/last_day_exceptions.sql.
[0m13:00:07.546457 [debug] [Thread-7 (]: Marking all children of 'model.gasag.stg_kraftwerksdaten' to be skipped because of status 'error'.  Reason: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql.
[0m13:00:07.548051 [debug] [Thread-4 (]: Began running node model.gasag.kraftwerke_metrics
[0m13:00:07.548909 [info ] [Thread-4 (]: 3 of 3 SKIP relation raw.kraftwerke_metrics .................................... [[33mSKIP[0m]
[0m13:00:07.549823 [debug] [Thread-4 (]: Finished running node model.gasag.kraftwerke_metrics
[0m13:00:07.552453 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:00:07.554125 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:00:07.554944 [debug] [MainThread]: Connection 'model.gasag.last_day_exceptions' was properly closed.
[0m13:00:07.555971 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m13:00:07.557662 [info ] [MainThread]: 
[0m13:00:07.558671 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 2.86 seconds (2.86s).
[0m13:00:07.560438 [debug] [MainThread]: Command end result
[0m13:00:07.604010 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:00:07.608384 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:00:07.617901 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m13:00:07.618936 [info ] [MainThread]: 
[0m13:00:07.620198 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m13:00:07.621289 [info ] [MainThread]: 
[0m13:00:07.623571 [error] [MainThread]: [31mFailure in model last_day_exceptions (models/marts/last_day_exceptions.sql)[0m
[0m13:00:07.625215 [error] [MainThread]:   Database Error in model last_day_exceptions (models/marts/last_day_exceptions.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/marts/last_day_exceptions.sql
[0m13:00:07.626358 [info ] [MainThread]: 
[0m13:00:07.627195 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/last_day_exceptions.sql
[0m13:00:07.627926 [info ] [MainThread]: 
[0m13:00:07.628714 [error] [MainThread]: [31mFailure in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)[0m
[0m13:00:07.629435 [error] [MainThread]:   Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m13:00:07.630056 [info ] [MainThread]: 
[0m13:00:07.630756 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/staging/stg_kraftwerksdaten.sql
[0m13:00:07.631743 [info ] [MainThread]: 
[0m13:00:07.632956 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=3
[0m13:00:07.634894 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 9.090583, "process_in_blocks": "168", "process_kernel_time": 0.53189, "process_mem_max_rss": "370364", "process_out_blocks": "3096", "process_user_time": 9.459267}
[0m13:00:07.636751 [debug] [MainThread]: Command `dbt run` failed at 13:00:07.636390 after 9.09 seconds
[0m13:00:07.638187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b389847e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b363aa3c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b3897b5c00>]}
[0m13:00:07.639512 [debug] [MainThread]: Flushing usage events
[0m13:00:08.272588 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:02:29.017195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af9c507fe20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af9c3ef6ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af9c3ef6f20>]}


============================== 13:02:29.020707 | e13f262c-e122-4b36-a07e-3e43c8f05bbd ==============================
[0m13:02:29.020707 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:02:29.021528 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:02:32.282348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e13f262c-e122-4b36-a07e-3e43c8f05bbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af9c6bfb760>]}
[0m13:02:32.417360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e13f262c-e122-4b36-a07e-3e43c8f05bbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af9c3ef5330>]}
[0m13:02:32.418335 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:02:32.738638 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:02:32.932752 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:02:32.933694 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:02:32.996460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e13f262c-e122-4b36-a07e-3e43c8f05bbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af999e406a0>]}
[0m13:02:33.133831 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:02:33.136107 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:02:33.152089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e13f262c-e122-4b36-a07e-3e43c8f05bbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af999fbca00>]}
[0m13:02:33.152898 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m13:02:33.153570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e13f262c-e122-4b36-a07e-3e43c8f05bbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af999ff5d50>]}
[0m13:02:33.156365 [info ] [MainThread]: 
[0m13:02:33.157402 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:02:33.158373 [info ] [MainThread]: 
[0m13:02:33.160615 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:02:33.167714 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m13:02:33.168519 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:02:35.140453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_raw)
[0m13:02:35.144747 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:02:35.778359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e13f262c-e122-4b36-a07e-3e43c8f05bbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af9c6c0d630>]}
[0m13:02:35.781676 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:02:35.793059 [debug] [Thread-1 (]: Began running node model.gasag.last_day_exceptions
[0m13:02:35.795290 [debug] [Thread-2 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m13:02:35.798331 [info ] [Thread-1 (]: 1 of 3 START sql table model raw.last_day_exceptions ........................... [RUN]
[0m13:02:35.800936 [info ] [Thread-2 (]: 2 of 3 START sql table model raw.stg_kraftwerksdaten ........................... [RUN]
[0m13:02:35.802933 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_raw, now model.gasag.last_day_exceptions)
[0m13:02:35.806867 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.gasag.stg_kraftwerksdaten'
[0m13:02:35.808862 [debug] [Thread-1 (]: Began compiling node model.gasag.last_day_exceptions
[0m13:02:35.810123 [debug] [Thread-2 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m13:02:35.826854 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.last_day_exceptions"
[0m13:02:35.835557 [debug] [Thread-2 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m13:02:35.837059 [debug] [Thread-1 (]: Began executing node model.gasag.last_day_exceptions
[0m13:02:35.843318 [debug] [Thread-2 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m13:02:36.070937 [debug] [Thread-2 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m13:02:36.074040 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.last_day_exceptions"
[0m13:02:36.075480 [debug] [Thread-2 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`raw`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp) > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(Timestamp)) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
)

SELECT
    Kraftwerk,
    Timestamp,
    Zaehlerstand,
    is_decreasing_zaehlerstand,
    is_last_day,
    leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN leistung IS NOT NULL AND leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load
FROM cleaned_data
WHERE Timestamp > '2024-01-01 00:00:00'
    );
  
[0m13:02:36.076683 [debug] [Thread-1 (]: On model.gasag.last_day_exceptions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.last_day_exceptions"} */

  
    

    create or replace table `gasag-465208`.`raw`.`last_day_exceptions`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        -- Calculate raw Leistung (including negative values)
        Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp) AS raw_leistung
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(Timestamp)) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

last_day_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        raw_leistung,
        -- Flag for peak load (> 50MW)
        CASE
            WHEN raw_leistung > 50 THEN TRUE
            ELSE FALSE
        END AS is_peak_load,
        -- Flag for negative Leistung
        CASE
            WHEN raw_leistung < 0 THEN TRUE
            ELSE FALSE
        END AS is_negative_leistung
    FROM raw_data
    WHERE DATE(Timestamp) = (SELECT last_date FROM max_date)
)

SELECT
    hour_of_day,
    Kraftwerk,
    is_peak_load,
    is_negative_leistung,
    raw_leistung AS leistung
FROM last_day_data
WHERE raw_leistung IS NOT NULL  -- Only show rows with valid Leistung
ORDER BY hour_of_day, Kraftwerk
    );
  
[0m13:02:36.077587 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:02:36.078451 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:02:36.577922 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:a1d8ae40-a495-4e7b-af68-c3b17883c640&page=queryresults
[0m13:02:36.580582 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:a1d8ae40-a495-4e7b-af68-c3b17883c640&page=queryresults
[0m13:02:36.592955 [debug] [Thread-1 (]: Database Error in model last_day_exceptions (models/marts/last_day_exceptions.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/marts/last_day_exceptions.sql
[0m13:02:36.602545 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e13f262c-e122-4b36-a07e-3e43c8f05bbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af999e74c70>]}
[0m13:02:36.605285 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:99721cae-90b8-4baf-944c-746e96e77f1c&page=queryresults
[0m13:02:36.608706 [error] [Thread-1 (]: 1 of 3 ERROR creating sql table model raw.last_day_exceptions .................. [[31mERROR[0m in 0.79s]
[0m13:02:36.611747 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:EU:99721cae-90b8-4baf-944c-746e96e77f1c&page=queryresults
[0m13:02:36.613319 [debug] [Thread-1 (]: Finished running node model.gasag.last_day_exceptions
[0m13:02:36.616669 [debug] [Thread-7 (]: Marking all children of 'model.gasag.last_day_exceptions' to be skipped because of status 'error'.  Reason: Database Error in model last_day_exceptions (models/marts/last_day_exceptions.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/marts/last_day_exceptions.sql.
[0m13:02:36.619065 [debug] [Thread-2 (]: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m13:02:36.620086 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e13f262c-e122-4b36-a07e-3e43c8f05bbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af99a057c10>]}
[0m13:02:36.621660 [error] [Thread-2 (]: 2 of 3 ERROR creating sql table model raw.stg_kraftwerksdaten .................. [[31mERROR[0m in 0.82s]
[0m13:02:36.622938 [debug] [Thread-2 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m13:02:36.624131 [debug] [Thread-7 (]: Marking all children of 'model.gasag.stg_kraftwerksdaten' to be skipped because of status 'error'.  Reason: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql.
[0m13:02:36.626291 [debug] [Thread-4 (]: Began running node model.gasag.kraftwerke_metrics
[0m13:02:36.627518 [info ] [Thread-4 (]: 3 of 3 SKIP relation raw.kraftwerke_metrics .................................... [[33mSKIP[0m]
[0m13:02:36.628452 [debug] [Thread-4 (]: Finished running node model.gasag.kraftwerke_metrics
[0m13:02:36.630422 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:02:36.632170 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:02:36.633312 [debug] [MainThread]: Connection 'model.gasag.last_day_exceptions' was properly closed.
[0m13:02:36.634488 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m13:02:36.635780 [info ] [MainThread]: 
[0m13:02:36.637061 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 3.48 seconds (3.48s).
[0m13:02:36.639873 [debug] [MainThread]: Command end result
[0m13:02:36.678138 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:02:36.680623 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:02:36.693448 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m13:02:36.694213 [info ] [MainThread]: 
[0m13:02:36.695156 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m13:02:36.696417 [info ] [MainThread]: 
[0m13:02:36.697407 [error] [MainThread]: [31mFailure in model last_day_exceptions (models/marts/last_day_exceptions.sql)[0m
[0m13:02:36.698246 [error] [MainThread]:   Database Error in model last_day_exceptions (models/marts/last_day_exceptions.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/marts/last_day_exceptions.sql
[0m13:02:36.698939 [info ] [MainThread]: 
[0m13:02:36.699658 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/last_day_exceptions.sql
[0m13:02:36.700327 [info ] [MainThread]: 
[0m13:02:36.701670 [error] [MainThread]: [31mFailure in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)[0m
[0m13:02:36.703166 [error] [MainThread]:   Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Not found: Dataset gasag-465208:raw was not found in location EU
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m13:02:36.704321 [info ] [MainThread]: 
[0m13:02:36.705934 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/staging/stg_kraftwerksdaten.sql
[0m13:02:36.707222 [info ] [MainThread]: 
[0m13:02:36.708774 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=3
[0m13:02:36.711091 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.8152246, "process_in_blocks": "0", "process_kernel_time": 0.507207, "process_mem_max_rss": "360908", "process_out_blocks": "2104", "process_user_time": 7.573171}
[0m13:02:36.713007 [debug] [MainThread]: Command `dbt run` failed at 13:02:36.712650 after 7.82 seconds
[0m13:02:36.714466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af9c507fe20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af9c4fd6e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7af999fbe8f0>]}
[0m13:02:36.716372 [debug] [MainThread]: Flushing usage events
[0m13:02:37.431142 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:03:05.553080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76423a187eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764238ffaef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764238ffaf50>]}


============================== 13:03:05.556586 | 7942018a-061a-4215-86f7-5b24f185f6c1 ==============================
[0m13:03:05.556586 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:03:05.557394 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:03:08.880653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7942018a-061a-4215-86f7-5b24f185f6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76423935a7d0>]}
[0m13:03:09.022482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7942018a-061a-4215-86f7-5b24f185f6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764238ff9360>]}
[0m13:03:09.023454 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:03:09.343643 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:03:09.501793 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m13:03:09.502719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7942018a-061a-4215-86f7-5b24f185f6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764239a156f0>]}
[0m13:03:11.666070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7942018a-061a-4215-86f7-5b24f185f6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76420dde4130>]}
[0m13:03:11.790378 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:03:11.792598 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:03:11.814812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7942018a-061a-4215-86f7-5b24f185f6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76420dd0c5e0>]}
[0m13:03:11.816100 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m13:03:11.816778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7942018a-061a-4215-86f7-5b24f185f6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76420dde5660>]}
[0m13:03:11.819138 [info ] [MainThread]: 
[0m13:03:11.819959 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:03:11.820525 [info ] [MainThread]: 
[0m13:03:11.821337 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:03:11.829135 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m13:03:11.830127 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:03:13.500101 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_raw)
[0m13:03:13.502698 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:03:13.947024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7942018a-061a-4215-86f7-5b24f185f6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76420dd333a0>]}
[0m13:03:13.949648 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:03:13.961447 [debug] [Thread-1 (]: Began running node model.gasag.last_day_exceptions
[0m13:03:13.964575 [debug] [Thread-2 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m13:03:13.967964 [info ] [Thread-1 (]: 1 of 3 START sql table model raw.last_day_exceptions ........................... [RUN]
[0m13:03:13.970999 [info ] [Thread-2 (]: 2 of 3 START sql table model raw.stg_kraftwerksdaten ........................... [RUN]
[0m13:03:13.974151 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_raw, now model.gasag.last_day_exceptions)
[0m13:03:13.978272 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.gasag.stg_kraftwerksdaten'
[0m13:03:13.982501 [debug] [Thread-1 (]: Began compiling node model.gasag.last_day_exceptions
[0m13:03:13.986420 [debug] [Thread-2 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m13:03:14.012610 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.last_day_exceptions"
[0m13:03:14.019643 [debug] [Thread-2 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m13:03:14.020981 [debug] [Thread-1 (]: Began executing node model.gasag.last_day_exceptions
[0m13:03:14.027485 [debug] [Thread-2 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m13:03:14.150269 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.last_day_exceptions"
[0m13:03:14.152654 [debug] [Thread-2 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m13:03:14.153678 [debug] [Thread-1 (]: On model.gasag.last_day_exceptions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.last_day_exceptions"} */

  
    

    create or replace table `gasag-465208`.`raw`.`last_day_exceptions`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        -- Calculate raw Leistung (including negative values)
        Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp) AS raw_leistung
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(Timestamp)) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

last_day_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        raw_leistung,
        -- Flag for peak load (> 50MW)
        CASE
            WHEN raw_leistung > 50 THEN TRUE
            ELSE FALSE
        END AS is_peak_load,
        -- Flag for negative Leistung
        CASE
            WHEN raw_leistung < 0 THEN TRUE
            ELSE FALSE
        END AS is_negative_leistung
    FROM raw_data
    WHERE DATE(Timestamp) = (SELECT last_date FROM max_date)
)

SELECT
    hour_of_day,
    Kraftwerk,
    is_peak_load,
    is_negative_leistung,
    raw_leistung AS leistung
FROM last_day_data
WHERE raw_leistung IS NOT NULL  -- Only show rows with valid Leistung
ORDER BY hour_of_day, Kraftwerk
    );
  
[0m13:03:14.154437 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:03:14.155304 [debug] [Thread-2 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`raw`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp) > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(Timestamp)) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
)

SELECT
    Kraftwerk,
    Timestamp,
    Zaehlerstand,
    is_decreasing_zaehlerstand,
    is_last_day,
    leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN leistung IS NOT NULL AND leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load
FROM cleaned_data
WHERE Timestamp > '2024-01-01 00:00:00'
    );
  
[0m13:03:14.157743 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:03:15.775400 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:9263e6ff-9548-4ca7-9e49-bb4d6d15272e&page=queryresults
[0m13:03:15.778053 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:a7be434b-b530-4f9c-965f-e5f75c965934&page=queryresults
[0m13:03:16.041164 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:9263e6ff-9548-4ca7-9e49-bb4d6d15272e&page=queryresults
[0m13:03:16.054744 [debug] [Thread-1 (]: Database Error in model last_day_exceptions (models/marts/last_day_exceptions.sql)
  No matching signature for function EXTRACT for argument types: DATE_TIME_PART FROM STRING
    Signature: EXTRACT(DATE_TIME_PART FROM DATE)
      Argument 1: Unable to coerce type STRING to expected type DATE
    Signature: EXTRACT(DATE_TIME_PART FROM TIMESTAMP [AT TIME ZONE STRING])
      Argument 1: Unable to coerce type STRING to expected type TIMESTAMP
    Signature: EXTRACT(DATE_TIME_PART FROM DATETIME)
      Argument 1: Unable to coerce type STRING to expected type DATETIME
    Signature: EXTRACT(DATE_TIME_PART FROM TIME)
      Argument 1: Unable to coerce type STRING to expected type TIME
    Signature: EXTRACT(DATE_TIME_PART FROM INTERVAL)
      Argument 1: Unable to coerce type STRING to expected type INTERVAL at [32:9]
  compiled code at target/run/gasag/models/marts/last_day_exceptions.sql
[0m13:03:16.062846 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7942018a-061a-4215-86f7-5b24f185f6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76423a33d2a0>]}
[0m13:03:16.066224 [error] [Thread-1 (]: 1 of 3 ERROR creating sql table model raw.last_day_exceptions .................. [[31mERROR[0m in 2.08s]
[0m13:03:16.068791 [debug] [Thread-1 (]: Finished running node model.gasag.last_day_exceptions
[0m13:03:16.070657 [debug] [Thread-7 (]: Marking all children of 'model.gasag.last_day_exceptions' to be skipped because of status 'error'.  Reason: Database Error in model last_day_exceptions (models/marts/last_day_exceptions.sql)
  No matching signature for function EXTRACT for argument types: DATE_TIME_PART FROM STRING
    Signature: EXTRACT(DATE_TIME_PART FROM DATE)
      Argument 1: Unable to coerce type STRING to expected type DATE
    Signature: EXTRACT(DATE_TIME_PART FROM TIMESTAMP [AT TIME ZONE STRING])
      Argument 1: Unable to coerce type STRING to expected type TIMESTAMP
    Signature: EXTRACT(DATE_TIME_PART FROM DATETIME)
      Argument 1: Unable to coerce type STRING to expected type DATETIME
    Signature: EXTRACT(DATE_TIME_PART FROM TIME)
      Argument 1: Unable to coerce type STRING to expected type TIME
    Signature: EXTRACT(DATE_TIME_PART FROM INTERVAL)
      Argument 1: Unable to coerce type STRING to expected type INTERVAL at [32:9]
  compiled code at target/run/gasag/models/marts/last_day_exceptions.sql.
[0m13:03:16.105205 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:a7be434b-b530-4f9c-965f-e5f75c965934&page=queryresults
[0m13:03:16.107734 [debug] [Thread-2 (]: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Invalid timestamp: '01.01.2024 00:00'
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m13:03:16.109642 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7942018a-061a-4215-86f7-5b24f185f6c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76423990d300>]}
[0m13:03:16.111396 [error] [Thread-2 (]: 2 of 3 ERROR creating sql table model raw.stg_kraftwerksdaten .................. [[31mERROR[0m in 2.13s]
[0m13:03:16.113469 [debug] [Thread-2 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m13:03:16.115073 [debug] [Thread-7 (]: Marking all children of 'model.gasag.stg_kraftwerksdaten' to be skipped because of status 'error'.  Reason: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Invalid timestamp: '01.01.2024 00:00'
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql.
[0m13:03:16.116926 [debug] [Thread-4 (]: Began running node model.gasag.kraftwerke_metrics
[0m13:03:16.118715 [info ] [Thread-4 (]: 3 of 3 SKIP relation raw.kraftwerke_metrics .................................... [[33mSKIP[0m]
[0m13:03:16.120414 [debug] [Thread-4 (]: Finished running node model.gasag.kraftwerke_metrics
[0m13:03:16.123090 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:03:16.125116 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:03:16.126841 [debug] [MainThread]: Connection 'model.gasag.last_day_exceptions' was properly closed.
[0m13:03:16.127923 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m13:03:16.129085 [info ] [MainThread]: 
[0m13:03:16.129997 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 4.31 seconds (4.31s).
[0m13:03:16.132137 [debug] [MainThread]: Command end result
[0m13:03:16.172805 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:03:16.175895 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:03:16.187437 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m13:03:16.188123 [info ] [MainThread]: 
[0m13:03:16.188958 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m13:03:16.190195 [info ] [MainThread]: 
[0m13:03:16.191287 [error] [MainThread]: [31mFailure in model last_day_exceptions (models/marts/last_day_exceptions.sql)[0m
[0m13:03:16.193122 [error] [MainThread]:   Database Error in model last_day_exceptions (models/marts/last_day_exceptions.sql)
  No matching signature for function EXTRACT for argument types: DATE_TIME_PART FROM STRING
    Signature: EXTRACT(DATE_TIME_PART FROM DATE)
      Argument 1: Unable to coerce type STRING to expected type DATE
    Signature: EXTRACT(DATE_TIME_PART FROM TIMESTAMP [AT TIME ZONE STRING])
      Argument 1: Unable to coerce type STRING to expected type TIMESTAMP
    Signature: EXTRACT(DATE_TIME_PART FROM DATETIME)
      Argument 1: Unable to coerce type STRING to expected type DATETIME
    Signature: EXTRACT(DATE_TIME_PART FROM TIME)
      Argument 1: Unable to coerce type STRING to expected type TIME
    Signature: EXTRACT(DATE_TIME_PART FROM INTERVAL)
      Argument 1: Unable to coerce type STRING to expected type INTERVAL at [32:9]
  compiled code at target/run/gasag/models/marts/last_day_exceptions.sql
[0m13:03:16.194363 [info ] [MainThread]: 
[0m13:03:16.195516 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/last_day_exceptions.sql
[0m13:03:16.196674 [info ] [MainThread]: 
[0m13:03:16.198025 [error] [MainThread]: [31mFailure in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)[0m
[0m13:03:16.199589 [error] [MainThread]:   Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Invalid timestamp: '01.01.2024 00:00'
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m13:03:16.200923 [info ] [MainThread]: 
[0m13:03:16.202232 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/staging/stg_kraftwerksdaten.sql
[0m13:03:16.202938 [info ] [MainThread]: 
[0m13:03:16.203953 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=3
[0m13:03:16.205484 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 10.7744, "process_in_blocks": "0", "process_kernel_time": 0.505168, "process_mem_max_rss": "373176", "process_out_blocks": "3104", "process_user_time": 9.565257}
[0m13:03:16.206650 [debug] [MainThread]: Command `dbt run` failed at 13:03:16.206432 after 10.78 seconds
[0m13:03:16.207600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76423a187eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76423920cf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76420f0caf80>]}
[0m13:03:16.208385 [debug] [MainThread]: Flushing usage events
[0m13:03:16.889063 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:03:52.229705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65ecc73e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65ebaeaef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65ebaeaf50>]}


============================== 13:03:52.236522 | 3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c ==============================
[0m13:03:52.236522 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:03:52.238150 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:03:55.707792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65c204e5c0>]}
[0m13:03:55.855014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65ebae9360>]}
[0m13:03:55.855999 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:03:56.204067 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:03:56.383358 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m13:03:56.384714 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/last_day_exceptions.sql
[0m13:03:56.385446 [debug] [MainThread]: Partial parsing: updated file: gasag://models/staging/stg_kraftwerksdaten.sql
[0m13:03:56.949119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65c0a451e0>]}
[0m13:03:57.083377 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:03:57.086244 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:03:57.103278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65c0a45030>]}
[0m13:03:57.104116 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m13:03:57.104941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65c1934af0>]}
[0m13:03:57.107170 [info ] [MainThread]: 
[0m13:03:57.107821 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:03:57.108398 [info ] [MainThread]: 
[0m13:03:57.109388 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:03:57.118252 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m13:03:57.119191 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:03:58.719095 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_raw)
[0m13:03:58.720000 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:03:59.180693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65ebca6860>]}
[0m13:03:59.182468 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:03:59.187461 [debug] [Thread-1 (]: Began running node model.gasag.last_day_exceptions
[0m13:03:59.188269 [debug] [Thread-2 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m13:03:59.189255 [info ] [Thread-1 (]: 1 of 3 START sql table model raw.last_day_exceptions ........................... [RUN]
[0m13:03:59.190288 [info ] [Thread-2 (]: 2 of 3 START sql table model raw.stg_kraftwerksdaten ........................... [RUN]
[0m13:03:59.191339 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_raw, now model.gasag.last_day_exceptions)
[0m13:03:59.192570 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.gasag.stg_kraftwerksdaten'
[0m13:03:59.193366 [debug] [Thread-1 (]: Began compiling node model.gasag.last_day_exceptions
[0m13:03:59.194248 [debug] [Thread-2 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m13:03:59.208677 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.last_day_exceptions"
[0m13:03:59.218117 [debug] [Thread-2 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m13:03:59.219958 [debug] [Thread-1 (]: Began executing node model.gasag.last_day_exceptions
[0m13:03:59.220906 [debug] [Thread-2 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m13:03:59.432968 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.last_day_exceptions"
[0m13:03:59.435301 [debug] [Thread-2 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m13:03:59.436757 [debug] [Thread-1 (]: On model.gasag.last_day_exceptions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.last_day_exceptions"} */

  
    

    create or replace table `gasag-465208`.`raw`.`last_day_exceptions`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Calculate raw Leistung (including negative values)
        Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp)) AS raw_leistung
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

last_day_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        raw_leistung,
        -- Flag for peak load (> 50MW)
        CASE
            WHEN raw_leistung > 50 THEN TRUE
            ELSE FALSE
        END AS is_peak_load,
        -- Flag for negative Leistung
        CASE
            WHEN raw_leistung < 0 THEN TRUE
            ELSE FALSE
        END AS is_negative_leistung
    FROM raw_data
    WHERE DATE(Timestamp) = (SELECT last_date FROM max_date)
)

SELECT
    hour_of_day,
    Kraftwerk,
    is_peak_load,
    is_negative_leistung,
    raw_leistung AS leistung
FROM last_day_data
WHERE raw_leistung IS NOT NULL  -- Only show rows with valid Leistung
ORDER BY hour_of_day, Kraftwerk
    );
  
[0m13:03:59.437736 [debug] [Thread-2 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`raw`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
)

SELECT
    Kraftwerk,
    Timestamp,
    Zaehlerstand,
    is_decreasing_zaehlerstand,
    is_last_day,
    leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN leistung IS NOT NULL AND leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load
FROM cleaned_data
WHERE Timestamp > TIMESTAMP('2024-01-01 00:00:00')
    );
  
[0m13:03:59.438649 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:03:59.439412 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:04:00.329096 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:020bfc0c-540c-423a-9ef6-874272c290e8&page=queryresults
[0m13:04:00.338053 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:4082a2a4-f315-4148-94bd-0b13266a9e8a&page=queryresults
[0m13:04:03.218678 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65c6efc340>]}
[0m13:04:03.219829 [info ] [Thread-2 (]: 2 of 3 OK created sql table model raw.stg_kraftwerksdaten ...................... [[32mCREATE TABLE (5.0k rows, 190.4 KiB processed)[0m in 4.02s]
[0m13:04:03.220843 [debug] [Thread-2 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m13:04:03.222003 [debug] [Thread-4 (]: Began running node model.gasag.kraftwerke_metrics
[0m13:04:03.222999 [info ] [Thread-4 (]: 3 of 3 START sql table model raw.kraftwerke_metrics ............................ [RUN]
[0m13:04:03.223976 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.gasag.kraftwerke_metrics'
[0m13:04:03.224644 [debug] [Thread-4 (]: Began compiling node model.gasag.kraftwerke_metrics
[0m13:04:03.232089 [debug] [Thread-4 (]: Writing injected SQL for node "model.gasag.kraftwerke_metrics"
[0m13:04:03.233375 [debug] [Thread-4 (]: Began executing node model.gasag.kraftwerke_metrics
[0m13:04:03.238292 [debug] [Thread-4 (]: Writing runtime sql for node "model.gasag.kraftwerke_metrics"
[0m13:04:03.239898 [debug] [Thread-4 (]: On model.gasag.kraftwerke_metrics: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.kraftwerke_metrics"} */

  
    

    create or replace table `gasag-465208`.`raw`.`kraftwerke_metrics`
      
    
    

    OPTIONS()
    as (
      WITH staging_data AS (
    SELECT * FROM `gasag-465208`.`raw`.`stg_kraftwerksdaten`
),

-- Historical metrics (excluding last day)
historical_metrics AS (
    SELECT
        Kraftwerk,
        -- Durchschnittliche Grundlast (average base load, excluding NULLs)
        AVG(CASE WHEN NOT is_peak_load THEN leistung END) AS durchschnittliche_grundlast,

        -- Durchschnittliche Spitzenlast (average peak load, excluding NULLs)
        AVG(CASE WHEN is_peak_load THEN leistung END) AS durchschnittliche_spitzenlast,

        -- Durchschnittliche Gesamtlast pro Tag (average total load, excluding NULLs)
        AVG(leistung) AS durchschnittliche_gesamtlast_pro_tag,

        -- Quote an Spitzenlasten (percentage of peak loads)
        COUNT(CASE WHEN is_peak_load THEN 1 END) * 100.0 / COUNT(CASE WHEN leistung IS NOT NULL THEN 1 END) AS quote_spitzenlasten_prozent,

        -- Quote an Rückläufigen Zählerständen (percentage of decreasing meter readings)
        COUNT(CASE WHEN is_decreasing_zaehlerstand THEN 1 END) * 100.0 / COUNT(*) AS quote_ruecklaeufige_zaehlerstaende_prozent

    FROM staging_data
    WHERE NOT is_last_day
    GROUP BY Kraftwerk
),

-- Last day metrics
last_day_metrics AS (
    SELECT
        Kraftwerk,
        -- Sum of Leistung for the last day (excluding NULLs)
        SUM(leistung) AS last_day_leistung_sum,
        -- Count of hours with valid data for the last day
        COUNT(CASE WHEN leistung IS NOT NULL THEN 1 END) AS last_day_hours_with_data,
        -- Average Leistung for the last day (excluding NULLs)
        AVG(leistung) AS last_day_durchschnitt_leistung
    FROM staging_data
    WHERE is_last_day
    GROUP BY Kraftwerk
),

-- Expected vs actual comparison for last day
last_day_deviation AS (
    SELECT
        h.Kraftwerk,
        h.durchschnittliche_gesamtlast_pro_tag,
        l.last_day_leistung_sum,
        l.last_day_hours_with_data,
        l.last_day_durchschnitt_leistung,
        -- Expected Leistung (summierte Leistung * 24 / überlieferte Stunden)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN (l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data
            ELSE NULL
        END AS erwartete_leistung,
        -- Tagesabweichung (Expected - Actual average)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN ((l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data) - h.durchschnittliche_gesamtlast_pro_tag
            ELSE NULL
        END AS tagesabweichung
    FROM historical_metrics h
    LEFT JOIN last_day_metrics l ON h.Kraftwerk = l.Kraftwerk
)

SELECT
    h.Kraftwerk,
    h.durchschnittliche_grundlast,
    h.durchschnittliche_spitzenlast,
    h.durchschnittliche_gesamtlast_pro_tag,
    h.quote_spitzenlasten_prozent,
    h.quote_ruecklaeufige_zaehlerstaende_prozent,
    l.erwartete_leistung,
    l.tagesabweichung
FROM historical_metrics h
LEFT JOIN last_day_deviation l ON h.Kraftwerk = l.Kraftwerk
    );
  
[0m13:04:03.241042 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:04:03.785039 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65c0193dc0>]}
[0m13:04:03.789001 [info ] [Thread-1 (]: 1 of 3 OK created sql table model raw.last_day_exceptions ...................... [[32mCREATE TABLE (80.0 rows, 190.4 KiB processed)[0m in 4.59s]
[0m13:04:03.794224 [debug] [Thread-1 (]: Finished running node model.gasag.last_day_exceptions
[0m13:04:04.095406 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:8f0bfc78-a944-4d2c-a902-c30a80eb2244&page=queryresults
[0m13:04:07.303832 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c15c5e8-0a1b-48c1-97ef-8f7fbf713c6c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65c0a7b640>]}
[0m13:04:07.307656 [info ] [Thread-4 (]: 3 of 3 OK created sql table model raw.kraftwerke_metrics ....................... [[32mCREATE TABLE (5.0 rows, 116.6 KiB processed)[0m in 4.08s]
[0m13:04:07.312330 [debug] [Thread-4 (]: Finished running node model.gasag.kraftwerke_metrics
[0m13:04:07.318410 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:04:07.320848 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:04:07.322342 [debug] [MainThread]: Connection 'model.gasag.last_day_exceptions' was properly closed.
[0m13:04:07.323428 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m13:04:07.324421 [debug] [MainThread]: Connection 'model.gasag.kraftwerke_metrics' was properly closed.
[0m13:04:07.325625 [info ] [MainThread]: 
[0m13:04:07.327346 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 10.22 seconds (10.22s).
[0m13:04:07.330112 [debug] [MainThread]: Command end result
[0m13:04:07.371571 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:04:07.374449 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:04:07.385670 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m13:04:07.386342 [info ] [MainThread]: 
[0m13:04:07.387100 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:04:07.387820 [info ] [MainThread]: 
[0m13:04:07.388766 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m13:04:07.390293 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 15.280234, "process_in_blocks": "0", "process_kernel_time": 0.56043, "process_mem_max_rss": "374276", "process_out_blocks": "3144", "process_user_time": 8.474393}
[0m13:04:07.391206 [debug] [MainThread]: Command `dbt run` succeeded at 13:04:07.391054 after 15.28 seconds
[0m13:04:07.391909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65ecc73e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65ecbe5c00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c65ebae9360>]}
[0m13:04:07.393046 [debug] [MainThread]: Flushing usage events
[0m13:04:08.058442 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:04:19.766888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd86b4be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd859abf70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd859abf10>]}


============================== 13:04:19.770352 | c0eaf576-ff1b-4bc8-a04a-6bbead98207f ==============================
[0m13:04:19.770352 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:04:19.771161 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'invocation_command': 'dbt ls', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:04:23.171133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c0eaf576-ff1b-4bc8-a04a-6bbead98207f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd5bf5e920>]}
[0m13:04:23.329356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c0eaf576-ff1b-4bc8-a04a-6bbead98207f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd859aa200>]}
[0m13:04:23.330378 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:04:23.687575 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:04:23.871849 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:04:23.872691 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:04:23.945101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c0eaf576-ff1b-4bc8-a04a-6bbead98207f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd5b91fe50>]}
[0m13:04:24.089788 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:04:24.093431 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:04:24.106973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c0eaf576-ff1b-4bc8-a04a-6bbead98207f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd5b91eec0>]}
[0m13:04:24.108577 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m13:04:24.109638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c0eaf576-ff1b-4bc8-a04a-6bbead98207f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd5ba4c580>]}
[0m13:04:24.111010 [info ] [MainThread]: gasag.marts.kraftwerke_metrics
[0m13:04:24.111646 [info ] [MainThread]: gasag.marts.last_day_exceptions
[0m13:04:24.112264 [info ] [MainThread]: gasag.staging.stg_kraftwerksdaten
[0m13:04:24.113068 [info ] [MainThread]: source:gasag.raw.kraftwerksdaten_raw
[0m13:04:24.114796 [debug] [MainThread]: Resource report: {"command_name": "list", "command_success": true, "command_wall_clock_time": 4.4656096, "process_in_blocks": "0", "process_kernel_time": 0.498539, "process_mem_max_rss": "355688", "process_out_blocks": "1040", "process_user_time": 6.795727}
[0m13:04:24.116481 [debug] [MainThread]: Command `dbt ls` succeeded at 13:04:24.116257 after 4.47 seconds
[0m13:04:24.117153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd86b4be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd5bf5e920>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7edd5baefbe0>]}
[0m13:04:24.117806 [debug] [MainThread]: Flushing usage events
[0m13:04:24.910610 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:04:37.219567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8ecf87e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8ebdfeec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8ebdfef20>]}


============================== 13:04:37.224111 | f6e3f6b1-da4c-463f-8002-3a47b4f716c5 ==============================
[0m13:04:37.224111 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:04:37.224940 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt test', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:04:40.472334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f6e3f6b1-da4c-463f-8002-3a47b4f716c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8c2481c90>]}
[0m13:04:40.607911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f6e3f6b1-da4c-463f-8002-3a47b4f716c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8ebdfd330>]}
[0m13:04:40.608967 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:04:40.918177 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:04:41.103082 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:04:41.103971 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:04:41.163609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f6e3f6b1-da4c-463f-8002-3a47b4f716c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8c1e43f10>]}
[0m13:04:41.288250 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:04:41.290711 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:04:41.323359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f6e3f6b1-da4c-463f-8002-3a47b4f716c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8c1e4fca0>]}
[0m13:04:41.324219 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m13:04:41.324976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6e3f6b1-da4c-463f-8002-3a47b4f716c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8c1e40dc0>]}
[0m13:04:41.327128 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m13:04:41.330053 [debug] [MainThread]: Command end result
[0m13:04:41.362545 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:04:41.364844 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:04:41.371276 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m13:04:41.372800 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.2757635, "process_in_blocks": "0", "process_kernel_time": 0.495981, "process_mem_max_rss": "360772", "process_out_blocks": "2040", "process_user_time": 6.654337}
[0m13:04:41.373861 [debug] [MainThread]: Command `dbt test` succeeded at 13:04:41.373667 after 4.28 seconds
[0m13:04:41.374646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8ecf87e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8c2481c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8ecefe620>]}
[0m13:04:41.375469 [debug] [MainThread]: Flushing usage events
[0m13:04:41.980876 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:04:52.400883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e32a6c8bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e32a5b02ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e32a5b02f20>]}


============================== 13:04:52.404500 | fb3aa1f8-10dd-46af-a745-7662f3cb35c1 ==============================
[0m13:04:52.404500 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:04:52.405341 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt docs generate', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:04:55.872324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb3aa1f8-10dd-46af-a745-7662f3cb35c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e327c0c0880>]}
[0m13:04:56.011844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb3aa1f8-10dd-46af-a745-7662f3cb35c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e32a651af80>]}
[0m13:04:56.012946 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:04:56.331828 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:04:56.521466 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:04:56.522143 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:04:56.587087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb3aa1f8-10dd-46af-a745-7662f3cb35c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e327ba4ff70>]}
[0m13:04:56.604176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb3aa1f8-10dd-46af-a745-7662f3cb35c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e327bbc6a40>]}
[0m13:04:56.605005 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m13:04:56.605689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb3aa1f8-10dd-46af-a745-7662f3cb35c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e32a65331f0>]}
[0m13:04:56.607863 [info ] [MainThread]: 
[0m13:04:56.608565 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:04:56.609183 [info ] [MainThread]: 
[0m13:04:56.610921 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:04:56.619003 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208_raw'
[0m13:04:56.619876 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:04:58.261631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb3aa1f8-10dd-46af-a745-7662f3cb35c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e32a8791720>]}
[0m13:04:58.264164 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:04:58.275766 [debug] [Thread-1 (]: Began running node model.gasag.last_day_exceptions
[0m13:04:58.278845 [debug] [Thread-2 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m13:04:58.282230 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_raw, now model.gasag.last_day_exceptions)
[0m13:04:58.286005 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.gasag.stg_kraftwerksdaten'
[0m13:04:58.288355 [debug] [Thread-1 (]: Began compiling node model.gasag.last_day_exceptions
[0m13:04:58.290636 [debug] [Thread-2 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m13:04:58.334341 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.last_day_exceptions"
[0m13:04:58.335478 [debug] [Thread-2 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m13:04:58.336783 [debug] [Thread-1 (]: Began executing node model.gasag.last_day_exceptions
[0m13:04:58.337555 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:04:58.338950 [debug] [Thread-1 (]: Finished running node model.gasag.last_day_exceptions
[0m13:04:58.339667 [debug] [Thread-2 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m13:04:58.340608 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:04:58.341965 [debug] [Thread-2 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m13:04:58.343590 [debug] [Thread-4 (]: Began running node model.gasag.kraftwerke_metrics
[0m13:04:58.345116 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.gasag.kraftwerke_metrics'
[0m13:04:58.346519 [debug] [Thread-4 (]: Began compiling node model.gasag.kraftwerke_metrics
[0m13:04:58.352362 [debug] [Thread-4 (]: Writing injected SQL for node "model.gasag.kraftwerke_metrics"
[0m13:04:58.353328 [debug] [Thread-4 (]: Began executing node model.gasag.kraftwerke_metrics
[0m13:04:58.354018 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:04:58.355326 [debug] [Thread-4 (]: Finished running node model.gasag.kraftwerke_metrics
[0m13:04:58.356876 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:04:58.357466 [debug] [MainThread]: Connection 'model.gasag.last_day_exceptions' was properly closed.
[0m13:04:58.358055 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m13:04:58.358632 [debug] [MainThread]: Connection 'model.gasag.kraftwerke_metrics' was properly closed.
[0m13:04:58.360749 [debug] [MainThread]: Command end result
[0m13:04:58.498344 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:04:58.500664 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:04:58.511304 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m13:04:58.514362 [debug] [MainThread]: Acquiring new bigquery connection 'generate_catalog'
[0m13:04:58.515113 [info ] [MainThread]: Building catalog
[0m13:04:58.522733 [debug] [ThreadPool]: Acquiring new bigquery connection 'gasag-465208.information_schema'
[0m13:04:58.555345 [debug] [ThreadPool]: On gasag-465208.information_schema: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "connection_name": "gasag-465208.information_schema"} */

    with
                table_shards_stage as (
    select
        tables.project_id as table_catalog,
        tables.dataset_id as table_schema,
        coalesce(REGEXP_EXTRACT(tables.table_id, '^(.+)[0-9]{8}$'), tables.table_id) as table_name,
        tables.table_id as shard_name,
        REGEXP_EXTRACT(tables.table_id, '^.+([0-9]{8})$') as shard_index,
        REGEXP_CONTAINS(tables.table_id, '^.+[0-9]{8}$') and tables.type = 1 as is_date_shard,
        case
            when materialized_views.table_name is not null then 'materialized view'
            when tables.type = 1 then 'table'
            when tables.type = 2 then 'view'
            else 'external'
        end as table_type,
        tables.type = 1 as is_table,
        JSON_VALUE(table_description.option_value) as table_comment,
        tables.size_bytes,
        tables.row_count
    from `gasag-465208`.`raw`.__TABLES__ tables
    left join `gasag-465208`.`raw`.INFORMATION_SCHEMA.MATERIALIZED_VIEWS materialized_views
        on materialized_views.table_catalog = tables.project_id
        and materialized_views.table_schema = tables.dataset_id
        and materialized_views.table_name = tables.table_id
    left join `gasag-465208`.`raw`.INFORMATION_SCHEMA.TABLE_OPTIONS table_description
        on table_description.table_catalog = tables.project_id
        and table_description.table_schema = tables.dataset_id
        and table_description.table_name = tables.table_id
        and table_description.option_name = 'description'
),
                table_shards as (
                    select * from table_shards_stage
                    where ((
                                upper(table_schema) = upper('raw')
                            and upper(table_name) = upper('last_day_exceptions')
                            ) or (
                                upper(table_schema) = upper('raw')
                            and upper(table_name) = upper('kraftwerke_metrics')
                            ) or (
                                upper(table_schema) = upper('raw')
                            and upper(table_name) = upper('kraftwerksdaten_raw')
                            ) or (
                                upper(table_schema) = upper('raw')
                            and upper(table_name) = upper('stg_kraftwerksdaten')
                            ))
                ),
                tables as (
    select distinct
        table_catalog,
        table_schema,
        table_name,
        is_date_shard,
        table_type,
        is_table,
        table_comment
    from table_shards
),
                table_stats as (
    select
        table_catalog,
        table_schema,
        table_name,
        max(shard_name) as latest_shard_name,
        min(shard_index) as shard_min,
        max(shard_index) as shard_max,
        count(shard_index) as shard_count,
        sum(size_bytes) as size_bytes,
        sum(row_count) as row_count
    from table_shards
    group by 1, 2, 3
),

                columns as (
    select
        columns.table_catalog,
        columns.table_schema,
        columns.table_name as shard_name,
        coalesce(paths.field_path, '<unknown>') as column_name,
        -- invent a row number to account for nested fields
        -- BQ does not treat these nested properties as independent fields
        row_number() over (
            partition by
                columns.table_catalog,
                columns.table_schema,
                columns.table_name
            order by
                columns.ordinal_position,
                paths.field_path
        ) as column_index,
        coalesce(paths.data_type, '<unknown>') as column_type,
        paths.description as column_comment,
        case when columns.is_partitioning_column = 'YES' then 1 else 0 end as is_partitioning_column,
        case when columns.is_partitioning_column = 'YES' then paths.field_path end as partition_column,
        case when columns.clustering_ordinal_position is not null then 1 else 0 end as is_clustering_column,
        case when columns.clustering_ordinal_position is not null then paths.field_path end as cluster_column,
        columns.clustering_ordinal_position
    from `gasag-465208`.`raw`.INFORMATION_SCHEMA.COLUMNS columns
    join `gasag-465208`.`raw`.INFORMATION_SCHEMA.COLUMN_FIELD_PATHS paths
        on paths.table_catalog = columns.table_catalog
        and paths.table_schema = columns.table_schema
        and paths.table_name = columns.table_name
        and paths.column_name = columns.column_name
    where columns.ordinal_position is not null
),
                column_stats as (
    select
        table_catalog,
        table_schema,
        shard_name,
        max(is_partitioning_column) = 1 as is_partitioned,
        max(partition_column) as partition_column,
        max(is_clustering_column) = 1 as is_clustered,
        array_to_string(
            array_agg(
                cluster_column ignore nulls
                order by clustering_ordinal_position
            ), ', '
        ) as clustering_columns
    from columns
    group by 1, 2, 3
)

            
    select
        tables.table_catalog as table_database,
        tables.table_schema,
        case
            when tables.is_date_shard then concat(tables.table_name, '*')
            else tables.table_name
        end as table_name,
        tables.table_type,
        tables.table_comment,
        -- coalesce column metadata fields to ensure they are non-null for catalog generation
        -- external table columns are not present in COLUMN_FIELD_PATHS
        coalesce(columns.column_name, '<unknown>') as column_name,
        coalesce(columns.column_index, 1) as column_index,
        coalesce(columns.column_type, '<unknown>') as column_type,
        coalesce(columns.column_comment, '') as column_comment,

        'Shard count' as `stats__date_shards__label`,
        table_stats.shard_count as `stats__date_shards__value`,
        'The number of date shards in this table' as `stats__date_shards__description`,
        tables.is_date_shard as `stats__date_shards__include`,

        'Shard (min)' as `stats__date_shard_min__label`,
        table_stats.shard_min as `stats__date_shard_min__value`,
        'The first date shard in this table' as `stats__date_shard_min__description`,
        tables.is_date_shard as `stats__date_shard_min__include`,

        'Shard (max)' as `stats__date_shard_max__label`,
        table_stats.shard_max as `stats__date_shard_max__value`,
        'The last date shard in this table' as `stats__date_shard_max__description`,
        tables.is_date_shard as `stats__date_shard_max__include`,

        '# Rows' as `stats__num_rows__label`,
        table_stats.row_count as `stats__num_rows__value`,
        'Approximate count of rows in this table' as `stats__num_rows__description`,
        tables.is_table as `stats__num_rows__include`,

        'Approximate Size' as `stats__num_bytes__label`,
        table_stats.size_bytes as `stats__num_bytes__value`,
        'Approximate size of table as reported by BigQuery' as `stats__num_bytes__description`,
        tables.is_table as `stats__num_bytes__include`,

        'Partitioned By' as `stats__partitioning_type__label`,
        column_stats.partition_column as `stats__partitioning_type__value`,
        'The partitioning column for this table' as `stats__partitioning_type__description`,
        column_stats.is_partitioned as `stats__partitioning_type__include`,

        'Clustered By' as `stats__clustering_fields__label`,
        column_stats.clustering_columns as `stats__clustering_fields__value`,
        'The clustering columns for this table' as `stats__clustering_fields__description`,
        column_stats.is_clustered as `stats__clustering_fields__include`

    from tables
    join table_stats
        on table_stats.table_catalog = tables.table_catalog
        and table_stats.table_schema = tables.table_schema
        and table_stats.table_name = tables.table_name
    left join column_stats
        on column_stats.table_catalog = tables.table_catalog
        and column_stats.table_schema = tables.table_schema
        and column_stats.shard_name = table_stats.latest_shard_name
    left join columns
        on columns.table_catalog = tables.table_catalog
        and columns.table_schema = tables.table_schema
        and columns.shard_name = table_stats.latest_shard_name

  
[0m13:04:58.557468 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:04:59.232496 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:6e91b686-7c51-4cfc-925e-c08e6fbaf9c0&page=queryresults
[0m13:05:01.744158 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:05:01.770309 [debug] [MainThread]: Wrote artifact CatalogArtifact to /home/anton/code/gasag/dbt_gasag/target/catalog.json
[0m13:05:01.813056 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:05:01.816047 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:05:01.816943 [info ] [MainThread]: Catalog written to /home/anton/code/gasag/dbt_gasag/target/catalog.json
[0m13:05:01.818297 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 9.5441475, "process_in_blocks": "0", "process_kernel_time": 0.554434, "process_mem_max_rss": "364336", "process_out_blocks": "5472", "process_user_time": 7.575624}
[0m13:05:01.819301 [debug] [MainThread]: Command `dbt docs generate` succeeded at 13:05:01.819154 after 9.55 seconds
[0m13:05:01.819937 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m13:05:01.820508 [debug] [MainThread]: Connection 'gasag-465208.information_schema' was properly closed.
[0m13:05:01.821140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e32a6c8bee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e327c0c0880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e327bbc5480>]}
[0m13:05:01.821842 [debug] [MainThread]: Flushing usage events
[0m13:05:02.406025 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:19:49.856010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744aa3f8bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744aa2e02ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744aa2e02f20>]}


============================== 13:19:49.860124 | 5aae542b-8840-4c3f-bb33-05e4c88588f5 ==============================
[0m13:19:49.860124 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:19:49.861951 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:19:53.088403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5aae542b-8840-4c3f-bb33-05e4c88588f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744aa5b03640>]}
[0m13:19:53.231327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5aae542b-8840-4c3f-bb33-05e4c88588f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744aa2e01330>]}
[0m13:19:53.232300 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:19:53.553394 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:19:53.711767 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m13:19:53.712646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5aae542b-8840-4c3f-bb33-05e4c88588f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744aa381d930>]}
[0m13:19:55.789062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5aae542b-8840-4c3f-bb33-05e4c88588f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744a73be4130>]}
[0m13:19:55.922530 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:19:55.926637 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:19:55.945842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5aae542b-8840-4c3f-bb33-05e4c88588f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744a73bd8e20>]}
[0m13:19:55.946749 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m13:19:55.947594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5aae542b-8840-4c3f-bb33-05e4c88588f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744a781231f0>]}
[0m13:19:55.950158 [info ] [MainThread]: 
[0m13:19:55.951023 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:19:55.951775 [info ] [MainThread]: 
[0m13:19:55.952878 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:19:55.962971 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m13:19:55.963793 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:19:57.069262 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now create_gasag-465208_analysis)
[0m13:19:57.072486 [debug] [ThreadPool]: Creating schema "database: "gasag-465208"
schema: "analysis"
"
[0m13:19:57.097569 [debug] [ThreadPool]: On create_gasag-465208_analysis: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "connection_name": "create_gasag-465208_analysis"} */
create schema if not exists `gasag-465208`.`analysis`
  
[0m13:19:57.098380 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:19:57.597667 [error] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:c03a495e-40ed-46f6-8608-195743be6a5a&page=queryresults
[0m13:19:57.600221 [debug] [ThreadPool]: BigQuery adapter: Unhandled error while running:
macro create_schema
[0m13:19:57.601922 [debug] [ThreadPool]: BigQuery adapter: Database Error
  Access Denied: Project gasag-465208: User does not have bigquery.jobs.create permission in project gasag-465208.
[0m13:19:57.604763 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:19:57.607715 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:19:57.609186 [debug] [MainThread]: Connection 'create_gasag-465208_analysis' was properly closed.
[0m13:19:57.610504 [info ] [MainThread]: 
[0m13:19:57.611934 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.66 seconds (1.66s).
[0m13:19:57.613530 [error] [MainThread]: Encountered an error:
Database Error
  Access Denied: Project gasag-465208: User does not have bigquery.jobs.create permission in project gasag-465208.
[0m13:19:57.615159 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.882888, "process_in_blocks": "0", "process_kernel_time": 0.519491, "process_mem_max_rss": "372204", "process_out_blocks": "2056", "process_user_time": 8.962233}
[0m13:19:57.616473 [debug] [MainThread]: Command `dbt run` failed at 13:19:57.616283 after 7.88 seconds
[0m13:19:57.617578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744aa3f8bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744a73bd89d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744a7812a9e0>]}
[0m13:19:57.619032 [debug] [MainThread]: Flushing usage events
[0m13:19:58.299437 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:22:20.566949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d195247d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d1940baec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d1940baf20>]}


============================== 13:22:20.570922 | aec4f3f5-242f-4ece-bb39-21c52b931b5a ==============================
[0m13:22:20.570922 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:22:20.571859 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/anton/.dbt', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m13:22:20.582617 [info ] [MainThread]: dbt version: 1.10.3
[0m13:22:20.583607 [info ] [MainThread]: python version: 3.10.12
[0m13:22:20.584282 [info ] [MainThread]: python path: /usr/bin/python3
[0m13:22:20.584943 [info ] [MainThread]: os info: Linux-6.8.0-60-generic-x86_64-with-glibc2.35
[0m13:22:23.644451 [info ] [MainThread]: Using profiles dir at /home/anton/.dbt
[0m13:22:23.645599 [info ] [MainThread]: Using profiles.yml file at /home/anton/.dbt/profiles.yml
[0m13:22:23.646400 [info ] [MainThread]: Using dbt_project.yml file at /home/anton/code/gasag/dbt_gasag/dbt_project.yml
[0m13:22:23.647093 [info ] [MainThread]: adapter type: bigquery
[0m13:22:23.647805 [info ] [MainThread]: adapter version: 1.9.2
[0m13:22:23.904703 [info ] [MainThread]: Configuration:
[0m13:22:23.905428 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m13:22:23.906011 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:22:23.906582 [info ] [MainThread]: Required dependencies:
[0m13:22:23.907165 [debug] [MainThread]: Executing "git --help"
[0m13:22:23.914686 [debug] [MainThread]: STDOUT: "b"usage: git [--version] [--help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:22:23.915975 [debug] [MainThread]: STDERR: "b''"
[0m13:22:23.916993 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:22:23.917978 [info ] [MainThread]: Connection:
[0m13:22:23.918825 [info ] [MainThread]:   method: oauth
[0m13:22:23.919549 [info ] [MainThread]:   database: gasag-465208
[0m13:22:23.920285 [info ] [MainThread]:   execution_project: gasag-465208
[0m13:22:23.920969 [info ] [MainThread]:   schema: analysis
[0m13:22:23.921652 [info ] [MainThread]:   location: US
[0m13:22:23.922344 [info ] [MainThread]:   priority: None
[0m13:22:23.923247 [info ] [MainThread]:   maximum_bytes_billed: None
[0m13:22:23.924111 [info ] [MainThread]:   impersonate_service_account: None
[0m13:22:23.924827 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m13:22:23.925515 [info ] [MainThread]:   job_retries: 1
[0m13:22:23.926290 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m13:22:23.927108 [info ] [MainThread]:   job_execution_timeout_seconds: None
[0m13:22:23.927971 [info ] [MainThread]:   timeout_seconds: None
[0m13:22:23.929020 [info ] [MainThread]:   client_id: None
[0m13:22:23.930194 [info ] [MainThread]:   token_uri: None
[0m13:22:23.931178 [info ] [MainThread]:   compute_region: None
[0m13:22:23.932156 [info ] [MainThread]:   dataproc_cluster_name: None
[0m13:22:23.933665 [info ] [MainThread]:   gcs_bucket: None
[0m13:22:23.934599 [info ] [MainThread]:   dataproc_batch: None
[0m13:22:23.936005 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:22:24.225906 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m13:22:24.226626 [debug] [MainThread]: On debug: select 1 as id
[0m13:22:24.227284 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:22:26.198951 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:2e60f268-dfe9-4d0d-b7d3-2773acfe0a8b&page=queryresults
[0m13:22:26.888121 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m13:22:26.889115 [info ] [MainThread]: [32mAll checks passed![0m
[0m13:22:26.890822 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 6.4464, "process_in_blocks": "0", "process_kernel_time": 0.483456, "process_mem_max_rss": "355444", "process_out_blocks": "16", "process_user_time": 6.345868}
[0m13:22:26.892003 [debug] [MainThread]: Command `dbt debug` succeeded at 13:22:26.891802 after 6.45 seconds
[0m13:22:26.892798 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m13:22:26.893902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d195247d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d16a54cee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d16a54ebc0>]}
[0m13:22:26.895506 [debug] [MainThread]: Flushing usage events
[0m13:22:27.559237 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:22:46.106752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c603dc83df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c603cafaec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c603cafaf20>]}


============================== 13:22:46.111754 | 04107922-1d07-4cce-94a3-412fe9e3ffca ==============================
[0m13:22:46.111754 [info ] [MainThread]: Running with dbt=1.10.3
[0m13:22:46.112589 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/anton/.dbt', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:22:49.334517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '04107922-1d07-4cce-94a3-412fe9e3ffca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c603f77b700>]}
[0m13:22:49.474469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '04107922-1d07-4cce-94a3-412fe9e3ffca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c603ce5f550>]}
[0m13:22:49.476081 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m13:22:49.785081 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m13:22:49.974352 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:22:49.975381 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:22:50.036878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04107922-1d07-4cce-94a3-412fe9e3ffca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6012a406a0>]}
[0m13:22:50.173991 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:22:50.177475 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:22:50.193890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04107922-1d07-4cce-94a3-412fe9e3ffca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6012bf20b0>]}
[0m13:22:50.194746 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m13:22:50.195486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04107922-1d07-4cce-94a3-412fe9e3ffca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6012a414e0>]}
[0m13:22:50.197906 [info ] [MainThread]: 
[0m13:22:50.198542 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:22:50.199095 [info ] [MainThread]: 
[0m13:22:50.199915 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:22:50.206812 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m13:22:50.207836 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:22:51.945394 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m13:22:51.947913 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:22:52.549709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04107922-1d07-4cce-94a3-412fe9e3ffca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6012fb2710>]}
[0m13:22:52.551347 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:22:52.559114 [debug] [Thread-1 (]: Began running node model.gasag.last_day_exceptions
[0m13:22:52.560663 [debug] [Thread-2 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m13:22:52.562159 [info ] [Thread-1 (]: 1 of 3 START sql table model analysis.last_day_exceptions ...................... [RUN]
[0m13:22:52.563753 [info ] [Thread-2 (]: 2 of 3 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m13:22:52.565283 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.last_day_exceptions)
[0m13:22:52.568147 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.gasag.stg_kraftwerksdaten'
[0m13:22:52.570192 [debug] [Thread-1 (]: Began compiling node model.gasag.last_day_exceptions
[0m13:22:52.571679 [debug] [Thread-2 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m13:22:52.590307 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.last_day_exceptions"
[0m13:22:52.596162 [debug] [Thread-2 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m13:22:52.597488 [debug] [Thread-2 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m13:22:52.603698 [debug] [Thread-1 (]: Began executing node model.gasag.last_day_exceptions
[0m13:22:52.710202 [debug] [Thread-2 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m13:22:52.711032 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.last_day_exceptions"
[0m13:22:52.712822 [debug] [Thread-2 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
)

SELECT
    Kraftwerk,
    Timestamp,
    Zaehlerstand,
    is_decreasing_zaehlerstand,
    is_last_day,
    leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN leistung IS NOT NULL AND leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load
FROM cleaned_data
WHERE Timestamp > TIMESTAMP('2024-01-01 00:00:00')
    );
  
[0m13:22:52.714275 [debug] [Thread-1 (]: On model.gasag.last_day_exceptions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.last_day_exceptions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`last_day_exceptions`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Calculate raw Leistung (including negative values)
        Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp)) AS raw_leistung
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

last_day_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        raw_leistung,
        -- Flag for peak load (> 50MW)
        CASE
            WHEN raw_leistung > 50 THEN TRUE
            ELSE FALSE
        END AS is_peak_load,
        -- Flag for negative Leistung
        CASE
            WHEN raw_leistung < 0 THEN TRUE
            ELSE FALSE
        END AS is_negative_leistung
    FROM raw_data
    WHERE DATE(Timestamp) = (SELECT last_date FROM max_date)
)

SELECT
    hour_of_day,
    Kraftwerk,
    is_peak_load,
    is_negative_leistung,
    raw_leistung AS leistung
FROM last_day_data
WHERE raw_leistung IS NOT NULL  -- Only show rows with valid Leistung
ORDER BY hour_of_day, Kraftwerk
    );
  
[0m13:22:52.715142 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:22:52.715982 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:22:53.689960 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:a5a1784f-ecb4-43d4-a2c7-502bc07311a8&page=queryresults
[0m13:22:54.072696 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:ec658a9d-c111-4dcc-92b7-9b4ace6e0290&page=queryresults
[0m13:22:56.604169 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04107922-1d07-4cce-94a3-412fe9e3ffca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6017d09660>]}
[0m13:22:56.606573 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analysis.last_day_exceptions ................. [[32mCREATE TABLE (80.0 rows, 190.4 KiB processed)[0m in 4.04s]
[0m13:22:56.609285 [debug] [Thread-1 (]: Finished running node model.gasag.last_day_exceptions
[0m13:23:06.517934 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04107922-1d07-4cce-94a3-412fe9e3ffca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6012177370>]}
[0m13:23:06.521985 [info ] [Thread-2 (]: 2 of 3 OK created sql table model analysis.stg_kraftwerksdaten ................. [[32mCREATE TABLE (5.0k rows, 190.4 KiB processed)[0m in 13.95s]
[0m13:23:06.525011 [debug] [Thread-2 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m13:23:06.527178 [debug] [Thread-4 (]: Began running node model.gasag.kraftwerke_metrics
[0m13:23:06.528625 [info ] [Thread-4 (]: 3 of 3 START sql table model analysis.kraftwerke_metrics ....................... [RUN]
[0m13:23:06.529955 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.gasag.kraftwerke_metrics'
[0m13:23:06.530857 [debug] [Thread-4 (]: Began compiling node model.gasag.kraftwerke_metrics
[0m13:23:06.538595 [debug] [Thread-4 (]: Writing injected SQL for node "model.gasag.kraftwerke_metrics"
[0m13:23:06.539920 [debug] [Thread-4 (]: Began executing node model.gasag.kraftwerke_metrics
[0m13:23:06.545687 [debug] [Thread-4 (]: Writing runtime sql for node "model.gasag.kraftwerke_metrics"
[0m13:23:06.547119 [debug] [Thread-4 (]: On model.gasag.kraftwerke_metrics: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.kraftwerke_metrics"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`kraftwerke_metrics`
      
    
    

    OPTIONS()
    as (
      WITH staging_data AS (
    SELECT * FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Historical metrics (excluding last day)
historical_metrics AS (
    SELECT
        Kraftwerk,
        -- Durchschnittliche Grundlast (average base load, excluding NULLs)
        AVG(CASE WHEN NOT is_peak_load THEN leistung END) AS durchschnittliche_grundlast,

        -- Durchschnittliche Spitzenlast (average peak load, excluding NULLs)
        AVG(CASE WHEN is_peak_load THEN leistung END) AS durchschnittliche_spitzenlast,

        -- Durchschnittliche Gesamtlast pro Tag (average total load, excluding NULLs)
        AVG(leistung) AS durchschnittliche_gesamtlast_pro_tag,

        -- Quote an Spitzenlasten (percentage of peak loads)
        COUNT(CASE WHEN is_peak_load THEN 1 END) * 100.0 / COUNT(CASE WHEN leistung IS NOT NULL THEN 1 END) AS quote_spitzenlasten_prozent,

        -- Quote an Rückläufigen Zählerständen (percentage of decreasing meter readings)
        COUNT(CASE WHEN is_decreasing_zaehlerstand THEN 1 END) * 100.0 / COUNT(*) AS quote_ruecklaeufige_zaehlerstaende_prozent

    FROM staging_data
    WHERE NOT is_last_day
    GROUP BY Kraftwerk
),

-- Last day metrics
last_day_metrics AS (
    SELECT
        Kraftwerk,
        -- Sum of Leistung for the last day (excluding NULLs)
        SUM(leistung) AS last_day_leistung_sum,
        -- Count of hours with valid data for the last day
        COUNT(CASE WHEN leistung IS NOT NULL THEN 1 END) AS last_day_hours_with_data,
        -- Average Leistung for the last day (excluding NULLs)
        AVG(leistung) AS last_day_durchschnitt_leistung
    FROM staging_data
    WHERE is_last_day
    GROUP BY Kraftwerk
),

-- Expected vs actual comparison for last day
last_day_deviation AS (
    SELECT
        h.Kraftwerk,
        h.durchschnittliche_gesamtlast_pro_tag,
        l.last_day_leistung_sum,
        l.last_day_hours_with_data,
        l.last_day_durchschnitt_leistung,
        -- Expected Leistung (summierte Leistung * 24 / überlieferte Stunden)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN (l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data
            ELSE NULL
        END AS erwartete_leistung,
        -- Tagesabweichung (Expected - Actual average)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN ((l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data) - h.durchschnittliche_gesamtlast_pro_tag
            ELSE NULL
        END AS tagesabweichung
    FROM historical_metrics h
    LEFT JOIN last_day_metrics l ON h.Kraftwerk = l.Kraftwerk
)

SELECT
    h.Kraftwerk,
    h.durchschnittliche_grundlast,
    h.durchschnittliche_spitzenlast,
    h.durchschnittliche_gesamtlast_pro_tag,
    h.quote_spitzenlasten_prozent,
    h.quote_ruecklaeufige_zaehlerstaende_prozent,
    l.erwartete_leistung,
    l.tagesabweichung
FROM historical_metrics h
LEFT JOIN last_day_deviation l ON h.Kraftwerk = l.Kraftwerk
    );
  
[0m13:23:06.548364 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:23:07.471049 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:23d13841-2d4e-48f2-85f2-61ed9e564df0&page=queryresults
[0m13:23:10.677330 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04107922-1d07-4cce-94a3-412fe9e3ffca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6012a6ba00>]}
[0m13:23:10.680869 [info ] [Thread-4 (]: 3 of 3 OK created sql table model analysis.kraftwerke_metrics .................. [[32mCREATE TABLE (5.0 rows, 116.6 KiB processed)[0m in 4.15s]
[0m13:23:10.684860 [debug] [Thread-4 (]: Finished running node model.gasag.kraftwerke_metrics
[0m13:23:10.690126 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:23:10.693237 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:23:10.695119 [debug] [MainThread]: Connection 'model.gasag.last_day_exceptions' was properly closed.
[0m13:23:10.697840 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m13:23:10.700294 [debug] [MainThread]: Connection 'model.gasag.kraftwerke_metrics' was properly closed.
[0m13:23:10.705033 [info ] [MainThread]: 
[0m13:23:10.708184 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 20.50 seconds (20.50s).
[0m13:23:10.713601 [debug] [MainThread]: Command end result
[0m13:23:10.761316 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m13:23:10.763883 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m13:23:10.774484 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m13:23:10.775509 [info ] [MainThread]: 
[0m13:23:10.776622 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:23:10.777218 [info ] [MainThread]: 
[0m13:23:10.777851 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=3
[0m13:23:10.779145 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 24.798689, "process_in_blocks": "0", "process_kernel_time": 0.493835, "process_mem_max_rss": "365956", "process_out_blocks": "2136", "process_user_time": 7.699429}
[0m13:23:10.780011 [debug] [MainThread]: Command `dbt run` succeeded at 13:23:10.779862 after 24.80 seconds
[0m13:23:10.781393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c603dc83df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c603dc2d450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6012a1afe0>]}
[0m13:23:10.782823 [debug] [MainThread]: Flushing usage events
[0m13:23:11.365474 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:18:25.573680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe645c83d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe644af6ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe644af6f20>]}


============================== 17:18:25.578201 | 84bb7461-c62b-4a7b-8ee6-558430701d0f ==============================
[0m17:18:25.578201 [info ] [MainThread]: Running with dbt=1.10.3
[0m17:18:25.579407 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m17:18:28.837858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84bb7461-c62b-4a7b-8ee6-558430701d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe61b1584f0>]}
[0m17:18:28.978088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84bb7461-c62b-4a7b-8ee6-558430701d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe644af5330>]}
[0m17:18:28.979077 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m17:18:29.307981 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m17:18:29.501030 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 1 files changed.
[0m17:18:29.501964 [debug] [MainThread]: Partial parsing: added file: gasag://models/marts/all_exceptions.sql
[0m17:18:29.502542 [debug] [MainThread]: Partial parsing: deleted file: gasag://models/marts/last_day_exceptions.sql
[0m17:18:29.504197 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/kraftwerke_metrics.sql
[0m17:18:30.077139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84bb7461-c62b-4a7b-8ee6-558430701d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe61ab7a290>]}
[0m17:18:30.205953 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m17:18:30.208306 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m17:18:30.224891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84bb7461-c62b-4a7b-8ee6-558430701d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe6199308b0>]}
[0m17:18:30.225748 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m17:18:30.226438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84bb7461-c62b-4a7b-8ee6-558430701d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe619930970>]}
[0m17:18:30.228698 [info ] [MainThread]: 
[0m17:18:30.229408 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:18:30.230055 [info ] [MainThread]: 
[0m17:18:30.230912 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:18:30.238357 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m17:18:30.239247 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:18:31.980239 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m17:18:31.982859 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:18:32.496250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84bb7461-c62b-4a7b-8ee6-558430701d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe644cb2770>]}
[0m17:18:32.498009 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:18:32.505013 [debug] [Thread-1 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m17:18:32.507457 [info ] [Thread-1 (]: 1 of 3 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m17:18:32.509469 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.stg_kraftwerksdaten)
[0m17:18:32.511176 [debug] [Thread-1 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m17:18:32.530486 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m17:18:32.531510 [debug] [Thread-1 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m17:18:32.557950 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:18:33.055343 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m17:18:33.056585 [debug] [Thread-1 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
)

SELECT
    Kraftwerk,
    Timestamp,
    Zaehlerstand,
    is_decreasing_zaehlerstand,
    is_last_day,
    leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN leistung IS NOT NULL AND leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load
FROM cleaned_data
WHERE Timestamp > TIMESTAMP('2024-01-01 00:00:00')
    );
  
[0m17:18:33.869383 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:3b90c22a-9388-4806-8927-507a765ee7a1&page=queryresults
[0m17:18:37.348600 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84bb7461-c62b-4a7b-8ee6-558430701d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe61fe09120>]}
[0m17:18:37.350226 [info ] [Thread-1 (]: 1 of 3 OK created sql table model analysis.stg_kraftwerksdaten ................. [[32mCREATE TABLE (5.0k rows, 190.4 KiB processed)[0m in 4.84s]
[0m17:18:37.352338 [debug] [Thread-1 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m17:18:37.354363 [debug] [Thread-3 (]: Began running node model.gasag.all_exceptions
[0m17:18:37.355447 [info ] [Thread-3 (]: 2 of 3 START sql table model analysis.all_exceptions ........................... [RUN]
[0m17:18:37.356375 [debug] [Thread-4 (]: Began running node model.gasag.kraftwerke_metrics
[0m17:18:37.357903 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.gasag.all_exceptions'
[0m17:18:37.358963 [info ] [Thread-4 (]: 3 of 3 START sql table model analysis.kraftwerke_metrics ....................... [RUN]
[0m17:18:37.359858 [debug] [Thread-3 (]: Began compiling node model.gasag.all_exceptions
[0m17:18:37.360800 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.gasag.kraftwerke_metrics'
[0m17:18:37.366893 [debug] [Thread-3 (]: Writing injected SQL for node "model.gasag.all_exceptions"
[0m17:18:37.368132 [debug] [Thread-4 (]: Began compiling node model.gasag.kraftwerke_metrics
[0m17:18:37.377732 [debug] [Thread-4 (]: Writing injected SQL for node "model.gasag.kraftwerke_metrics"
[0m17:18:37.379046 [debug] [Thread-3 (]: Began executing node model.gasag.all_exceptions
[0m17:18:37.385139 [debug] [Thread-3 (]: Writing runtime sql for node "model.gasag.all_exceptions"
[0m17:18:37.386486 [debug] [Thread-4 (]: Began executing node model.gasag.kraftwerke_metrics
[0m17:18:37.390612 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m17:18:37.391856 [debug] [Thread-3 (]: On model.gasag.all_exceptions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.all_exceptions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`all_exceptions`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Calculate raw Leistung (including negative values)
        Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp)) AS raw_leistung
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

staging_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        leistung,
        is_peak_load
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

all_exceptions AS (
    -- Peak loads from cleaned staging data
    SELECT
        s.Kraftwerk,
        s.Timestamp,
        s.leistung,
        TRUE AS is_peak_load,
        FALSE AS is_negative_leistung
    FROM staging_data s
    WHERE s.is_peak_load = TRUE AND s.leistung IS NOT NULL

    UNION ALL

    -- Negative spikes from raw data
    SELECT
        r.Kraftwerk,
        r.Timestamp,
        r.raw_leistung AS leistung,
        FALSE AS is_peak_load,
        TRUE AS is_negative_leistung
    FROM raw_data r
    WHERE r.raw_leistung < 0 AND r.raw_leistung IS NOT NULL
)

SELECT
    Kraftwerk,
    Timestamp,
    EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
    EXTRACT(DATE FROM Timestamp) AS date,
    is_peak_load,
    is_negative_leistung,
    leistung
FROM all_exceptions
ORDER BY Timestamp DESC, Kraftwerk
    );
  
[0m17:18:37.394240 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m17:18:37.884190 [debug] [Thread-4 (]: Writing runtime sql for node "model.gasag.kraftwerke_metrics"
[0m17:18:37.887569 [debug] [Thread-4 (]: On model.gasag.kraftwerke_metrics: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.kraftwerke_metrics"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`kraftwerke_metrics`
      
    
    

    OPTIONS()
    as (
      WITH staging_data AS (
    SELECT * FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Daily aggregations first
daily_metrics AS (
    SELECT
        Kraftwerk,
        DATE(Timestamp) as date,
        -- Daily total load (sum of all Leistung for the day)
        SUM(leistung) AS daily_total_load,
        -- Daily average load (average of all Leistung for the day)
        AVG(leistung) AS daily_avg_load,
        -- Count of peak loads for the day
        COUNT(CASE WHEN is_peak_load THEN 1 END) AS daily_peak_loads,
        -- Count of decreasing meter readings for the day
        COUNT(CASE WHEN is_decreasing_zaehlerstand THEN 1 END) AS daily_decreasing_readings,
        -- Total hours with data for the day
        COUNT(*) AS daily_total_hours
    FROM staging_data
    WHERE NOT is_last_day
    GROUP BY Kraftwerk, DATE(Timestamp)
),

-- Historical metrics (averages across all days)
historical_metrics AS (
    SELECT
        Kraftwerk,
        -- Durchschnittliche Grundlast (average base load per hour, excluding NULLs)
        AVG(CASE WHEN NOT is_peak_load THEN leistung END) AS durchschnittliche_grundlast,

        -- Durchschnittliche Spitzenlast (average peak load per hour, excluding NULLs)
        AVG(CASE WHEN is_peak_load THEN leistung END) AS durchschnittliche_spitzenlast,

        -- Durchschnittliche Gesamtlast pro Tag (average daily total load)
        AVG(daily_total_load) AS durchschnittliche_gesamtlast_pro_tag,

        -- Quote an Spitzenlasten (percentage of peak loads across all days)
        SUM(daily_peak_loads) * 100.0 / SUM(daily_total_hours) AS quote_spitzenlasten_prozent,

        -- Quote an Rückläufigen Zählerständen (percentage of decreasing meter readings across all days)
        SUM(daily_decreasing_readings) * 100.0 / SUM(daily_total_hours) AS quote_ruecklaeufige_zaehlerstaende_prozent

    FROM staging_data s
    LEFT JOIN daily_metrics d ON s.Kraftwerk = d.Kraftwerk AND DATE(s.Timestamp) = d.date
    WHERE NOT s.is_last_day
    GROUP BY s.Kraftwerk
),

-- Last day metrics
last_day_metrics AS (
    SELECT
        Kraftwerk,
        -- Sum of Leistung for the last day (excluding NULLs)
        SUM(leistung) AS last_day_leistung_sum,
        -- Count of hours with valid data for the last day
        COUNT(CASE WHEN leistung IS NOT NULL THEN 1 END) AS last_day_hours_with_data,
        -- Average Leistung for the last day (excluding NULLs)
        AVG(leistung) AS last_day_durchschnitt_leistung
    FROM staging_data
    WHERE is_last_day
    GROUP BY Kraftwerk
),

-- Expected vs actual comparison for last day
last_day_deviation AS (
    SELECT
        h.Kraftwerk,
        h.durchschnittliche_gesamtlast_pro_tag,
        l.last_day_leistung_sum,
        l.last_day_hours_with_data,
        l.last_day_durchschnitt_leistung,
        -- Expected Leistung (summierte Leistung * 24 / überlieferte Stunden)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN (l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data
            ELSE NULL
        END AS erwartete_leistung,
        -- Tagesabweichung (Expected - Actual average)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN ((l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data) - h.durchschnittliche_gesamtlast_pro_tag
            ELSE NULL
        END AS tagesabweichung
    FROM historical_metrics h
    LEFT JOIN last_day_metrics l ON h.Kraftwerk = l.Kraftwerk
)

SELECT
    h.Kraftwerk,
    h.durchschnittliche_grundlast,
    h.durchschnittliche_spitzenlast,
    h.durchschnittliche_gesamtlast_pro_tag,
    h.quote_spitzenlasten_prozent,
    h.quote_ruecklaeufige_zaehlerstaende_prozent,
    l.erwartete_leistung,
    l.tagesabweichung
FROM historical_metrics h
LEFT JOIN last_day_deviation l ON h.Kraftwerk = l.Kraftwerk
    );
  
[0m17:18:38.189836 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:b7a5e16d-d393-4c86-94fb-6ea3e2e644a5&page=queryresults
[0m17:18:38.425279 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:9d2f2fc9-88e3-4a1d-91d6-97533bf74d8c&page=queryresults
[0m17:18:38.701266 [error] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:9d2f2fc9-88e3-4a1d-91d6-97533bf74d8c&page=queryresults
[0m17:18:38.706004 [debug] [Thread-4 (]: Database Error in model kraftwerke_metrics (models/marts/kraftwerke_metrics.sql)
  Column name Kraftwerk is ambiguous at [40:9]
  compiled code at target/run/gasag/models/marts/kraftwerke_metrics.sql
[0m17:18:38.707012 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84bb7461-c62b-4a7b-8ee6-558430701d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe61812ef80>]}
[0m17:18:38.708091 [error] [Thread-4 (]: 3 of 3 ERROR creating sql table model analysis.kraftwerke_metrics .............. [[31mERROR[0m in 1.35s]
[0m17:18:38.709237 [debug] [Thread-4 (]: Finished running node model.gasag.kraftwerke_metrics
[0m17:18:38.710239 [debug] [Thread-7 (]: Marking all children of 'model.gasag.kraftwerke_metrics' to be skipped because of status 'error'.  Reason: Database Error in model kraftwerke_metrics (models/marts/kraftwerke_metrics.sql)
  Column name Kraftwerk is ambiguous at [40:9]
  compiled code at target/run/gasag/models/marts/kraftwerke_metrics.sql.
[0m17:18:40.918141 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84bb7461-c62b-4a7b-8ee6-558430701d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe61812fb50>]}
[0m17:18:40.919668 [info ] [Thread-3 (]: 2 of 3 OK created sql table model analysis.all_exceptions ...................... [[32mCREATE TABLE (153.0 rows, 336.3 KiB processed)[0m in 3.56s]
[0m17:18:40.921307 [debug] [Thread-3 (]: Finished running node model.gasag.all_exceptions
[0m17:18:40.923678 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:18:40.925291 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:18:40.926288 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m17:18:40.927289 [debug] [MainThread]: Connection 'model.gasag.all_exceptions' was properly closed.
[0m17:18:40.928285 [debug] [MainThread]: Connection 'model.gasag.kraftwerke_metrics' was properly closed.
[0m17:18:40.929595 [info ] [MainThread]: 
[0m17:18:40.930935 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 10.70 seconds (10.70s).
[0m17:18:40.934432 [debug] [MainThread]: Command end result
[0m17:18:40.978285 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m17:18:40.981035 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m17:18:40.991566 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m17:18:40.992263 [info ] [MainThread]: 
[0m17:18:40.993065 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m17:18:40.993729 [info ] [MainThread]: 
[0m17:18:40.994536 [error] [MainThread]: [31mFailure in model kraftwerke_metrics (models/marts/kraftwerke_metrics.sql)[0m
[0m17:18:40.995285 [error] [MainThread]:   Database Error in model kraftwerke_metrics (models/marts/kraftwerke_metrics.sql)
  Column name Kraftwerk is ambiguous at [40:9]
  compiled code at target/run/gasag/models/marts/kraftwerke_metrics.sql
[0m17:18:40.996096 [info ] [MainThread]: 
[0m17:18:40.997379 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/kraftwerke_metrics.sql
[0m17:18:40.998354 [info ] [MainThread]: 
[0m17:18:40.999425 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=3
[0m17:18:41.001218 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 15.556195, "process_in_blocks": "0", "process_kernel_time": 0.500141, "process_mem_max_rss": "375332", "process_out_blocks": "3168", "process_user_time": 8.179959}
[0m17:18:41.002255 [debug] [MainThread]: Command `dbt run` failed at 17:18:41.002088 after 15.56 seconds
[0m17:18:41.003084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe645c83d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe61b1584f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fe61af69600>]}
[0m17:18:41.004086 [debug] [MainThread]: Flushing usage events
[0m17:18:41.700115 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:19:08.112531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734bd418be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734bd3002ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734bd3002f20>]}


============================== 17:19:08.116141 | 7e33f4bf-823a-4b14-b1b4-9ed27997f393 ==============================
[0m17:19:08.116141 [info ] [MainThread]: Running with dbt=1.10.3
[0m17:19:08.116992 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select kraftwerke_metrics', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:19:11.237002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7e33f4bf-823a-4b14-b1b4-9ed27997f393', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734bd5d03760>]}
[0m17:19:11.373626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7e33f4bf-823a-4b14-b1b4-9ed27997f393', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734bd3001330>]}
[0m17:19:11.374765 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m17:19:11.690092 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m17:19:11.880268 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:19:11.881204 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/kraftwerke_metrics.sql
[0m17:19:12.399487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7e33f4bf-823a-4b14-b1b4-9ed27997f393', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734ba814d1b0>]}
[0m17:19:12.575320 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m17:19:12.577901 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m17:19:12.592841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7e33f4bf-823a-4b14-b1b4-9ed27997f393', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734ba814f430>]}
[0m17:19:12.593666 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m17:19:12.594294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e33f4bf-823a-4b14-b1b4-9ed27997f393', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734ba814ee30>]}
[0m17:19:12.596517 [info ] [MainThread]: 
[0m17:19:12.597255 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:19:12.598040 [info ] [MainThread]: 
[0m17:19:12.599294 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:19:12.601158 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m17:19:12.602127 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:19:16.440784 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m17:19:16.442078 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:19:16.915984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7e33f4bf-823a-4b14-b1b4-9ed27997f393', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734ba814e8f0>]}
[0m17:19:16.919118 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:19:16.928713 [debug] [Thread-1 (]: Began running node model.gasag.kraftwerke_metrics
[0m17:19:16.930444 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.kraftwerke_metrics ....................... [RUN]
[0m17:19:16.931780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.kraftwerke_metrics)
[0m17:19:16.932681 [debug] [Thread-1 (]: Began compiling node model.gasag.kraftwerke_metrics
[0m17:19:16.947079 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.kraftwerke_metrics"
[0m17:19:16.948407 [debug] [Thread-1 (]: Began executing node model.gasag.kraftwerke_metrics
[0m17:19:16.970395 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:19:17.449215 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.kraftwerke_metrics"
[0m17:19:17.450457 [debug] [Thread-1 (]: On model.gasag.kraftwerke_metrics: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.kraftwerke_metrics"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`kraftwerke_metrics`
      
    
    

    OPTIONS()
    as (
      WITH staging_data AS (
    SELECT * FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Daily aggregations first
daily_metrics AS (
    SELECT
        Kraftwerk,
        DATE(Timestamp) as date,
        -- Daily total load (sum of all Leistung for the day)
        SUM(leistung) AS daily_total_load,
        -- Daily average load (average of all Leistung for the day)
        AVG(leistung) AS daily_avg_load,
        -- Count of peak loads for the day
        COUNT(CASE WHEN is_peak_load THEN 1 END) AS daily_peak_loads,
        -- Count of decreasing meter readings for the day
        COUNT(CASE WHEN is_decreasing_zaehlerstand THEN 1 END) AS daily_decreasing_readings,
        -- Total hours with data for the day
        COUNT(*) AS daily_total_hours
    FROM staging_data
    WHERE NOT is_last_day
    GROUP BY Kraftwerk, DATE(Timestamp)
),

-- Historical metrics (averages across all days)
historical_metrics AS (
    SELECT
        s.Kraftwerk,
        -- Durchschnittliche Grundlast (average base load per hour, excluding NULLs)
        AVG(CASE WHEN NOT s.is_peak_load THEN s.leistung END) AS durchschnittliche_grundlast,

        -- Durchschnittliche Spitzenlast (average peak load per hour, excluding NULLs)
        AVG(CASE WHEN s.is_peak_load THEN s.leistung END) AS durchschnittliche_spitzenlast,

        -- Durchschnittliche Gesamtlast pro Tag (average daily total load)
        AVG(d.daily_total_load) AS durchschnittliche_gesamtlast_pro_tag,

        -- Quote an Spitzenlasten (percentage of peak loads across all days)
        SUM(d.daily_peak_loads) * 100.0 / SUM(d.daily_total_hours) AS quote_spitzenlasten_prozent,

        -- Quote an Rückläufigen Zählerständen (percentage of decreasing meter readings across all days)
        SUM(d.daily_decreasing_readings) * 100.0 / SUM(d.daily_total_hours) AS quote_ruecklaeufige_zaehlerstaende_prozent

    FROM staging_data s
    LEFT JOIN daily_metrics d ON s.Kraftwerk = d.Kraftwerk AND DATE(s.Timestamp) = d.date
    WHERE NOT s.is_last_day
    GROUP BY s.Kraftwerk
),

-- Last day metrics
last_day_metrics AS (
    SELECT
        Kraftwerk,
        -- Sum of Leistung for the last day (excluding NULLs)
        SUM(leistung) AS last_day_leistung_sum,
        -- Count of hours with valid data for the last day
        COUNT(CASE WHEN leistung IS NOT NULL THEN 1 END) AS last_day_hours_with_data,
        -- Average Leistung for the last day (excluding NULLs)
        AVG(leistung) AS last_day_durchschnitt_leistung
    FROM staging_data
    WHERE is_last_day
    GROUP BY Kraftwerk
),

-- Expected vs actual comparison for last day
last_day_deviation AS (
    SELECT
        h.Kraftwerk,
        h.durchschnittliche_gesamtlast_pro_tag,
        l.last_day_leistung_sum,
        l.last_day_hours_with_data,
        l.last_day_durchschnitt_leistung,
        -- Expected Leistung (summierte Leistung * 24 / überlieferte Stunden)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN (l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data
            ELSE NULL
        END AS erwartete_leistung,
        -- Tagesabweichung (Expected - Actual average)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN ((l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data) - h.durchschnittliche_gesamtlast_pro_tag
            ELSE NULL
        END AS tagesabweichung
    FROM historical_metrics h
    LEFT JOIN last_day_metrics l ON h.Kraftwerk = l.Kraftwerk
)

SELECT
    h.Kraftwerk,
    h.durchschnittliche_grundlast,
    h.durchschnittliche_spitzenlast,
    h.durchschnittliche_gesamtlast_pro_tag,
    h.quote_spitzenlasten_prozent,
    h.quote_ruecklaeufige_zaehlerstaende_prozent,
    l.erwartete_leistung,
    l.tagesabweichung
FROM historical_metrics h
LEFT JOIN last_day_deviation l ON h.Kraftwerk = l.Kraftwerk
    );
  
[0m17:19:18.670951 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:e1d43255-63a6-412c-86c1-6f86f166ab95&page=queryresults
[0m17:19:22.871761 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7e33f4bf-823a-4b14-b1b4-9ed27997f393', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734bae211690>]}
[0m17:19:22.873054 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.kraftwerke_metrics .................. [[32mCREATE TABLE (5.0 rows, 155.7 KiB processed)[0m in 5.94s]
[0m17:19:22.874125 [debug] [Thread-1 (]: Finished running node model.gasag.kraftwerke_metrics
[0m17:19:22.876184 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:19:22.877178 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:19:22.877864 [debug] [MainThread]: Connection 'model.gasag.kraftwerke_metrics' was properly closed.
[0m17:19:22.878473 [info ] [MainThread]: 
[0m17:19:22.879095 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 10.28 seconds (10.28s).
[0m17:19:22.880186 [debug] [MainThread]: Command end result
[0m17:19:22.937477 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m17:19:22.939855 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m17:19:22.955551 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m17:19:22.956900 [info ] [MainThread]: 
[0m17:19:22.958289 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:19:22.959875 [info ] [MainThread]: 
[0m17:19:22.961371 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:19:22.963842 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 14.97783, "process_in_blocks": "0", "process_kernel_time": 0.519102, "process_mem_max_rss": "372320", "process_out_blocks": "3120", "process_user_time": 7.611842}
[0m17:19:22.965455 [debug] [MainThread]: Command `dbt run` succeeded at 17:19:22.965234 after 14.98 seconds
[0m17:19:22.966940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734bd418be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734bd40e2e60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734bd3001330>]}
[0m17:19:22.968464 [debug] [MainThread]: Flushing usage events
[0m17:19:23.578343 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m17:41:19.928931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25ce15bdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25ccfd2ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25ccfd2f50>]}


============================== 17:41:19.932442 | c2f27128-dd48-43da-9e34-2d81100f022a ==============================
[0m17:41:19.932442 [info ] [MainThread]: Running with dbt=1.10.3
[0m17:41:19.933467 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select stg_kraftwerksdaten', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m17:41:23.193940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c2f27128-dd48-43da-9e34-2d81100f022a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25cfd1f6a0>]}
[0m17:41:23.334747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c2f27128-dd48-43da-9e34-2d81100f022a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25cd1ed5a0>]}
[0m17:41:23.336142 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m17:41:23.648553 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m17:41:23.832259 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m17:41:23.833189 [debug] [MainThread]: Partial parsing: updated file: gasag://models/staging/stg_kraftwerksdaten.sql
[0m17:41:24.383769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c2f27128-dd48-43da-9e34-2d81100f022a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25a2ff3fa0>]}
[0m17:41:24.513614 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m17:41:24.516250 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m17:41:24.532410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c2f27128-dd48-43da-9e34-2d81100f022a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25a2ff3250>]}
[0m17:41:24.533339 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m17:41:24.534251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2f27128-dd48-43da-9e34-2d81100f022a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25a2ff2c20>]}
[0m17:41:24.537051 [info ] [MainThread]: 
[0m17:41:24.537986 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m17:41:24.539486 [info ] [MainThread]: 
[0m17:41:24.540950 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m17:41:24.542375 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m17:41:24.543165 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m17:41:26.292360 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m17:41:26.294988 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m17:41:26.790682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2f27128-dd48-43da-9e34-2d81100f022a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25cfd31570>]}
[0m17:41:26.793284 [debug] [MainThread]: Opening a new connection, currently in state init
[0m17:41:26.805105 [debug] [Thread-1 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m17:41:26.809107 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m17:41:26.811923 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.stg_kraftwerksdaten)
[0m17:41:26.814243 [debug] [Thread-1 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m17:41:26.836406 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m17:41:26.838183 [debug] [Thread-1 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m17:41:26.862659 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m17:41:27.376539 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m17:41:27.377670 [debug] [Thread-1 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
)

SELECT
    Kraftwerk,
    Timestamp,
    EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
    Zaehlerstand,
    is_decreasing_zaehlerstand,
    is_last_day,
    leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN leistung IS NOT NULL AND leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load
FROM cleaned_data
WHERE Timestamp > TIMESTAMP('2024-01-01 00:00:00')
    );
  
[0m17:41:27.940307 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:f66aff8b-6ca8-4293-8e36-474a7b79e85b&page=queryresults
[0m17:41:32.794111 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2f27128-dd48-43da-9e34-2d81100f022a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25a2ff1300>]}
[0m17:41:32.795297 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.stg_kraftwerksdaten ................. [[32mCREATE TABLE (5.0k rows, 190.4 KiB processed)[0m in 5.98s]
[0m17:41:32.796405 [debug] [Thread-1 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m17:41:32.798711 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m17:41:32.800194 [debug] [MainThread]: Connection 'master' was properly closed.
[0m17:41:32.800928 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m17:41:32.802680 [info ] [MainThread]: 
[0m17:41:32.803951 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 8.26 seconds (8.26s).
[0m17:41:32.805225 [debug] [MainThread]: Command end result
[0m17:41:32.844150 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m17:41:32.846678 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m17:41:32.859376 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m17:41:32.860054 [info ] [MainThread]: 
[0m17:41:32.860863 [info ] [MainThread]: [32mCompleted successfully[0m
[0m17:41:32.861505 [info ] [MainThread]: 
[0m17:41:32.862342 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m17:41:32.863800 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.052953, "process_in_blocks": "0", "process_kernel_time": 0.526577, "process_mem_max_rss": "372148", "process_out_blocks": "3088", "process_user_time": 7.727798}
[0m17:41:32.864912 [debug] [MainThread]: Command `dbt run` succeeded at 17:41:32.864712 after 13.05 seconds
[0m17:41:32.866146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25ce15bdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25cfd1f6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b25ce0db100>]}
[0m17:41:32.867385 [debug] [MainThread]: Flushing usage events
[0m17:41:33.545001 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:30:29.815682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031d3e73e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031d2ceaec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031d2ceaf20>]}


============================== 23:30:29.820104 | 2404262b-d0cc-4452-a467-362d7ae42f23 ==============================
[0m23:30:29.820104 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:30:29.821487 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select stg_kraftwerksdaten', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:30:33.479554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2404262b-d0cc-4452-a467-362d7ae42f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031d2e2ecb0>]}
[0m23:30:33.628850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2404262b-d0cc-4452-a467-362d7ae42f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031d3df1cc0>]}
[0m23:30:33.629929 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:30:33.982488 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:30:34.181201 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:30:34.182531 [debug] [MainThread]: Partial parsing: updated file: gasag://models/staging/stg_kraftwerksdaten.sql
[0m23:30:34.767471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2404262b-d0cc-4452-a467-362d7ae42f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031a8cf1300>]}
[0m23:30:34.906923 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:30:34.910139 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:30:34.927741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2404262b-d0cc-4452-a467-362d7ae42f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031a90f7100>]}
[0m23:30:34.928543 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m23:30:34.929210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2404262b-d0cc-4452-a467-362d7ae42f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031d5a53ca0>]}
[0m23:30:34.932319 [info ] [MainThread]: 
[0m23:30:34.933670 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:30:34.934764 [info ] [MainThread]: 
[0m23:30:34.937399 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:30:34.939695 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:30:34.940444 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:30:37.064716 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:30:37.066235 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:30:37.867971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2404262b-d0cc-4452-a467-362d7ae42f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031a926aa40>]}
[0m23:30:37.869748 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:30:37.876885 [debug] [Thread-1 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m23:30:37.879357 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m23:30:37.882204 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.stg_kraftwerksdaten)
[0m23:30:37.884132 [debug] [Thread-1 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m23:30:37.909053 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m23:30:37.910865 [debug] [Thread-1 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m23:30:37.940656 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:30:38.620675 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m23:30:38.622133 [debug] [Thread-1 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
),

-- Calculate seasonal patterns for forecasting
seasonal_patterns AS (
    SELECT
        Kraftwerk,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        EXTRACT(DAYOFWEEK FROM Timestamp) AS day_of_week,
        -- Average load for each hour of each day of week (excluding last day)
        AVG(CASE WHEN NOT is_last_day THEN leistung END) AS avg_hourly_load,
        -- Weekly trend (7-day moving average)
        AVG(CASE WHEN NOT is_last_day THEN leistung END) OVER (
            PARTITION BY Kraftwerk, EXTRACT(HOUR FROM Timestamp)
            ORDER BY DATE(Timestamp)
            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW
        ) AS weekly_trend,
        -- Daily trend (24-hour moving average)
        AVG(CASE WHEN NOT is_last_day THEN leistung END) OVER (
            PARTITION BY Kraftwerk
            ORDER BY Timestamp
            ROWS BETWEEN 23 PRECEDING AND CURRENT ROW
        ) AS daily_trend
    FROM cleaned_data
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, EXTRACT(HOUR FROM Timestamp), EXTRACT(DAYOFWEEK FROM Timestamp), Timestamp, is_last_day
),

-- Generate forecasts for last day
forecasts AS (
    SELECT DISTINCT
        c.Kraftwerk,
        c.Timestamp,
        c.is_last_day,
        -- SARIMA-like forecast: combine seasonal patterns with trends
        CASE
            WHEN c.is_last_day THEN
                -- Base forecast from seasonal patterns
                COALESCE(
                    sp.avg_hourly_load,
                    -- Fallback to overall average if no seasonal data
                    AVG(c.leistung) OVER (PARTITION BY c.Kraftwerk)
                ) *
                -- Apply trend adjustment
                (1 + (sp.weekly_trend - sp.avg_hourly_load) / NULLIF(sp.avg_hourly_load, 0) * 0.3 +
                 (sp.daily_trend - sp.avg_hourly_load) / NULLIF(sp.avg_hourly_load, 0) * 0.2)
            ELSE NULL
        END AS prognose
    FROM cleaned_data c
    LEFT JOIN seasonal_patterns sp ON
        c.Kraftwerk = sp.Kraftwerk AND
        EXTRACT(HOUR FROM c.Timestamp) = sp.hour_of_day AND
        EXTRACT(DAYOFWEEK FROM c.Timestamp) = sp.day_of_week
    WHERE c.leistung IS NOT NULL OR c.is_last_day
)

SELECT
    c.Kraftwerk,
    c.Timestamp,
    EXTRACT(HOUR FROM c.Timestamp) AS hour_of_day,
    c.Zaehlerstand,
    c.is_decreasing_zaehlerstand,
    c.is_last_day,
    c.leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN c.leistung IS NOT NULL AND c.leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load,
    -- Add forecast column
    f.prognose
FROM cleaned_data c
LEFT JOIN forecasts f ON c.Kraftwerk = f.Kraftwerk AND c.Timestamp = f.Timestamp
WHERE c.Timestamp > TIMESTAMP('2024-01-01 00:00:00')
    );
  
[0m23:30:39.241501 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:daa90fcd-f41d-4680-8cb9-45bebd9c8f29&page=queryresults
[0m23:30:39.575952 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:daa90fcd-f41d-4680-8cb9-45bebd9c8f29&page=queryresults
[0m23:30:39.589719 [debug] [Thread-1 (]: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  SELECT list expression references column leistung which is neither grouped nor aggregated at [62:44]
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m23:30:39.594254 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2404262b-d0cc-4452-a467-362d7ae42f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031d41f7850>]}
[0m23:30:39.596751 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.stg_kraftwerksdaten ............. [[31mERROR[0m in 1.71s]
[0m23:30:39.599379 [debug] [Thread-1 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m23:30:39.601453 [debug] [Thread-7 (]: Marking all children of 'model.gasag.stg_kraftwerksdaten' to be skipped because of status 'error'.  Reason: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  SELECT list expression references column leistung which is neither grouped nor aggregated at [62:44]
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql.
[0m23:30:39.605963 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:30:39.607360 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:30:39.608391 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m23:30:39.609156 [info ] [MainThread]: 
[0m23:30:39.610158 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.67 seconds (4.67s).
[0m23:30:39.611847 [debug] [MainThread]: Command end result
[0m23:30:39.667614 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:30:39.671390 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:30:39.685075 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:30:39.685793 [info ] [MainThread]: 
[0m23:30:39.686545 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:30:39.687205 [info ] [MainThread]: 
[0m23:30:39.687981 [error] [MainThread]: [31mFailure in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)[0m
[0m23:30:39.688774 [error] [MainThread]:   Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  SELECT list expression references column leistung which is neither grouped nor aggregated at [62:44]
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m23:30:39.689379 [info ] [MainThread]: 
[0m23:30:39.690083 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/staging/stg_kraftwerksdaten.sql
[0m23:30:39.690745 [info ] [MainThread]: 
[0m23:30:39.692058 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:30:39.694734 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 10.017395, "process_in_blocks": "0", "process_kernel_time": 0.573449, "process_mem_max_rss": "369372", "process_out_blocks": "3136", "process_user_time": 8.21678}
[0m23:30:39.696639 [debug] [MainThread]: Command `dbt run` failed at 23:30:39.696331 after 10.02 seconds
[0m23:30:39.698176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031d3e73e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031d569a1a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7031a93d68c0>]}
[0m23:30:39.700243 [debug] [MainThread]: Flushing usage events
[0m23:30:40.561868 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:31:10.867010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72804de83e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72804ccf6ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72804ccf6f20>]}


============================== 23:31:10.871936 | 158d7fb3-3ed0-47a1-b557-0b4b76604e8c ==============================
[0m23:31:10.871936 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:31:10.873880 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select stg_kraftwerksdaten', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:31:14.468694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '158d7fb3-3ed0-47a1-b557-0b4b76604e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72804fa4b760>]}
[0m23:31:14.613659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '158d7fb3-3ed0-47a1-b557-0b4b76604e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72804ccf5330>]}
[0m23:31:14.614629 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:31:14.947370 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:31:15.153011 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:31:15.155025 [debug] [MainThread]: Partial parsing: updated file: gasag://models/staging/stg_kraftwerksdaten.sql
[0m23:31:15.758196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '158d7fb3-3ed0-47a1-b557-0b4b76604e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728022d837c0>]}
[0m23:31:15.895208 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:31:15.897468 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:31:15.914810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '158d7fb3-3ed0-47a1-b557-0b4b76604e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728021b4cbe0>]}
[0m23:31:15.915605 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m23:31:15.916211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '158d7fb3-3ed0-47a1-b557-0b4b76604e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728021b4cd00>]}
[0m23:31:15.918758 [info ] [MainThread]: 
[0m23:31:15.919579 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:31:15.920409 [info ] [MainThread]: 
[0m23:31:15.921524 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:31:15.923316 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:31:15.924198 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:31:17.923080 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:31:17.925096 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:31:18.649671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '158d7fb3-3ed0-47a1-b557-0b4b76604e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72804ccba830>]}
[0m23:31:18.654422 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:31:18.667126 [debug] [Thread-1 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m23:31:18.670198 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m23:31:18.673033 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.stg_kraftwerksdaten)
[0m23:31:18.674126 [debug] [Thread-1 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m23:31:18.690467 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m23:31:18.691586 [debug] [Thread-1 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m23:31:18.717093 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:31:19.419200 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m23:31:19.421809 [debug] [Thread-1 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
),

-- Calculate seasonal patterns for forecasting
seasonal_patterns AS (
    SELECT
        Kraftwerk,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        EXTRACT(DAYOFWEEK FROM Timestamp) AS day_of_week,
        -- Average load for each hour of each day of week (excluding last day)
        AVG(CASE WHEN NOT is_last_day THEN leistung END) AS avg_hourly_load
    FROM cleaned_data
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, EXTRACT(HOUR FROM Timestamp), EXTRACT(DAYOFWEEK FROM Timestamp)
),

-- Calculate overall averages as fallback
overall_averages AS (
    SELECT
        Kraftwerk,
        AVG(leistung) AS overall_avg_load
    FROM cleaned_data
    WHERE leistung IS NOT NULL AND NOT is_last_day
    GROUP BY Kraftwerk
)

SELECT
    c.Kraftwerk,
    c.Timestamp,
    EXTRACT(HOUR FROM c.Timestamp) AS hour_of_day,
    c.Zaehlerstand,
    c.is_decreasing_zaehlerstand,
    c.is_last_day,
    c.leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN c.leistung IS NOT NULL AND c.leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load,
    -- Add forecast column (SARIMA-like)
    CASE
        WHEN c.is_last_day THEN
            COALESCE(
                sp.avg_hourly_load,
                oa.overall_avg_load
            )
        ELSE NULL
    END AS prognose
FROM cleaned_data c
LEFT JOIN seasonal_patterns sp ON
    c.Kraftwerk = sp.Kraftwerk AND
    EXTRACT(HOUR FROM c.Timestamp) = sp.hour_of_day AND
    EXTRACT(DAYOFWEEK FROM c.Timestamp) = sp.day_of_week
LEFT JOIN overall_averages oa ON c.Kraftwerk = oa.Kraftwerk
WHERE c.Timestamp > TIMESTAMP('2024-01-01 00:00:00')
    );
  
[0m23:31:20.031378 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:47f3a4a8-3571-46d2-b55b-abe8edf8b896&page=queryresults
[0m23:31:23.829288 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '158d7fb3-3ed0-47a1-b557-0b4b76604e8c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72802c011690>]}
[0m23:31:23.831037 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.stg_kraftwerksdaten ................. [[32mCREATE TABLE (5.0k rows, 190.4 KiB processed)[0m in 5.15s]
[0m23:31:23.833890 [debug] [Thread-1 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m23:31:23.837844 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:31:23.839400 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:31:23.840112 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m23:31:23.840794 [info ] [MainThread]: 
[0m23:31:23.841427 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 7.92 seconds (7.92s).
[0m23:31:23.842580 [debug] [MainThread]: Command end result
[0m23:31:23.882792 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:31:23.886319 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:31:23.899025 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:31:23.900194 [info ] [MainThread]: 
[0m23:31:23.901130 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:31:23.902575 [info ] [MainThread]: 
[0m23:31:23.903452 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:31:23.905172 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.170204, "process_in_blocks": "0", "process_kernel_time": 0.555087, "process_mem_max_rss": "372520", "process_out_blocks": "3096", "process_user_time": 8.343278}
[0m23:31:23.906516 [debug] [MainThread]: Command `dbt run` succeeded at 23:31:23.906224 after 13.17 seconds
[0m23:31:23.907535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72804de83e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728021b20ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72804ccf5330>]}
[0m23:31:23.908384 [debug] [MainThread]: Flushing usage events
[0m23:31:24.901836 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:44:42.834557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667eeb8be50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667eda02ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667eda02f20>]}


============================== 23:44:42.838606 | c5a6f7bc-1056-4c97-89f7-ce3942c7b39a ==============================
[0m23:44:42.838606 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:44:42.839845 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select stg_kraftwerksdaten', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:44:46.307052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c5a6f7bc-1056-4c97-89f7-ce3942c7b39a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667edb46cb0>]}
[0m23:44:46.465728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c5a6f7bc-1056-4c97-89f7-ce3942c7b39a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667eeb05cc0>]}
[0m23:44:46.467522 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:44:46.843524 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:44:47.035914 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:44:47.037149 [debug] [MainThread]: Partial parsing: updated file: gasag://models/staging/stg_kraftwerksdaten.sql
[0m23:44:47.593535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c5a6f7bc-1056-4c97-89f7-ce3942c7b39a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667c27512a0>]}
[0m23:44:47.728528 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:44:47.730816 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:44:47.746407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c5a6f7bc-1056-4c97-89f7-ce3942c7b39a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667c3b1b100>]}
[0m23:44:47.747246 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m23:44:47.747875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5a6f7bc-1056-4c97-89f7-ce3942c7b39a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667f0527130>]}
[0m23:44:47.749768 [info ] [MainThread]: 
[0m23:44:47.750396 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:44:47.751001 [info ] [MainThread]: 
[0m23:44:47.752352 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:44:47.754199 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:44:47.756393 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:44:49.964314 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:44:49.965784 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:44:50.599673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5a6f7bc-1056-4c97-89f7-ce3942c7b39a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667c3e8ea40>]}
[0m23:44:50.601788 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:44:50.612255 [debug] [Thread-1 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m23:44:50.614289 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m23:44:50.616040 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.stg_kraftwerksdaten)
[0m23:44:50.617903 [debug] [Thread-1 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m23:44:50.642512 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m23:44:50.643686 [debug] [Thread-1 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m23:44:50.667090 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:44:51.378948 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m23:44:51.380459 [debug] [Thread-1 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
),

-- Calculate seasonal patterns for forecasting
seasonal_patterns AS (
    SELECT
        Kraftwerk,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        EXTRACT(DAYOFWEEK FROM Timestamp) AS day_of_week,
        -- Average load for each hour of each day of week (excluding last day)
        AVG(CASE WHEN NOT is_last_day THEN leistung END) AS avg_hourly_load
    FROM cleaned_data
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, EXTRACT(HOUR FROM Timestamp), EXTRACT(DAYOFWEEK FROM Timestamp)
),

-- Calculate overall averages as fallback
overall_averages AS (
    SELECT
        Kraftwerk,
        AVG(leistung) AS overall_avg_load
    FROM cleaned_data
    WHERE leistung IS NOT NULL AND NOT is_last_day
    GROUP BY Kraftwerk
),

-- Generate all hours for the last day (0-23)
last_day_hours AS (
    SELECT
        DISTINCT Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM max_date), DAY),
            INTERVAL hour HOUR
        ) AS Timestamp,
        hour AS hour_of_day
    FROM cleaned_data c
    CROSS JOIN UNNEST(GENERATE_ARRAY(0, 23)) AS hour
    WHERE c.is_last_day
),

-- Combine actual data with forecast data
combined_data AS (
    -- Actual data (all days)
    SELECT
        Kraftwerk,
        Timestamp,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        is_last_day,
        leistung,
        FALSE AS is_forecast
    FROM cleaned_data

    UNION ALL

    -- Forecast data for missing hours of last day
    SELECT
        ldh.Kraftwerk,
        ldh.Timestamp,
        ldh.hour_of_day,
        NULL AS Zaehlerstand,
        FALSE AS is_decreasing_zaehlerstand,
        TRUE AS is_last_day,
        NULL AS leistung,
        TRUE AS is_forecast
    FROM last_day_hours ldh
    WHERE NOT EXISTS (
        SELECT 1 FROM cleaned_data cd
        WHERE cd.Kraftwerk = ldh.Kraftwerk
        AND cd.Timestamp = ldh.Timestamp
    )
)

SELECT
    c.Kraftwerk,
    c.Timestamp,
    c.hour_of_day,
    c.Zaehlerstand,
    c.is_decreasing_zaehlerstand,
    c.is_last_day,
    c.leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN c.leistung IS NOT NULL AND c.leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load,
    -- Add forecast column (SARIMA-like)
    CASE
        WHEN c.is_forecast THEN
            COALESCE(
                sp.avg_hourly_load,
                oa.overall_avg_load
            )
        ELSE NULL
    END AS prognose
FROM combined_data c
LEFT JOIN seasonal_patterns sp ON
    c.Kraftwerk = sp.Kraftwerk AND
    c.hour_of_day = sp.hour_of_day AND
    EXTRACT(DAYOFWEEK FROM c.Timestamp) = sp.day_of_week
LEFT JOIN overall_averages oa ON c.Kraftwerk = oa.Kraftwerk
WHERE c.Timestamp > TIMESTAMP('2024-01-01 00:00:00')
ORDER BY c.Kraftwerk, c.Timestamp
    );
  
[0m23:44:52.029765 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:bac939db-1ac5-41d4-abe2-beedf90e65a7&page=queryresults
[0m23:44:52.312405 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:bac939db-1ac5-41d4-abe2-beedf90e65a7&page=queryresults
[0m23:44:52.322578 [debug] [Thread-1 (]: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  No matching signature for operator = for argument types: TIMESTAMP, DATETIME
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {TIMESTAMP, DATETIME} at [120:13]
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m23:44:52.329803 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5a6f7bc-1056-4c97-89f7-ce3942c7b39a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667eed13850>]}
[0m23:44:52.331989 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.stg_kraftwerksdaten ............. [[31mERROR[0m in 1.71s]
[0m23:44:52.334456 [debug] [Thread-1 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m23:44:52.336546 [debug] [Thread-7 (]: Marking all children of 'model.gasag.stg_kraftwerksdaten' to be skipped because of status 'error'.  Reason: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  No matching signature for operator = for argument types: TIMESTAMP, DATETIME
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {TIMESTAMP, DATETIME} at [120:13]
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql.
[0m23:44:52.341112 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:44:52.342754 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:44:52.343566 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m23:44:52.344524 [info ] [MainThread]: 
[0m23:44:52.345534 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.59 seconds (4.59s).
[0m23:44:52.347139 [debug] [MainThread]: Command end result
[0m23:44:52.392761 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:44:52.396971 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:44:52.416227 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:44:52.417909 [info ] [MainThread]: 
[0m23:44:52.419356 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:44:52.420644 [info ] [MainThread]: 
[0m23:44:52.422178 [error] [MainThread]: [31mFailure in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)[0m
[0m23:44:52.423725 [error] [MainThread]:   Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  No matching signature for operator = for argument types: TIMESTAMP, DATETIME
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {TIMESTAMP, DATETIME} at [120:13]
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m23:44:52.425100 [info ] [MainThread]: 
[0m23:44:52.428595 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/staging/stg_kraftwerksdaten.sql
[0m23:44:52.431315 [info ] [MainThread]: 
[0m23:44:52.435011 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:44:52.438638 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 9.726273, "process_in_blocks": "0", "process_kernel_time": 0.566563, "process_mem_max_rss": "369396", "process_out_blocks": "3136", "process_user_time": 8.021505}
[0m23:44:52.440941 [debug] [MainThread]: Command `dbt run` failed at 23:44:52.440644 after 9.73 seconds
[0m23:44:52.442350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667eeb8be50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667f03861a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7667c3e028c0>]}
[0m23:44:52.445100 [debug] [MainThread]: Flushing usage events
[0m23:44:53.873794 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:45:38.364136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ae38bdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ad202ef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ad202f50>]}


============================== 23:45:38.368525 | bd289cd2-25a8-4ba9-b219-14a1b09286d1 ==============================
[0m23:45:38.368525 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:45:38.370360 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select stg_kraftwerksdaten', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m23:45:41.828815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bd289cd2-25a8-4ba9-b219-14a1b09286d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2afe7f6a0>]}
[0m23:45:41.976970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bd289cd2-25a8-4ba9-b219-14a1b09286d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ad4195a0>]}
[0m23:45:41.977968 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:45:42.283074 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:45:42.474576 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:45:42.475515 [debug] [MainThread]: Partial parsing: updated file: gasag://models/staging/stg_kraftwerksdaten.sql
[0m23:45:43.009933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bd289cd2-25a8-4ba9-b219-14a1b09286d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca281f57fa0>]}
[0m23:45:43.131857 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:45:43.134356 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:45:43.151675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bd289cd2-25a8-4ba9-b219-14a1b09286d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca281f57250>]}
[0m23:45:43.153211 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m23:45:43.154270 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd289cd2-25a8-4ba9-b219-14a1b09286d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca281f56c20>]}
[0m23:45:43.157131 [info ] [MainThread]: 
[0m23:45:43.157889 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:45:43.158476 [info ] [MainThread]: 
[0m23:45:43.159292 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:45:43.160715 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:45:43.161451 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:45:45.292217 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:45:45.293812 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:45:45.934361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bd289cd2-25a8-4ba9-b219-14a1b09286d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2aef517b0>]}
[0m23:45:45.935662 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:45:45.941398 [debug] [Thread-1 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m23:45:45.942620 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m23:45:45.943932 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.stg_kraftwerksdaten)
[0m23:45:45.944775 [debug] [Thread-1 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m23:45:45.962901 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m23:45:45.964023 [debug] [Thread-1 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m23:45:45.993025 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:45:46.737632 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m23:45:46.738952 [debug] [Thread-1 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
),

-- Calculate seasonal patterns for forecasting
seasonal_patterns AS (
    SELECT
        Kraftwerk,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        EXTRACT(DAYOFWEEK FROM Timestamp) AS day_of_week,
        -- Average load for each hour of each day of week (excluding last day)
        AVG(CASE WHEN NOT is_last_day THEN leistung END) AS avg_hourly_load
    FROM cleaned_data
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, EXTRACT(HOUR FROM Timestamp), EXTRACT(DAYOFWEEK FROM Timestamp)
),

-- Calculate overall averages as fallback
overall_averages AS (
    SELECT
        Kraftwerk,
        AVG(leistung) AS overall_avg_load
    FROM cleaned_data
    WHERE leistung IS NOT NULL AND NOT is_last_day
    GROUP BY Kraftwerk
),

-- Generate all hours for the last day (0-23)
last_day_hours AS (
    SELECT
        DISTINCT Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM max_date), DAY),
            INTERVAL hour HOUR
        ) AS Timestamp,
        hour AS hour_of_day
    FROM cleaned_data c
    CROSS JOIN UNNEST(GENERATE_ARRAY(0, 23)) AS hour
    WHERE c.is_last_day
),

-- Combine actual data with forecast data
combined_data AS (
    -- Actual data (all days)
    SELECT
        Kraftwerk,
        Timestamp,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        is_last_day,
        leistung,
        FALSE AS is_forecast
    FROM cleaned_data

    UNION ALL

    -- Forecast data for missing hours of last day
    SELECT
        ldh.Kraftwerk,
        ldh.Timestamp,
        ldh.hour_of_day,
        NULL AS Zaehlerstand,
        FALSE AS is_decreasing_zaehlerstand,
        TRUE AS is_last_day,
        NULL AS leistung,
        TRUE AS is_forecast
    FROM last_day_hours ldh
    WHERE NOT EXISTS (
        SELECT 1 FROM cleaned_data cd
        WHERE cd.Kraftwerk = ldh.Kraftwerk
        AND CAST(cd.Timestamp AS TIMESTAMP) = CAST(ldh.Timestamp AS TIMESTAMP)
    )
)

SELECT
    c.Kraftwerk,
    c.Timestamp,
    c.hour_of_day,
    c.Zaehlerstand,
    c.is_decreasing_zaehlerstand,
    c.is_last_day,
    c.leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN c.leistung IS NOT NULL AND c.leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load,
    -- Add forecast column (SARIMA-like)
    CASE
        WHEN c.is_forecast THEN
            COALESCE(
                sp.avg_hourly_load,
                oa.overall_avg_load
            )
        ELSE NULL
    END AS prognose
FROM combined_data c
LEFT JOIN seasonal_patterns sp ON
    c.Kraftwerk = sp.Kraftwerk AND
    c.hour_of_day = sp.hour_of_day AND
    EXTRACT(DAYOFWEEK FROM c.Timestamp) = sp.day_of_week
LEFT JOIN overall_averages oa ON c.Kraftwerk = oa.Kraftwerk
WHERE c.Timestamp > TIMESTAMP('2024-01-01 00:00:00')
ORDER BY c.Kraftwerk, c.Timestamp
    );
  
[0m23:45:47.374665 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:7d31e167-70c2-4acb-9403-07c7022f241b&page=queryresults
[0m23:45:47.737710 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:7d31e167-70c2-4acb-9403-07c7022f241b&page=queryresults
[0m23:45:47.742229 [debug] [Thread-1 (]: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Column 2 in UNION ALL has incompatible types: TIMESTAMP, DATETIME at [107:5]
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m23:45:47.744927 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bd289cd2-25a8-4ba9-b219-14a1b09286d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ae6e51e0>]}
[0m23:45:47.746092 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.stg_kraftwerksdaten ............. [[31mERROR[0m in 1.80s]
[0m23:45:47.747180 [debug] [Thread-1 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m23:45:47.748441 [debug] [Thread-7 (]: Marking all children of 'model.gasag.stg_kraftwerksdaten' to be skipped because of status 'error'.  Reason: Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Column 2 in UNION ALL has incompatible types: TIMESTAMP, DATETIME at [107:5]
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql.
[0m23:45:47.752098 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:45:47.754282 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:45:47.755579 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m23:45:47.756742 [info ] [MainThread]: 
[0m23:45:47.757960 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.60 seconds (4.60s).
[0m23:45:47.759791 [debug] [MainThread]: Command end result
[0m23:45:47.817126 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:45:47.820135 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:45:47.838643 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:45:47.839591 [info ] [MainThread]: 
[0m23:45:47.841542 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:45:47.842729 [info ] [MainThread]: 
[0m23:45:47.843550 [error] [MainThread]: [31mFailure in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)[0m
[0m23:45:47.844334 [error] [MainThread]:   Database Error in model stg_kraftwerksdaten (models/staging/stg_kraftwerksdaten.sql)
  Column 2 in UNION ALL has incompatible types: TIMESTAMP, DATETIME at [107:5]
  compiled code at target/run/gasag/models/staging/stg_kraftwerksdaten.sql
[0m23:45:47.845481 [info ] [MainThread]: 
[0m23:45:47.846627 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/staging/stg_kraftwerksdaten.sql
[0m23:45:47.847260 [info ] [MainThread]: 
[0m23:45:47.847948 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:45:47.850519 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 9.613283, "process_in_blocks": "0", "process_kernel_time": 0.489034, "process_mem_max_rss": "369348", "process_out_blocks": "3144", "process_user_time": 7.639538}
[0m23:45:47.851828 [debug] [MainThread]: Command `dbt run` failed at 23:45:47.851506 after 9.61 seconds
[0m23:45:47.853333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ae38bdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2afe7f6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca283605e70>]}
[0m23:45:47.855287 [debug] [MainThread]: Flushing usage events
[0m23:45:48.760085 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:46:25.860231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d53478bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d533602ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d533602f20>]}


============================== 23:46:25.866125 | 26ba46e4-706b-4582-af35-5ad629fc0ae3 ==============================
[0m23:46:25.866125 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:46:25.867538 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select stg_kraftwerksdaten', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:46:29.184075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '26ba46e4-706b-4582-af35-5ad629fc0ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d509a02860>]}
[0m23:46:29.326917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '26ba46e4-706b-4582-af35-5ad629fc0ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d533601330>]}
[0m23:46:29.327918 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:46:29.647628 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:46:29.839291 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:46:29.840757 [debug] [MainThread]: Partial parsing: updated file: gasag://models/staging/stg_kraftwerksdaten.sql
[0m23:46:30.461098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '26ba46e4-706b-4582-af35-5ad629fc0ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d509b3ab60>]}
[0m23:46:30.601002 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:46:30.604424 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:46:30.625216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '26ba46e4-706b-4582-af35-5ad629fc0ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d508350d90>]}
[0m23:46:30.626397 [info ] [MainThread]: Found 3 models, 1 source, 493 macros
[0m23:46:30.627217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '26ba46e4-706b-4582-af35-5ad629fc0ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d508350e20>]}
[0m23:46:30.629382 [info ] [MainThread]: 
[0m23:46:30.630661 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:46:30.631769 [info ] [MainThread]: 
[0m23:46:30.632962 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:46:30.634361 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:46:30.635108 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:46:32.341129 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:46:32.342642 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:46:33.089039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '26ba46e4-706b-4582-af35-5ad629fc0ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d5335c67a0>]}
[0m23:46:33.091203 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:46:33.098206 [debug] [Thread-1 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m23:46:33.100118 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m23:46:33.101811 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.stg_kraftwerksdaten)
[0m23:46:33.104151 [debug] [Thread-1 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m23:46:33.128543 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m23:46:33.129862 [debug] [Thread-1 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m23:46:33.154312 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:46:33.879874 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m23:46:33.881121 [debug] [Thread-1 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
),

-- Calculate seasonal patterns for forecasting
seasonal_patterns AS (
    SELECT
        Kraftwerk,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        EXTRACT(DAYOFWEEK FROM Timestamp) AS day_of_week,
        -- Average load for each hour of each day of week (excluding last day)
        AVG(CASE WHEN NOT is_last_day THEN leistung END) AS avg_hourly_load
    FROM cleaned_data
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, EXTRACT(HOUR FROM Timestamp), EXTRACT(DAYOFWEEK FROM Timestamp)
),

-- Calculate overall averages as fallback
overall_averages AS (
    SELECT
        Kraftwerk,
        AVG(leistung) AS overall_avg_load
    FROM cleaned_data
    WHERE leistung IS NOT NULL AND NOT is_last_day
    GROUP BY Kraftwerk
),

-- Generate all hours for the last day (0-23)
last_day_hours AS (
    SELECT
        DISTINCT Kraftwerk,
        CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM max_date), DAY),
            INTERVAL hour HOUR
        ) AS TIMESTAMP) AS Timestamp,
        hour AS hour_of_day
    FROM cleaned_data c
    CROSS JOIN UNNEST(GENERATE_ARRAY(0, 23)) AS hour
    WHERE c.is_last_day
),

-- Combine actual data with forecast data
combined_data AS (
    -- Actual data (all days)
    SELECT
        Kraftwerk,
        Timestamp,
        EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        is_last_day,
        leistung,
        FALSE AS is_forecast
    FROM cleaned_data

    UNION ALL

    -- Forecast data for missing hours of last day
    SELECT
        ldh.Kraftwerk,
        ldh.Timestamp,
        ldh.hour_of_day,
        NULL AS Zaehlerstand,
        FALSE AS is_decreasing_zaehlerstand,
        TRUE AS is_last_day,
        NULL AS leistung,
        TRUE AS is_forecast
    FROM last_day_hours ldh
    WHERE NOT EXISTS (
        SELECT 1 FROM cleaned_data cd
        WHERE cd.Kraftwerk = ldh.Kraftwerk
        AND cd.Timestamp = ldh.Timestamp
    )
)

SELECT
    c.Kraftwerk,
    c.Timestamp,
    c.hour_of_day,
    c.Zaehlerstand,
    c.is_decreasing_zaehlerstand,
    c.is_last_day,
    c.leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN c.leistung IS NOT NULL AND c.leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load,
    -- Add forecast column (SARIMA-like)
    CASE
        WHEN c.is_forecast THEN
            COALESCE(
                sp.avg_hourly_load,
                oa.overall_avg_load
            )
        ELSE NULL
    END AS prognose
FROM combined_data c
LEFT JOIN seasonal_patterns sp ON
    c.Kraftwerk = sp.Kraftwerk AND
    c.hour_of_day = sp.hour_of_day AND
    EXTRACT(DAYOFWEEK FROM c.Timestamp) = sp.day_of_week
LEFT JOIN overall_averages oa ON c.Kraftwerk = oa.Kraftwerk
WHERE c.Timestamp > TIMESTAMP('2024-01-01 00:00:00')
ORDER BY c.Kraftwerk, c.Timestamp
    );
  
[0m23:46:34.500617 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:40e3ffea-355c-43a9-bfe9-e0ac5e0b4f0c&page=queryresults
[0m23:46:37.862712 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '26ba46e4-706b-4582-af35-5ad629fc0ae3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d509bc3c70>]}
[0m23:46:37.863920 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.stg_kraftwerksdaten ................. [[32mCREATE TABLE (5.0k rows, 190.4 KiB processed)[0m in 4.76s]
[0m23:46:37.865067 [debug] [Thread-1 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m23:46:37.866905 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:46:37.868866 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:46:37.869993 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m23:46:37.870981 [info ] [MainThread]: 
[0m23:46:37.871883 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 7.24 seconds (7.24s).
[0m23:46:37.873587 [debug] [MainThread]: Command end result
[0m23:46:37.916410 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:46:37.919821 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:46:37.930815 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:46:37.931482 [info ] [MainThread]: 
[0m23:46:37.932266 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:46:37.933019 [info ] [MainThread]: 
[0m23:46:37.933967 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:46:37.936666 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.20492, "process_in_blocks": "0", "process_kernel_time": 0.513426, "process_mem_max_rss": "372680", "process_out_blocks": "3144", "process_user_time": 7.978553}
[0m23:46:37.937986 [debug] [MainThread]: Command `dbt run` succeeded at 23:46:37.937716 after 12.21 seconds
[0m23:46:37.938723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d53478bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d50945e440>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79d509a02860>]}
[0m23:46:37.939756 [debug] [MainThread]: Flushing usage events
[0m23:46:39.025492 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:51:05.701493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae89b84bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae89a69aec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae89a69af20>]}


============================== 23:51:05.706982 | 1bb0934c-5503-4f1b-a432-03164a7827e5 ==============================
[0m23:51:05.706982 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:51:05.708026 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/home/anton/.dbt', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select stg_kraftwerksdaten', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:51:09.188415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1bb0934c-5503-4f1b-a432-03164a7827e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae870ce6860>]}
[0m23:51:09.339818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1bb0934c-5503-4f1b-a432-03164a7827e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae89a699330>]}
[0m23:51:09.340884 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:51:09.699399 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:51:09.900070 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 1 files changed.
[0m23:51:09.901675 [debug] [MainThread]: Partial parsing: added file: gasag://models/marts/arima_forecast.sql
[0m23:51:09.902509 [debug] [MainThread]: Partial parsing: added file: gasag://models/marts/arima_predictions.sql
[0m23:51:09.903852 [debug] [MainThread]: Partial parsing: updated file: gasag://models/staging/stg_kraftwerksdaten.sql
[0m23:51:10.498978 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1bb0934c-5503-4f1b-a432-03164a7827e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae870625ea0>]}
[0m23:51:10.645203 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:51:10.647562 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:51:10.664911 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1bb0934c-5503-4f1b-a432-03164a7827e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae8709fa4a0>]}
[0m23:51:10.665728 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m23:51:10.666686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1bb0934c-5503-4f1b-a432-03164a7827e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae870747d90>]}
[0m23:51:10.670242 [info ] [MainThread]: 
[0m23:51:10.672281 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:51:10.673729 [info ] [MainThread]: 
[0m23:51:10.674780 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:51:10.676280 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:51:10.677057 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:51:12.604269 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:51:12.606093 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:51:13.278595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1bb0934c-5503-4f1b-a432-03164a7827e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae89a85a7a0>]}
[0m23:51:13.280924 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:51:13.290643 [debug] [Thread-1 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m23:51:13.292727 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m23:51:13.294113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.stg_kraftwerksdaten)
[0m23:51:13.295003 [debug] [Thread-1 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m23:51:13.311719 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m23:51:13.312755 [debug] [Thread-1 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m23:51:13.338553 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:51:14.052240 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m23:51:14.055250 [debug] [Thread-1 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
)

SELECT
    Kraftwerk,
    Timestamp,
    EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
    Zaehlerstand,
    is_decreasing_zaehlerstand,
    is_last_day,
    leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN leistung IS NOT NULL AND leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load,
    -- Flag for forecast data (will be populated by ARIMA model)
    FALSE AS is_forecast,
    -- Prognose will be populated by ARIMA model
    NULL AS prognose
FROM cleaned_data
WHERE Timestamp > TIMESTAMP('2024-01-01 00:00:00')
ORDER BY Kraftwerk, Timestamp
    );
  
[0m23:51:14.915705 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:9d08e4da-b43f-4e43-b158-848cba0dea81&page=queryresults
[0m23:51:17.816038 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1bb0934c-5503-4f1b-a432-03164a7827e5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae875af4220>]}
[0m23:51:17.817794 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.stg_kraftwerksdaten ................. [[32mCREATE TABLE (5.0k rows, 190.4 KiB processed)[0m in 4.52s]
[0m23:51:17.820831 [debug] [Thread-1 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m23:51:17.823102 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:51:17.824489 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:51:17.825178 [debug] [MainThread]: Connection 'model.gasag.stg_kraftwerksdaten' was properly closed.
[0m23:51:17.826076 [info ] [MainThread]: 
[0m23:51:17.826896 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 7.15 seconds (7.15s).
[0m23:51:17.828013 [debug] [MainThread]: Command end result
[0m23:51:17.892074 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:51:17.895238 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:51:17.912636 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:51:17.913943 [info ] [MainThread]: 
[0m23:51:17.915184 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:51:17.916201 [info ] [MainThread]: 
[0m23:51:17.917078 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:51:17.920191 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.344381, "process_in_blocks": "0", "process_kernel_time": 0.543132, "process_mem_max_rss": "372272", "process_out_blocks": "3120", "process_user_time": 8.362646}
[0m23:51:17.922401 [debug] [MainThread]: Command `dbt run` succeeded at 23:51:17.922099 after 12.35 seconds
[0m23:51:17.923784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae89b84bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae89d383640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ae870511660>]}
[0m23:51:17.925086 [debug] [MainThread]: Flushing usage events
[0m23:51:19.606835 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:51:36.230800 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732333483e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7323322faec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7323322faf20>]}


============================== 23:51:36.236752 | 18820e37-aa73-47f1-9d4f-fb10545066b0 ==============================
[0m23:51:36.236752 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:51:36.237879 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select arima_forecast', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m23:51:39.598764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18820e37-aa73-47f1-9d4f-fb10545066b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732334f7b760>]}
[0m23:51:39.751074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18820e37-aa73-47f1-9d4f-fb10545066b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7323322f9330>]}
[0m23:51:39.752065 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:51:40.092915 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:51:40.296893 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:51:40.297669 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:51:40.364046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18820e37-aa73-47f1-9d4f-fb10545066b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732308245180>]}
[0m23:51:40.496962 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:51:40.499373 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:51:40.515369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18820e37-aa73-47f1-9d4f-fb10545066b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7323083f6110>]}
[0m23:51:40.516203 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m23:51:40.516867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18820e37-aa73-47f1-9d4f-fb10545066b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732308246ec0>]}
[0m23:51:40.518722 [info ] [MainThread]: 
[0m23:51:40.519404 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:51:40.520015 [info ] [MainThread]: 
[0m23:51:40.520982 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:51:40.522373 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:51:40.523262 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:51:42.383515 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:51:42.387290 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:51:43.073710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18820e37-aa73-47f1-9d4f-fb10545066b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7323322be830>]}
[0m23:51:43.076966 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:51:43.088944 [debug] [Thread-1 (]: Began running node model.gasag.arima_forecast
[0m23:51:43.094126 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_forecast ........................... [RUN]
[0m23:51:43.098980 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_forecast)
[0m23:51:43.101620 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_forecast
[0m23:51:43.163868 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_forecast"
[0m23:51:43.167812 [debug] [Thread-1 (]: Began executing node model.gasag.arima_forecast
[0m23:51:43.253065 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_forecast"
[0m23:51:43.254109 [debug] [Thread-1 (]: On model.gasag.arima_forecast: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_forecast"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_forecast`
      
    
    

    OPTIONS()
    as (
      -- Create ARIMA_PLUS model for time series forecasting
CREATE OR REPLACE MODEL `gasag-465208.analysis.arima_forecast`
OPTIONS(
  model_type='ARIMA_PLUS',
  time_series_timestamp_col='Timestamp',
  time_series_data_col='leistung',
  time_series_id_col='Kraftwerk',
  auto_arima=TRUE,
  data_frequency='HOURLY',
  holiday_region='DE'  -- German holidays
) AS
SELECT
  Timestamp,
  Kraftwerk,
  leistung
FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
WHERE leistung IS NOT NULL
  AND NOT is_forecast  -- Only use actual measurements for training
    );
  
[0m23:51:43.254843 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:51:44.197530 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:cb32b540-32dc-46d3-bb63-4cd733e5a62e&page=queryresults
[0m23:51:44.200578 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:cb32b540-32dc-46d3-bb63-4cd733e5a62e&page=queryresults
[0m23:51:44.213746 [debug] [Thread-1 (]: Database Error in model arima_forecast (models/marts/arima_forecast.sql)
  Syntax error: Unexpected keyword CREATE at [14:1]
  compiled code at target/run/gasag/models/marts/arima_forecast.sql
[0m23:51:44.222863 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18820e37-aa73-47f1-9d4f-fb10545066b0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732333605420>]}
[0m23:51:44.227951 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.arima_forecast .................. [[31mERROR[0m in 1.12s]
[0m23:51:44.232735 [debug] [Thread-1 (]: Finished running node model.gasag.arima_forecast
[0m23:51:44.235945 [debug] [Thread-7 (]: Marking all children of 'model.gasag.arima_forecast' to be skipped because of status 'error'.  Reason: Database Error in model arima_forecast (models/marts/arima_forecast.sql)
  Syntax error: Unexpected keyword CREATE at [14:1]
  compiled code at target/run/gasag/models/marts/arima_forecast.sql.
[0m23:51:44.244857 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:51:44.248910 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:51:44.251513 [debug] [MainThread]: Connection 'model.gasag.arima_forecast' was properly closed.
[0m23:51:44.253878 [info ] [MainThread]: 
[0m23:51:44.257202 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.73 seconds (3.73s).
[0m23:51:44.262130 [debug] [MainThread]: Command end result
[0m23:51:44.344672 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:51:44.348083 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:51:44.360475 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:51:44.361754 [info ] [MainThread]: 
[0m23:51:44.362973 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:51:44.363845 [info ] [MainThread]: 
[0m23:51:44.364752 [error] [MainThread]: [31mFailure in model arima_forecast (models/marts/arima_forecast.sql)[0m
[0m23:51:44.365894 [error] [MainThread]:   Database Error in model arima_forecast (models/marts/arima_forecast.sql)
  Syntax error: Unexpected keyword CREATE at [14:1]
  compiled code at target/run/gasag/models/marts/arima_forecast.sql
[0m23:51:44.366669 [info ] [MainThread]: 
[0m23:51:44.367502 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/arima_forecast.sql
[0m23:51:44.368222 [info ] [MainThread]: 
[0m23:51:44.369102 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:51:44.370851 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.270962, "process_in_blocks": "0", "process_kernel_time": 0.5094, "process_mem_max_rss": "359664", "process_out_blocks": "2104", "process_user_time": 7.680956}
[0m23:51:44.371964 [debug] [MainThread]: Command `dbt run` failed at 23:51:44.371766 after 8.27 seconds
[0m23:51:44.373470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x732333483e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7323322f9330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7323333f4a90>]}
[0m23:51:44.374524 [debug] [MainThread]: Flushing usage events
[0m23:51:45.732310 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:52:45.315949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791227873df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7912266eaec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7912266eaf20>]}


============================== 23:52:45.319490 | bf38cb0c-3f75-4a6a-9cb2-573aed6e46de ==============================
[0m23:52:45.319490 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:52:45.320871 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select arima_forecast', 'send_anonymous_usage_stats': 'True'}
[0m23:52:48.296355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bf38cb0c-3f75-4a6a-9cb2-573aed6e46de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7911fcdf2c50>]}
[0m23:52:48.426513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bf38cb0c-3f75-4a6a-9cb2-573aed6e46de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7912269055d0>]}
[0m23:52:48.427417 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:52:48.708834 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:52:48.868302 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 1 files changed.
[0m23:52:48.869516 [debug] [MainThread]: Partial parsing: added file: gasag://macros/create_arima_model.sql
[0m23:52:48.870477 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_forecast.sql
[0m23:52:49.373370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bf38cb0c-3f75-4a6a-9cb2-573aed6e46de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7911fc7c6e30>]}
[0m23:52:49.525429 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:52:49.529328 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:52:49.549063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bf38cb0c-3f75-4a6a-9cb2-573aed6e46de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7911fc8ed3f0>]}
[0m23:52:49.550017 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m23:52:49.550738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bf38cb0c-3f75-4a6a-9cb2-573aed6e46de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7911fc8ef460>]}
[0m23:52:49.553136 [info ] [MainThread]: 
[0m23:52:49.554213 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:52:49.555008 [info ] [MainThread]: 
[0m23:52:49.556068 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:52:49.566719 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208_analysis'
[0m23:52:49.568022 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:52:51.580335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bf38cb0c-3f75-4a6a-9cb2-573aed6e46de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7912294094b0>]}
[0m23:52:51.582831 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:52:51.593173 [debug] [Thread-1 (]: Began running node model.gasag.arima_forecast
[0m23:52:51.595539 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_forecast)
[0m23:52:51.597601 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_forecast
[0m23:52:51.628188 [debug] [Thread-1 (]: On model.gasag.arima_forecast: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_forecast"} */

    
        CREATE OR REPLACE MODEL `gasag-465208.analysis.arima_forecast`
        OPTIONS(
          model_type='ARIMA_PLUS',
          time_series_timestamp_col='Timestamp',
          time_series_data_col='leistung',
          time_series_id_col='Kraftwerk',
          auto_arima=TRUE,
          data_frequency='HOURLY',
          holiday_region='DE'
        ) AS
        SELECT
          Timestamp,
          Kraftwerk,
          leistung
        FROM `gasag-465208.analysis.stg_kraftwerksdaten`
        WHERE leistung IS NOT NULL
          AND NOT is_forecast
    
  
[0m23:52:51.629431 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:52:52.465872 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:a59f6527-2731-4e1e-b0c1-937e3683b61d&page=queryresults
[0m23:53:04.673278 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_forecast"
[0m23:53:04.674951 [debug] [Thread-1 (]: Finished running node model.gasag.arima_forecast
[0m23:53:04.676596 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:53:04.677644 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:53:04.678240 [debug] [MainThread]: Connection 'model.gasag.arima_forecast' was properly closed.
[0m23:53:04.678918 [info ] [MainThread]: 
[0m23:53:04.679785 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 15.12 seconds (15.12s).
[0m23:53:04.680747 [debug] [MainThread]: Command end result
[0m23:53:04.722401 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:53:04.726529 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:53:04.734889 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:53:04.737470 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 19.529373, "process_in_blocks": "0", "process_kernel_time": 0.497693, "process_mem_max_rss": "371976", "process_out_blocks": "3128", "process_user_time": 7.143607}
[0m23:53:04.739521 [debug] [MainThread]: Command `dbt run` succeeded at 23:53:04.739193 after 19.53 seconds
[0m23:53:04.741113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x791227873df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7911fc76a980>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7911fcdf31c0>]}
[0m23:53:04.743180 [debug] [MainThread]: Flushing usage events
[0m23:53:05.917883 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:53:48.902840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7796a538bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7796a4202ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7796a4202f20>]}


============================== 23:53:48.908562 | 062e9a54-abf6-42b2-a54c-827238072b9b ==============================
[0m23:53:48.908562 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:53:48.909548 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --select arima_predictions', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:53:52.242943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '062e9a54-abf6-42b2-a54c-827238072b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77967a506860>]}
[0m23:53:52.389053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '062e9a54-abf6-42b2-a54c-827238072b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7796a4201330>]}
[0m23:53:52.390195 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:53:52.724498 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:53:52.918006 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:53:52.919199 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m23:53:53.475732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '062e9a54-abf6-42b2-a54c-827238072b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77967903e050>]}
[0m23:53:53.614812 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:53:53.618484 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:53:53.635777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '062e9a54-abf6-42b2-a54c-827238072b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77967903c790>]}
[0m23:53:53.637721 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m23:53:53.638723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '062e9a54-abf6-42b2-a54c-827238072b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77967903d870>]}
[0m23:53:53.640911 [info ] [MainThread]: 
[0m23:53:53.641689 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:53:53.642274 [info ] [MainThread]: 
[0m23:53:53.643134 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:53:53.644844 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:53:53.645621 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:53:55.382316 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:53:55.383882 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:53:55.989663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '062e9a54-abf6-42b2-a54c-827238072b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7796a6e91690>]}
[0m23:53:55.991796 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:53:55.998131 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m23:53:56.000666 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m23:53:56.002638 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m23:53:56.004480 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m23:53:56.025598 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m23:53:56.026776 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m23:53:56.104504 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m23:53:56.105797 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate ARIMA forecasts for the last day
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

missing_hours AS (
    -- Generate missing hours for the last day
    SELECT
        DISTINCT s.Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC(l.last_date, DAY),
            INTERVAL hour HOUR
        ) AS forecast_timestamp,
        hour AS hour_of_day
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` s
    CROSS JOIN last_day_info l
    CROSS JOIN UNNEST(GENERATE_ARRAY(0, 23)) AS hour
    WHERE s.is_last_day
    AND NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = s.Kraftwerk
        AND existing.Timestamp = TIMESTAMP_ADD(
            TIMESTAMP_TRUNC(l.last_date, DAY),
            INTERVAL hour HOUR
        )
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    -- For now, use a placeholder. In production, you would use ML.FORECAST here
    -- This is a simplified version - you can enhance it with actual ARIMA predictions
    NULL AS prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m23:53:56.106667 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:53:57.010302 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:708e13d1-d9c3-4dfd-a333-bfa90e71a22e&page=queryresults
[0m23:53:57.318874 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:708e13d1-d9c3-4dfd-a333-bfa90e71a22e&page=queryresults
[0m23:53:57.326844 [debug] [Thread-1 (]: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  No matching signature for operator = for argument types: TIMESTAMP, DATETIME
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {TIMESTAMP, DATETIME} at [37:13]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m23:53:57.331455 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '062e9a54-abf6-42b2-a54c-827238072b9b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77967a00d5a0>]}
[0m23:53:57.334497 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.arima_predictions ............... [[31mERROR[0m in 1.33s]
[0m23:53:57.336855 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m23:53:57.338930 [debug] [Thread-7 (]: Marking all children of 'model.gasag.arima_predictions' to be skipped because of status 'error'.  Reason: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  No matching signature for operator = for argument types: TIMESTAMP, DATETIME
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {TIMESTAMP, DATETIME} at [37:13]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql.
[0m23:53:57.342491 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:53:57.343776 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:53:57.344397 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m23:53:57.345046 [info ] [MainThread]: 
[0m23:53:57.345873 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.70 seconds (3.70s).
[0m23:53:57.347962 [debug] [MainThread]: Command end result
[0m23:53:57.393562 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:53:57.395805 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:53:57.412097 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:53:57.413343 [info ] [MainThread]: 
[0m23:53:57.414755 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:53:57.416671 [info ] [MainThread]: 
[0m23:53:57.418203 [error] [MainThread]: [31mFailure in model arima_predictions (models/marts/arima_predictions.sql)[0m
[0m23:53:57.419823 [error] [MainThread]:   Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  No matching signature for operator = for argument types: TIMESTAMP, DATETIME
    Signature: T1 = T1
      Unable to find common supertype for templated argument <T1>
        Input types for <T1>: {TIMESTAMP, DATETIME} at [37:13]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m23:53:57.421163 [info ] [MainThread]: 
[0m23:53:57.423005 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/arima_predictions.sql
[0m23:53:57.425022 [info ] [MainThread]: 
[0m23:53:57.426806 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m23:53:57.429653 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.65932, "process_in_blocks": "0", "process_kernel_time": 0.544167, "process_mem_max_rss": "369268", "process_out_blocks": "3152", "process_user_time": 7.800064}
[0m23:53:57.432716 [debug] [MainThread]: Command `dbt run` failed at 23:53:57.432365 after 8.66 seconds
[0m23:53:57.434897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7796a538bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77967a506860>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7796a53070d0>]}
[0m23:53:57.436731 [debug] [MainThread]: Flushing usage events
[0m23:53:58.341096 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:54:20.528245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6842f4bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6841d96ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6841d96f20>]}


============================== 23:54:20.532760 | 72a0fa4e-de44-4d68-b14e-0f52c9874107 ==============================
[0m23:54:20.532760 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:54:20.533663 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/home/anton/.dbt', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select arima_predictions', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:54:23.959129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72a0fa4e-de44-4d68-b14e-0f52c9874107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c681832ded0>]}
[0m23:54:24.117813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '72a0fa4e-de44-4d68-b14e-0f52c9874107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6841d95330>]}
[0m23:54:24.118790 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:54:24.450067 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:54:24.652090 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:54:24.653159 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m23:54:25.204675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '72a0fa4e-de44-4d68-b14e-0f52c9874107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6817cea050>]}
[0m23:54:25.354691 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:54:25.357566 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:54:25.373931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '72a0fa4e-de44-4d68-b14e-0f52c9874107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6817ce81c0>]}
[0m23:54:25.374896 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m23:54:25.375660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72a0fa4e-de44-4d68-b14e-0f52c9874107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6817ce8ee0>]}
[0m23:54:25.378725 [info ] [MainThread]: 
[0m23:54:25.379559 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:54:25.380199 [info ] [MainThread]: 
[0m23:54:25.381176 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:54:25.382619 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:54:25.383358 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:54:27.446940 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:54:27.449699 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:54:28.148072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72a0fa4e-de44-4d68-b14e-0f52c9874107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6844a95690>]}
[0m23:54:28.149704 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:54:28.157355 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m23:54:28.159897 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m23:54:28.161778 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m23:54:28.163727 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m23:54:28.189840 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m23:54:28.191966 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m23:54:28.264307 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m23:54:28.265527 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate ARIMA forecasts for the last day
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

missing_hours AS (
    -- Generate missing hours for the last day
    SELECT
        DISTINCT s.Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC(l.last_date, DAY),
            INTERVAL hour HOUR
        ) AS forecast_timestamp,
        hour AS hour_of_day
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` s
    CROSS JOIN last_day_info l
    CROSS JOIN UNNEST(GENERATE_ARRAY(0, 23)) AS hour
    WHERE s.is_last_day
    AND NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = s.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC(l.last_date, DAY),
            INTERVAL hour HOUR
        ) AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    -- For now, use a placeholder. In production, you would use ML.FORECAST here
    -- This is a simplified version - you can enhance it with actual ARIMA predictions
    NULL AS prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m23:54:28.266426 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:54:29.065337 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:a4974c01-4a25-4105-a0ff-bde349d04f01&page=queryresults
[0m23:54:34.241346 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72a0fa4e-de44-4d68-b14e-0f52c9874107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c68211dd120>]}
[0m23:54:34.244935 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.arima_predictions ................... [[32mCREATE TABLE (40.0 rows, 107.3 KiB processed)[0m in 6.07s]
[0m23:54:34.248628 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m23:54:34.251341 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:54:34.253072 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:54:34.255411 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m23:54:34.257896 [info ] [MainThread]: 
[0m23:54:34.260724 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 8.88 seconds (8.88s).
[0m23:54:34.262916 [debug] [MainThread]: Command end result
[0m23:54:34.333392 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:54:34.337273 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:54:34.354105 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:54:34.355518 [info ] [MainThread]: 
[0m23:54:34.356854 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:54:34.358217 [info ] [MainThread]: 
[0m23:54:34.360192 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:54:34.361880 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.959675, "process_in_blocks": "0", "process_kernel_time": 0.562368, "process_mem_max_rss": "372456", "process_out_blocks": "3144", "process_user_time": 8.23013}
[0m23:54:34.362983 [debug] [MainThread]: Command `dbt run` succeeded at 23:54:34.362825 after 13.96 seconds
[0m23:54:34.363687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6842f4bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6817cd76d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c681832ded0>]}
[0m23:54:34.364611 [debug] [MainThread]: Flushing usage events
[0m23:54:35.549253 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:59:13.090915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ff20447e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ff1f2baec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ff1f2baf20>]}


============================== 23:59:13.094511 | 93b481a0-73b2-4989-9933-54172f541cd9 ==============================
[0m23:59:13.094511 [info ] [MainThread]: Running with dbt=1.10.3
[0m23:59:13.095315 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select arima_predictions', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m23:59:16.352694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '93b481a0-73b2-4989-9933-54172f541cd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ff1f406cb0>]}
[0m23:59:16.492414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '93b481a0-73b2-4989-9933-54172f541cd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ff203c1cc0>]}
[0m23:59:16.493513 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m23:59:16.823102 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m23:59:17.020696 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:59:17.022029 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m23:59:17.567882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '93b481a0-73b2-4989-9933-54172f541cd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fef52ea110>]}
[0m23:59:17.715476 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:59:17.718414 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:59:17.734700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '93b481a0-73b2-4989-9933-54172f541cd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fef5359300>]}
[0m23:59:17.735653 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m23:59:17.736793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93b481a0-73b2-4989-9933-54172f541cd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fef531bd90>]}
[0m23:59:17.739497 [info ] [MainThread]: 
[0m23:59:17.740218 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m23:59:17.740900 [info ] [MainThread]: 
[0m23:59:17.741846 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m23:59:17.743371 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m23:59:17.744214 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:59:20.044117 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m23:59:20.045585 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:59:20.600524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '93b481a0-73b2-4989-9933-54172f541cd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ff1f47e860>]}
[0m23:59:20.601877 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:59:20.608061 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m23:59:20.609524 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m23:59:20.610904 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m23:59:20.611947 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m23:59:20.631082 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m23:59:20.632615 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m23:59:20.654519 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:59:21.481747 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m23:59:21.483027 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate ARIMA forecasts for the last day
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

missing_hours AS (
    -- Generate missing hours for the last day
    SELECT
        DISTINCT s.Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC(l.last_date, DAY),
            INTERVAL hour HOUR
        ) AS forecast_timestamp,
        hour AS hour_of_day
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` s
    CROSS JOIN last_day_info l
    CROSS JOIN UNNEST(GENERATE_ARRAY(0, 23)) AS hour
    WHERE s.is_last_day
    AND NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = s.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC(l.last_date, DAY),
            INTERVAL hour HOUR
        ) AS TIMESTAMP)
    )
),

-- Get ARIMA forecasts for each power plant
arima_forecasts AS (
    SELECT
        Kraftwerk,
        forecast_timestamp,
        hour_of_day,
        -- Use ARIMA model to predict (simplified approach)
        -- In a real scenario, you'd use ML.FORECAST here
        -- For now, using a placeholder that you can replace with actual ML.FORECAST
        CASE
            WHEN hour_of_day BETWEEN 6 AND 22 THEN 25.0  -- Daytime average
            ELSE 15.0  -- Nighttime average
        END AS prognose
    FROM missing_hours
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM arima_forecasts
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m23:59:22.134892 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:f7ea2195-65ac-4ad9-a259-6a005df4ada3&page=queryresults
[0m23:59:24.540526 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '93b481a0-73b2-4989-9933-54172f541cd9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fefa7d97e0>]}
[0m23:59:24.541679 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.arima_predictions ................... [[32mCREATE TABLE (40.0 rows, 107.3 KiB processed)[0m in 3.93s]
[0m23:59:24.542692 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m23:59:24.544565 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:59:24.546160 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:59:24.547158 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m23:59:24.548220 [info ] [MainThread]: 
[0m23:59:24.549326 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.81 seconds (6.81s).
[0m23:59:24.551212 [debug] [MainThread]: Command end result
[0m23:59:24.598880 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m23:59:24.601620 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m23:59:24.613300 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m23:59:24.614251 [info ] [MainThread]: 
[0m23:59:24.615068 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:59:24.615783 [info ] [MainThread]: 
[0m23:59:24.616529 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m23:59:24.618919 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.65331, "process_in_blocks": "0", "process_kernel_time": 0.499598, "process_mem_max_rss": "372428", "process_out_blocks": "3144", "process_user_time": 7.795131}
[0m23:59:24.620540 [debug] [MainThread]: Command `dbt run` succeeded at 23:59:24.620239 after 11.66 seconds
[0m23:59:24.621550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ff20447e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ff203c1cc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77fef52fb220>]}
[0m23:59:24.623023 [debug] [MainThread]: Flushing usage events
[0m23:59:25.411834 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:01:51.521621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77975495bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7797537ceec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7797537cef20>]}


============================== 00:01:51.525605 | aebcc635-71f3-49ea-9c80-2a0589444793 ==============================
[0m00:01:51.525605 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:01:51.526561 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select arima_predictions', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:01:54.881066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aebcc635-71f3-49ea-9c80-2a0589444793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779729bcec50>]}
[0m00:01:55.042394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aebcc635-71f3-49ea-9c80-2a0589444793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7797539ed5d0>]}
[0m00:01:55.043475 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:01:55.361103 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:01:55.569259 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:01:55.570703 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m00:01:56.116411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aebcc635-71f3-49ea-9c80-2a0589444793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77972953e020>]}
[0m00:01:56.260409 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:01:56.262952 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:01:56.280089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aebcc635-71f3-49ea-9c80-2a0589444793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779729529510>]}
[0m00:01:56.281110 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m00:01:56.281772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aebcc635-71f3-49ea-9c80-2a0589444793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77972952b430>]}
[0m00:01:56.284500 [info ] [MainThread]: 
[0m00:01:56.285680 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:01:56.286308 [info ] [MainThread]: 
[0m00:01:56.287693 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:01:56.290121 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:01:56.291026 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:01:58.096196 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:01:58.097675 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:01:59.126694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aebcc635-71f3-49ea-9c80-2a0589444793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779729c83f70>]}
[0m00:01:59.129000 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:01:59.140536 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m00:01:59.142900 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m00:01:59.145051 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m00:01:59.146719 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m00:01:59.164969 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m00:01:59.166777 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m00:01:59.201847 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:01:59.771588 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m00:01:59.772873 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate real ARIMA forecasts for the last day using ML.FORECAST
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

power_plants AS (
    SELECT DISTINCT Kraftwerk
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE is_last_day
),

-- Get ARIMA forecasts for each power plant using ML.FORECAST
arima_forecasts AS (
    SELECT
        p.Kraftwerk,
        -- Generate forecast timestamps for the next 24 hours
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC(l.last_date, DAY),
            INTERVAL (forecast_row - 1) HOUR
        ) AS forecast_timestamp,
        (forecast_row - 1) AS hour_of_day,
        forecast_value AS prognose
    FROM power_plants p
    CROSS JOIN last_day_info l
    CROSS JOIN ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
    WHERE p.Kraftwerk = time_series_id
),

missing_hours AS (
    -- Only keep forecasts for hours that don't have actual data
    SELECT
        af.Kraftwerk,
        af.forecast_timestamp,
        af.hour_of_day,
        af.prognose
    FROM arima_forecasts af
    WHERE NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = af.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(af.forecast_timestamp AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m00:02:00.651963 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:0f488ea5-93fb-442a-bb18-829d41c85cf1&page=queryresults
[0m00:02:00.937722 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:0f488ea5-93fb-442a-bb18-829d41c85cf1&page=queryresults
[0m00:02:00.948825 [debug] [Thread-1 (]: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Unrecognized name: time_series_id at [44:25]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m00:02:00.954178 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aebcc635-71f3-49ea-9c80-2a0589444793', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779754b10160>]}
[0m00:02:00.956117 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.arima_predictions ............... [[31mERROR[0m in 1.81s]
[0m00:02:00.957852 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m00:02:00.959212 [debug] [Thread-7 (]: Marking all children of 'model.gasag.arima_predictions' to be skipped because of status 'error'.  Reason: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Unrecognized name: time_series_id at [44:25]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql.
[0m00:02:00.963070 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:02:00.964312 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:02:00.965197 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m00:02:00.966557 [info ] [MainThread]: 
[0m00:02:00.967827 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.68 seconds (4.68s).
[0m00:02:00.970628 [debug] [MainThread]: Command end result
[0m00:02:01.014805 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:02:01.019527 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:02:01.032891 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:02:01.034156 [info ] [MainThread]: 
[0m00:02:01.035749 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:02:01.037226 [info ] [MainThread]: 
[0m00:02:01.038246 [error] [MainThread]: [31mFailure in model arima_predictions (models/marts/arima_predictions.sql)[0m
[0m00:02:01.039389 [error] [MainThread]:   Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Unrecognized name: time_series_id at [44:25]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m00:02:01.040321 [info ] [MainThread]: 
[0m00:02:01.041371 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/arima_predictions.sql
[0m00:02:01.042073 [info ] [MainThread]: 
[0m00:02:01.042804 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m00:02:01.045050 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 9.648616, "process_in_blocks": "0", "process_kernel_time": 0.535708, "process_mem_max_rss": "369060", "process_out_blocks": "3136", "process_user_time": 7.987736}
[0m00:02:01.046956 [debug] [MainThread]: Command `dbt run` failed at 00:02:01.046669 after 9.65 seconds
[0m00:02:01.047976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77975495bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779754905450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77972968dae0>]}
[0m00:02:01.049398 [debug] [MainThread]: Flushing usage events
[0m00:02:02.303592 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:02:49.972798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59d384be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59d269aec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59d269af20>]}


============================== 00:02:49.980364 | 75c49210-56c3-451b-9479-b50340a5e92f ==============================
[0m00:02:49.980364 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:02:49.982354 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select arima_predictions', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:02:53.477047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '75c49210-56c3-451b-9479-b50340a5e92f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59d5383760>]}
[0m00:02:53.632506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '75c49210-56c3-451b-9479-b50340a5e92f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59d2699330>]}
[0m00:02:53.633882 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:02:53.956335 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:02:54.143539 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:02:54.144742 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m00:02:54.708153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '75c49210-56c3-451b-9479-b50340a5e92f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59a8459ff0>]}
[0m00:02:54.834301 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:02:54.837000 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:02:54.853389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '75c49210-56c3-451b-9479-b50340a5e92f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59a8429660>]}
[0m00:02:54.854403 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m00:02:54.855169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75c49210-56c3-451b-9479-b50340a5e92f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59a842b490>]}
[0m00:02:54.857425 [info ] [MainThread]: 
[0m00:02:54.858212 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:02:54.858819 [info ] [MainThread]: 
[0m00:02:54.859654 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:02:54.861034 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:02:54.861833 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:02:58.012836 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:02:58.014182 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:02:58.911301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '75c49210-56c3-451b-9479-b50340a5e92f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59d285a830>]}
[0m00:02:58.912609 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:02:58.919597 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m00:02:58.921368 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m00:02:58.922928 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m00:02:58.924177 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m00:02:58.944854 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m00:02:58.945961 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m00:02:58.974799 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:02:59.576854 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m00:02:59.578053 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate real ARIMA forecasts for the last day using ML.FORECAST
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Get forecasts for each power plant
forecast_results AS (
    SELECT
        'Kraftwerk_1' AS Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL (forecast_row - 1) HOUR
        ) AS forecast_timestamp,
        (forecast_row - 1) AS hour_of_day,
        forecast_value AS prognose
    FROM ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
    WHERE time_series_id = 'Kraftwerk_1'

    UNION ALL

    SELECT
        'Kraftwerk_2' AS Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL (forecast_row - 1) HOUR
        ) AS forecast_timestamp,
        (forecast_row - 1) AS hour_of_day,
        forecast_value AS prognose
    FROM ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
    WHERE time_series_id = 'Kraftwerk_2'

    UNION ALL

    SELECT
        'Kraftwerk_3' AS Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL (forecast_row - 1) HOUR
        ) AS forecast_timestamp,
        (forecast_row - 1) AS hour_of_day,
        forecast_value AS prognose
    FROM ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
    WHERE time_series_id = 'Kraftwerk_3'

    UNION ALL

    SELECT
        'Kraftwerk_4' AS Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL (forecast_row - 1) HOUR
        ) AS forecast_timestamp,
        (forecast_row - 1) AS hour_of_day,
        forecast_value AS prognose
    FROM ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
    WHERE time_series_id = 'Kraftwerk_4'

    UNION ALL

    SELECT
        'Kraftwerk_5' AS Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL (forecast_row - 1) HOUR
        ) AS forecast_timestamp,
        (forecast_row - 1) AS hour_of_day,
        forecast_value AS prognose
    FROM ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
    WHERE time_series_id = 'Kraftwerk_5'
),

missing_hours AS (
    -- Only keep forecasts for hours that don't have actual data
    SELECT
        fr.Kraftwerk,
        fr.forecast_timestamp,
        fr.hour_of_day,
        fr.prognose
    FROM forecast_results fr
    WHERE NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = fr.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(fr.forecast_timestamp AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m00:03:00.333735 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:aa8bf5de-8590-4212-9d53-886eb5e9d57b&page=queryresults
[0m00:03:00.760595 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:aa8bf5de-8590-4212-9d53-886eb5e9d57b&page=queryresults
[0m00:03:00.764716 [debug] [Thread-1 (]: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Unrecognized name: time_series_id at [35:11]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m00:03:00.767772 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '75c49210-56c3-451b-9479-b50340a5e92f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59a865c3d0>]}
[0m00:03:00.769387 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.arima_predictions ............... [[31mERROR[0m in 1.84s]
[0m00:03:00.771032 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m00:03:00.772354 [debug] [Thread-7 (]: Marking all children of 'model.gasag.arima_predictions' to be skipped because of status 'error'.  Reason: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Unrecognized name: time_series_id at [35:11]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql.
[0m00:03:00.774917 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:03:00.776134 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:03:00.776918 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m00:03:00.778109 [info ] [MainThread]: 
[0m00:03:00.779116 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 5.92 seconds (5.92s).
[0m00:03:00.780974 [debug] [MainThread]: Command end result
[0m00:03:00.823608 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:03:00.825860 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:03:00.836516 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:03:00.837844 [info ] [MainThread]: 
[0m00:03:00.839169 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:03:00.840296 [info ] [MainThread]: 
[0m00:03:00.841057 [error] [MainThread]: [31mFailure in model arima_predictions (models/marts/arima_predictions.sql)[0m
[0m00:03:00.841808 [error] [MainThread]:   Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Unrecognized name: time_series_id at [35:11]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m00:03:00.842391 [info ] [MainThread]: 
[0m00:03:00.843075 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/arima_predictions.sql
[0m00:03:00.843704 [info ] [MainThread]: 
[0m00:03:00.844503 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m00:03:00.845957 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 11.014758, "process_in_blocks": "0", "process_kernel_time": 0.502256, "process_mem_max_rss": "369332", "process_out_blocks": "3152", "process_user_time": 7.900574}
[0m00:03:00.846982 [debug] [MainThread]: Command `dbt run` failed at 00:03:00.846793 after 11.02 seconds
[0m00:03:00.848268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59d384be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59d5383760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c59d37b8a90>]}
[0m00:03:00.849461 [debug] [MainThread]: Flushing usage events
[0m00:03:01.573701 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:04:02.110761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba407b8be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba406a02ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba406a02f20>]}


============================== 00:04:02.115460 | 757dcf76-0378-4115-b553-ae8f236e5110 ==============================
[0m00:04:02.115460 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:04:02.117201 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select arima_predictions', 'send_anonymous_usage_stats': 'True'}
[0m00:04:05.659514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '757dcf76-0378-4115-b553-ae8f236e5110', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba40967f760>]}
[0m00:04:05.801862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '757dcf76-0378-4115-b553-ae8f236e5110', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba406a01330>]}
[0m00:04:05.802846 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:04:06.109663 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:04:06.311801 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:04:06.314296 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m00:04:06.912177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '757dcf76-0378-4115-b553-ae8f236e5110', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba3dc755ff0>]}
[0m00:04:07.077146 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:04:07.081985 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:04:07.100596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '757dcf76-0378-4115-b553-ae8f236e5110', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba3dc73d930>]}
[0m00:04:07.101410 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m00:04:07.102022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '757dcf76-0378-4115-b553-ae8f236e5110', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba3dc73e230>]}
[0m00:04:07.103988 [info ] [MainThread]: 
[0m00:04:07.104637 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:04:07.105241 [info ] [MainThread]: 
[0m00:04:07.106039 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:04:07.107416 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:04:07.108254 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:04:08.984294 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:04:08.986738 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:04:09.579645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '757dcf76-0378-4115-b553-ae8f236e5110', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba4069c6830>]}
[0m00:04:09.583161 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:04:09.596173 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m00:04:09.601415 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m00:04:09.604767 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m00:04:09.607220 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m00:04:09.632483 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m00:04:09.633569 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m00:04:09.657600 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:04:10.312351 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m00:04:10.315026 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate real ARIMA forecasts for the last day using ML.FORECAST
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Get forecasts for each power plant
forecast_results AS (
    SELECT
        Kraftwerk,
        forecast_timestamp,
        EXTRACT(HOUR FROM forecast_timestamp) AS hour_of_day,
        forecast_value AS prognose
    FROM ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
),

missing_hours AS (
    -- Only keep forecasts for hours that don't have actual data
    SELECT
        fr.Kraftwerk,
        fr.forecast_timestamp,
        fr.hour_of_day,
        fr.prognose
    FROM forecast_results fr
    WHERE NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = fr.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(fr.forecast_timestamp AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m00:04:11.010099 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:6e83e336-6782-4819-b8fd-4d7ab886523a&page=queryresults
[0m00:04:15.329284 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '757dcf76-0378-4115-b553-ae8f236e5110', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba3e1c10070>]}
[0m00:04:15.330573 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.arima_predictions ................... [[32mCREATE TABLE (120.0 rows, 464.9 KiB processed)[0m in 5.72s]
[0m00:04:15.331691 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m00:04:15.333567 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:04:15.334573 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:04:15.335164 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m00:04:15.335771 [info ] [MainThread]: 
[0m00:04:15.336451 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 8.23 seconds (8.23s).
[0m00:04:15.337784 [debug] [MainThread]: Command end result
[0m00:04:15.434875 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:04:15.441221 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:04:15.461210 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:04:15.462915 [info ] [MainThread]: 
[0m00:04:15.464897 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:04:15.466712 [info ] [MainThread]: 
[0m00:04:15.468679 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:04:15.471846 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.486349, "process_in_blocks": "0", "process_kernel_time": 0.565552, "process_mem_max_rss": "372004", "process_out_blocks": "3144", "process_user_time": 8.46135}
[0m00:04:15.474630 [debug] [MainThread]: Command `dbt run` succeeded at 00:04:15.474259 after 13.49 seconds
[0m00:04:15.476985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba407b8be20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba40967f760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ba3dc76f490>]}
[0m00:04:15.479263 [debug] [MainThread]: Flushing usage events
[0m00:04:16.385477 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:11:12.964565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d50083df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d4eefaef0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d4eefaf50>]}


============================== 00:11:12.969967 | a36ec52f-9156-4240-ae09-becb186fb99d ==============================
[0m00:11:12.969967 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:11:12.971017 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select arima_predictions', 'send_anonymous_usage_stats': 'True'}
[0m00:11:16.587148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a36ec52f-9156-4240-ae09-becb186fb99d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d51bff700>]}
[0m00:11:16.738424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a36ec52f-9156-4240-ae09-becb186fb99d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d4eef9360>]}
[0m00:11:16.739464 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:11:17.057208 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:11:17.250209 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:11:17.251148 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m00:11:17.813830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a36ec52f-9156-4240-ae09-becb186fb99d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d24c51ff0>]}
[0m00:11:17.942111 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:11:17.945572 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:11:17.962131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a36ec52f-9156-4240-ae09-becb186fb99d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d24da5060>]}
[0m00:11:17.963542 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m00:11:17.964727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a36ec52f-9156-4240-ae09-becb186fb99d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d24da4460>]}
[0m00:11:17.966864 [info ] [MainThread]: 
[0m00:11:17.967629 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:11:17.968269 [info ] [MainThread]: 
[0m00:11:17.969303 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:11:17.971257 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:11:17.972074 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:11:19.880540 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:11:19.882304 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:11:20.481763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a36ec52f-9156-4240-ae09-becb186fb99d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d51c114b0>]}
[0m00:11:20.482623 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:11:20.486694 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m00:11:20.487641 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m00:11:20.488476 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m00:11:20.489173 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m00:11:20.503407 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m00:11:20.504422 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m00:11:20.527149 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:11:21.203037 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m00:11:21.204608 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate hybrid forecasts combining ARIMA trend with hourly seasonality
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate hourly seasonality patterns from historical data
hourly_patterns AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung,
        STDDEV(leistung) as std_hourly_leistung
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Get ARIMA trend forecasts (simplified)
arima_trends AS (
    SELECT
        Kraftwerk,
        forecast_timestamp,
        EXTRACT(HOUR FROM forecast_timestamp) AS hour_of_day,
        forecast_value AS trend_forecast
    FROM ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
),

-- Combine trend with seasonality
hybrid_forecasts AS (
    SELECT
        at.Kraftwerk,
        at.forecast_timestamp,
        at.hour_of_day,
        -- Use hourly pattern as base, adjust with trend
        hp.avg_hourly_leistung + (at.trend_forecast -
            (SELECT AVG(forecast_value) FROM ML.FORECAST(
                MODEL `gasag-465208.analysis.arima_forecast`,
                STRUCT(24 AS horizon, 0.8 AS confidence_level)
            ) WHERE Kraftwerk = at.Kraftwerk LIMIT 1)
        ) AS prognose
    FROM arima_trends at
    JOIN hourly_patterns hp ON at.Kraftwerk = hp.Kraftwerk
        AND at.hour_of_day = hp.hour_of_day
),

missing_hours AS (
    -- Only keep forecasts for hours that don't have actual data
    SELECT
        hf.Kraftwerk,
        hf.forecast_timestamp,
        hf.hour_of_day,
        hf.prognose
    FROM hybrid_forecasts hf
    WHERE NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = hf.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(hf.forecast_timestamp AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m00:11:21.605736 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:09a26d72-32e1-4560-905e-ffd31fe38bcf&page=queryresults
[0m00:11:21.606711 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:09a26d72-32e1-4560-905e-ffd31fe38bcf&page=queryresults
[0m00:11:21.611381 [debug] [Thread-1 (]: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Syntax error: Unexpected keyword AT at [49:9]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m00:11:21.616091 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a36ec52f-9156-4240-ae09-becb186fb99d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d5023c160>]}
[0m00:11:21.617310 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.arima_predictions ............... [[31mERROR[0m in 1.12s]
[0m00:11:21.618342 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m00:11:21.619326 [debug] [Thread-7 (]: Marking all children of 'model.gasag.arima_predictions' to be skipped because of status 'error'.  Reason: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Syntax error: Unexpected keyword AT at [49:9]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql.
[0m00:11:21.621880 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:11:21.622972 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:11:21.623930 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m00:11:21.624658 [info ] [MainThread]: 
[0m00:11:21.626064 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.66 seconds (3.66s).
[0m00:11:21.627698 [debug] [MainThread]: Command end result
[0m00:11:21.677241 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:11:21.680506 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:11:21.690169 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:11:21.691110 [info ] [MainThread]: 
[0m00:11:21.692407 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:11:21.693354 [info ] [MainThread]: 
[0m00:11:21.694413 [error] [MainThread]: [31mFailure in model arima_predictions (models/marts/arima_predictions.sql)[0m
[0m00:11:21.695479 [error] [MainThread]:   Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Syntax error: Unexpected keyword AT at [49:9]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m00:11:21.696385 [info ] [MainThread]: 
[0m00:11:21.697771 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/arima_predictions.sql
[0m00:11:21.698753 [info ] [MainThread]: 
[0m00:11:21.699451 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m00:11:21.701067 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.877999, "process_in_blocks": "0", "process_kernel_time": 0.524095, "process_mem_max_rss": "369268", "process_out_blocks": "3144", "process_user_time": 8.18986}
[0m00:11:21.702111 [debug] [MainThread]: Command `dbt run` failed at 00:11:21.701901 after 8.88 seconds
[0m00:11:21.703039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d50083df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d4eef9360>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x736d4ff4f640>]}
[0m00:11:21.703805 [debug] [MainThread]: Flushing usage events
[0m00:11:22.938526 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:11:52.155663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bed1573e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bed03e6ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bed03e6f20>]}


============================== 00:11:52.159392 | 01763066-136e-4668-a95d-7ff0d8efae34 ==============================
[0m00:11:52.159392 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:11:52.160336 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select arima_predictions', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:11:55.420040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01763066-136e-4668-a95d-7ff0d8efae34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bed313b760>]}
[0m00:11:55.564548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01763066-136e-4668-a95d-7ff0d8efae34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bed03e5330>]}
[0m00:11:55.566092 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:11:55.907510 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:11:56.097807 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:11:56.099306 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m00:11:56.640193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01763066-136e-4668-a95d-7ff0d8efae34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bea614a050>]}
[0m00:11:56.773667 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:11:56.775985 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:11:56.793459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01763066-136e-4668-a95d-7ff0d8efae34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bea614a710>]}
[0m00:11:56.794626 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m00:11:56.795257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01763066-136e-4668-a95d-7ff0d8efae34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bea614b640>]}
[0m00:11:56.797334 [info ] [MainThread]: 
[0m00:11:56.798543 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:11:56.799196 [info ] [MainThread]: 
[0m00:11:56.800259 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:11:56.802706 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:11:56.803944 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:11:58.994230 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:11:58.995510 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:11:59.473127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01763066-136e-4668-a95d-7ff0d8efae34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bea627c2b0>]}
[0m00:11:59.474185 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:11:59.479182 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m00:11:59.480871 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m00:11:59.482270 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m00:11:59.483060 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m00:11:59.497575 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m00:11:59.498709 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m00:11:59.522774 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:00.070275 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m00:12:00.072628 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate hybrid forecasts combining ARIMA trend with hourly seasonality
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate hourly seasonality patterns from historical data
hourly_patterns AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Get ARIMA trend forecasts
arima_trends AS (
    SELECT
        Kraftwerk,
        forecast_timestamp,
        EXTRACT(HOUR FROM forecast_timestamp) AS hour_of_day,
        forecast_value AS trend_forecast
    FROM ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
),

-- Calculate average trend for each power plant
avg_trends AS (
    SELECT
        Kraftwerk,
        AVG(trend_forecast) as avg_trend
    FROM arima_trends
    GROUP BY Kraftwerk
),

-- Combine trend with seasonality
hybrid_forecasts AS (
    SELECT
        at.Kraftwerk,
        at.forecast_timestamp,
        at.hour_of_day,
        -- Use hourly pattern as base, adjust with trend difference
        hp.avg_hourly_leistung + (at.trend_forecast - at_avg.avg_trend) AS prognose
    FROM arima_trends at
    JOIN hourly_patterns hp ON at.Kraftwerk = hp.Kraftwerk
        AND at.hour_of_day = hp.hour_of_day
    JOIN avg_trends at_avg ON at.Kraftwerk = at_avg.Kraftwerk
),

missing_hours AS (
    -- Only keep forecasts for hours that don't have actual data
    SELECT
        hf.Kraftwerk,
        hf.forecast_timestamp,
        hf.hour_of_day,
        hf.prognose
    FROM hybrid_forecasts hf
    WHERE NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = hf.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(hf.forecast_timestamp AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m00:12:00.679374 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:acff8257-6d9f-4473-93e3-b0b1d3fc96bd&page=queryresults
[0m00:12:00.681464 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:acff8257-6d9f-4473-93e3-b0b1d3fc96bd&page=queryresults
[0m00:12:00.688027 [debug] [Thread-1 (]: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Syntax error: Unexpected keyword AT at [57:9]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m00:12:00.692561 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01763066-136e-4668-a95d-7ff0d8efae34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bed2b3d240>]}
[0m00:12:00.694001 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.arima_predictions ............... [[31mERROR[0m in 1.21s]
[0m00:12:00.695693 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m00:12:00.698931 [debug] [Thread-7 (]: Marking all children of 'model.gasag.arima_predictions' to be skipped because of status 'error'.  Reason: Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Syntax error: Unexpected keyword AT at [57:9]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql.
[0m00:12:00.703657 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:12:00.705677 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:12:00.706725 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m00:12:00.707658 [info ] [MainThread]: 
[0m00:12:00.709159 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.91 seconds (3.91s).
[0m00:12:00.711612 [debug] [MainThread]: Command end result
[0m00:12:00.780799 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:12:00.783966 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:12:00.797220 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:12:00.798292 [info ] [MainThread]: 
[0m00:12:00.799623 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:12:00.800943 [info ] [MainThread]: 
[0m00:12:00.801858 [error] [MainThread]: [31mFailure in model arima_predictions (models/marts/arima_predictions.sql)[0m
[0m00:12:00.802940 [error] [MainThread]:   Database Error in model arima_predictions (models/marts/arima_predictions.sql)
  Syntax error: Unexpected keyword AT at [57:9]
  compiled code at target/run/gasag/models/marts/arima_predictions.sql
[0m00:12:00.803773 [info ] [MainThread]: 
[0m00:12:00.804810 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/arima_predictions.sql
[0m00:12:00.805572 [info ] [MainThread]: 
[0m00:12:00.806368 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m00:12:00.809051 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 8.779664, "process_in_blocks": "0", "process_kernel_time": 0.518573, "process_mem_max_rss": "368972", "process_out_blocks": "3152", "process_user_time": 7.720755}
[0m00:12:00.810294 [debug] [MainThread]: Command `dbt run` failed at 00:12:00.810107 after 8.78 seconds
[0m00:12:00.811042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bed1573e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bea69f9930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bed14e4a90>]}
[0m00:12:00.811835 [debug] [MainThread]: Flushing usage events
[0m00:12:01.637609 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:12:27.211286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484b387e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484a1feec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484a1fef20>]}


============================== 00:12:27.215338 | 8786b55d-22a5-4a87-baf8-6566b7a063a0 ==============================
[0m00:12:27.215338 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:12:27.216495 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select arima_predictions', 'send_anonymous_usage_stats': 'True'}
[0m00:12:30.754592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8786b55d-22a5-4a87-baf8-6566b7a063a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484b3035b0>]}
[0m00:12:30.899277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8786b55d-22a5-4a87-baf8-6566b7a063a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484a1fd330>]}
[0m00:12:30.900247 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:12:31.204643 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:12:31.394111 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:12:31.395090 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m00:12:31.941284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8786b55d-22a5-4a87-baf8-6566b7a063a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e481ff4a050>]}
[0m00:12:32.079879 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:12:32.082247 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:12:32.098519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8786b55d-22a5-4a87-baf8-6566b7a063a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e48200c3550>]}
[0m00:12:32.099320 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m00:12:32.099936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8786b55d-22a5-4a87-baf8-6566b7a063a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484bf17220>]}
[0m00:12:32.101902 [info ] [MainThread]: 
[0m00:12:32.102534 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:12:32.103108 [info ] [MainThread]: 
[0m00:12:32.104588 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:12:32.106426 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:12:32.108210 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:12:34.124271 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:12:34.125660 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:12:34.623071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8786b55d-22a5-4a87-baf8-6566b7a063a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484a1c2830>]}
[0m00:12:34.625662 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:12:34.634621 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m00:12:34.636804 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m00:12:34.639140 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m00:12:34.641738 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m00:12:34.666201 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m00:12:34.667539 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m00:12:34.693721 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:12:35.491274 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m00:12:35.492588 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate hybrid forecasts combining ARIMA trend with hourly seasonality
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate hourly seasonality patterns from historical data
hourly_patterns AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Get ARIMA trend forecasts
arima_trends AS (
    SELECT
        Kraftwerk,
        forecast_timestamp,
        EXTRACT(HOUR FROM forecast_timestamp) AS hour_of_day,
        forecast_value AS trend_forecast
    FROM ML.FORECAST(
        MODEL `gasag-465208.analysis.arima_forecast`,
        STRUCT(24 AS horizon, 0.8 AS confidence_level)
    )
),

-- Calculate average trend for each power plant
avg_trends AS (
    SELECT
        Kraftwerk,
        AVG(trend_forecast) as avg_trend
    FROM arima_trends
    GROUP BY Kraftwerk
),

-- Combine trend with seasonality
hybrid_forecasts AS (
    SELECT
        arima.Kraftwerk,
        arima.forecast_timestamp,
        arima.hour_of_day,
        -- Use hourly pattern as base, adjust with trend difference
        hourly.avg_hourly_leistung + (arima.trend_forecast - avg_tr.avg_trend) AS prognose
    FROM arima_trends arima
    JOIN hourly_patterns hourly ON arima.Kraftwerk = hourly.Kraftwerk
        AND arima.hour_of_day = hourly.hour_of_day
    JOIN avg_trends avg_tr ON arima.Kraftwerk = avg_tr.Kraftwerk
),

missing_hours AS (
    -- Only keep forecasts for hours that don't have actual data
    SELECT
        hf.Kraftwerk,
        hf.forecast_timestamp,
        hf.hour_of_day,
        hf.prognose
    FROM hybrid_forecasts hf
    WHERE NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = hf.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(hf.forecast_timestamp AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m00:12:36.054915 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:a4c6d2d6-72ba-4757-8bde-5ed73777029d&page=queryresults
[0m00:12:39.064676 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8786b55d-22a5-4a87-baf8-6566b7a063a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e4825401570>]}
[0m00:12:39.066209 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.arima_predictions ................... [[32mCREATE TABLE (120.0 rows, 542.5 KiB processed)[0m in 4.42s]
[0m00:12:39.067207 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m00:12:39.069650 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:12:39.071233 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:12:39.072661 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m00:12:39.073794 [info ] [MainThread]: 
[0m00:12:39.074560 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.97 seconds (6.97s).
[0m00:12:39.075792 [debug] [MainThread]: Command end result
[0m00:12:39.112960 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:12:39.116140 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:12:39.132481 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:12:39.133165 [info ] [MainThread]: 
[0m00:12:39.134030 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:12:39.135290 [info ] [MainThread]: 
[0m00:12:39.136634 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:12:39.139476 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.05935, "process_in_blocks": "0", "process_kernel_time": 0.551301, "process_mem_max_rss": "371720", "process_out_blocks": "3144", "process_user_time": 8.066144}
[0m00:12:39.141056 [debug] [MainThread]: Command `dbt run` succeeded at 00:12:39.140833 after 12.06 seconds
[0m00:12:39.142012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484b387e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484b2cbd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e484a1fd330>]}
[0m00:12:39.142862 [debug] [MainThread]: Flushing usage events
[0m00:12:40.030674 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:17:56.413280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea9738be50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea96202ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea96202f20>]}


============================== 00:17:56.418692 | b727bb01-3814-42b6-b213-167243025c87 ==============================
[0m00:17:56.418692 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:17:56.420279 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select arima_forecast', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:17:59.780637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b727bb01-3814-42b6-b213-167243025c87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea973075b0>]}
[0m00:17:59.920454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b727bb01-3814-42b6-b213-167243025c87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea96201330>]}
[0m00:17:59.921568 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:18:00.254792 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:18:00.453002 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:18:00.454112 [debug] [MainThread]: Partial parsing: updated file: gasag://macros/create_arima_model.sql
[0m00:18:01.029994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b727bb01-3814-42b6-b213-167243025c87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea6c660280>]}
[0m00:18:01.169708 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:18:01.173012 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:18:01.190610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b727bb01-3814-42b6-b213-167243025c87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea6c3ffe20>]}
[0m00:18:01.191487 [info ] [MainThread]: Found 5 models, 1 source, 494 macros
[0m00:18:01.192137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b727bb01-3814-42b6-b213-167243025c87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea6c3ff340>]}
[0m00:18:01.194303 [info ] [MainThread]: 
[0m00:18:01.195012 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:18:01.195583 [info ] [MainThread]: 
[0m00:18:01.196368 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:18:01.203587 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208_analysis'
[0m00:18:01.204312 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:18:03.241054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b727bb01-3814-42b6-b213-167243025c87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea961c6830>]}
[0m00:18:03.243883 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:18:03.253216 [debug] [Thread-1 (]: Began running node model.gasag.arima_forecast
[0m00:18:03.254996 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_forecast)
[0m00:18:03.256423 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_forecast
[0m00:18:03.281154 [debug] [Thread-1 (]: On model.gasag.arima_forecast: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_forecast"} */

    
        CREATE OR REPLACE MODEL `gasag-465208.analysis.arima_forecast`
        OPTIONS(
          model_type='ARIMA_PLUS',
          time_series_timestamp_col='Timestamp',
          time_series_data_col='leistung',
          time_series_id_col='Kraftwerk',
          auto_arima=TRUE,
          data_frequency='HOURLY',
          holiday_region='DE',
          -- Explicitly set seasonal parameters to help detect daily patterns
          seasonal_periods=[24]
        ) AS
        SELECT
          Timestamp,
          Kraftwerk,
          leistung
        FROM `gasag-465208.analysis.stg_kraftwerksdaten`
        WHERE leistung IS NOT NULL
          AND NOT is_forecast
    
  
[0m00:18:03.282312 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:18:03.839580 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:f054fded-1670-4bdf-8afc-9c445dcb19f5&page=queryresults
[0m00:18:03.841690 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:f054fded-1670-4bdf-8afc-9c445dcb19f5&page=queryresults
[0m00:18:03.852648 [debug] [Thread-1 (]: Database Error in model arima_forecast (models/marts/arima_forecast.sql)
  unsupported option seasonal_periods
[0m00:18:03.854533 [debug] [Thread-1 (]: Finished running node model.gasag.arima_forecast
[0m00:18:03.855994 [debug] [Thread-7 (]: Marking all children of 'model.gasag.arima_forecast' to be skipped because of status 'error'.  Reason: Database Error in model arima_forecast (models/marts/arima_forecast.sql)
  unsupported option seasonal_periods.
[0m00:18:03.859686 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:18:03.861126 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:18:03.861970 [debug] [MainThread]: Connection 'model.gasag.arima_forecast' was properly closed.
[0m00:18:03.862790 [info ] [MainThread]: 
[0m00:18:03.863693 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 2.67 seconds (2.67s).
[0m00:18:03.864850 [debug] [MainThread]: Command end result
[0m00:18:03.936181 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:18:03.940816 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:18:03.951194 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:18:03.961457 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.677586, "process_in_blocks": "8", "process_kernel_time": 0.508373, "process_mem_max_rss": "370796", "process_out_blocks": "3112", "process_user_time": 7.70934}
[0m00:18:03.963790 [debug] [MainThread]: Command `dbt run` succeeded at 00:18:03.963506 after 7.68 seconds
[0m00:18:03.965645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea9738be50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea97fcd7e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72ea96201330>]}
[0m00:18:03.967520 [debug] [MainThread]: Flushing usage events
[0m00:18:05.063786 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:21:22.800943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbd6e73df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbd5ce9690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbd5ce9630>]}


============================== 00:21:22.804509 | 229d4b97-c33c-442c-ae5b-ca3230ad5259 ==============================
[0m00:21:22.804509 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:21:22.805479 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run --select arima_predictions', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:21:26.243294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '229d4b97-c33c-442c-ae5b-ca3230ad5259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbac3eec50>]}
[0m00:21:26.412686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '229d4b97-c33c-442c-ae5b-ca3230ad5259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbd5f015d0>]}
[0m00:21:26.413676 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:21:26.733056 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:21:26.930754 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 0 files added, 1 files changed.
[0m00:21:26.931567 [debug] [MainThread]: Partial parsing: deleted file: gasag://macros/create_arima_model.sql
[0m00:21:26.932236 [debug] [MainThread]: Partial parsing: deleted file: gasag://models/marts/arima_forecast.sql
[0m00:21:26.933295 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/arima_predictions.sql
[0m00:21:27.533503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '229d4b97-c33c-442c-ae5b-ca3230ad5259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbaaf45990>]}
[0m00:21:27.678022 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:21:27.680491 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:21:27.697724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '229d4b97-c33c-442c-ae5b-ca3230ad5259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbabee95d0>]}
[0m00:21:27.698669 [info ] [MainThread]: Found 4 models, 1 source, 493 macros
[0m00:21:27.699357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '229d4b97-c33c-442c-ae5b-ca3230ad5259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbd5e2d120>]}
[0m00:21:27.701663 [info ] [MainThread]: 
[0m00:21:27.702330 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:21:27.702924 [info ] [MainThread]: 
[0m00:21:27.703873 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:21:27.705988 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:21:27.707278 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:21:29.987657 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:21:29.990625 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:21:30.799677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '229d4b97-c33c-442c-ae5b-ca3230ad5259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbac379b40>]}
[0m00:21:30.802210 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:21:30.815033 [debug] [Thread-1 (]: Began running node model.gasag.arima_predictions
[0m00:21:30.817760 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.arima_predictions ........................ [RUN]
[0m00:21:30.820711 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.arima_predictions)
[0m00:21:30.824508 [debug] [Thread-1 (]: Began compiling node model.gasag.arima_predictions
[0m00:21:30.868972 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.arima_predictions"
[0m00:21:30.873221 [debug] [Thread-1 (]: Began executing node model.gasag.arima_predictions
[0m00:21:30.926674 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:21:32.171745 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.arima_predictions"
[0m00:21:32.173590 [debug] [Thread-1 (]: On model.gasag.arima_predictions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.arima_predictions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`arima_predictions`
      
    
    

    OPTIONS()
    as (
      -- Generate simple predictions using historical hourly averages
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate historical hourly averages for each power plant
hourly_averages AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung,
        COUNT(*) as sample_count
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Generate missing hours for the last day
missing_hours AS (
    SELECT
        ha.Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS forecast_timestamp,
        ha.hour_of_day,
        ha.avg_hourly_leistung AS prognose
    FROM hourly_averages ha
    WHERE NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = ha.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m00:21:32.942153 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:b114f18f-c3bb-4bb5-8018-b3abda707c1b&page=queryresults
[0m00:21:36.465338 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '229d4b97-c33c-442c-ae5b-ca3230ad5259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbb51fc040>]}
[0m00:21:36.466547 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.arima_predictions ................... [[32mCREATE TABLE (40.0 rows, 180.1 KiB processed)[0m in 5.64s]
[0m00:21:36.467530 [debug] [Thread-1 (]: Finished running node model.gasag.arima_predictions
[0m00:21:36.469799 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:21:36.471483 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:21:36.472393 [debug] [MainThread]: Connection 'model.gasag.arima_predictions' was properly closed.
[0m00:21:36.473620 [info ] [MainThread]: 
[0m00:21:36.474663 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 8.77 seconds (8.77s).
[0m00:21:36.476181 [debug] [MainThread]: Command end result
[0m00:21:36.520893 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:21:36.523817 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:21:36.535530 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:21:36.536577 [info ] [MainThread]: 
[0m00:21:36.537747 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:21:36.538637 [info ] [MainThread]: 
[0m00:21:36.539640 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:21:36.541341 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 13.86312, "process_in_blocks": "0", "process_kernel_time": 0.519503, "process_mem_max_rss": "372576", "process_out_blocks": "3112", "process_user_time": 8.227304}
[0m00:21:36.542822 [debug] [MainThread]: Command `dbt run` succeeded at 00:21:36.542548 after 13.86 seconds
[0m00:21:36.543625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbd6e73df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbd5f015d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebbaaf44250>]}
[0m00:21:36.544383 [debug] [MainThread]: Flushing usage events
[0m00:21:37.652689 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:22:36.521124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7f278bdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7f1602ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7f1602f20>]}


============================== 00:22:36.525788 | c92b581f-38aa-4f3d-9319-fe3c21a92e95 ==============================
[0m00:22:36.525788 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:22:36.526857 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select power_forecasts', 'send_anonymous_usage_stats': 'True'}
[0m00:22:39.866986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c92b581f-38aa-4f3d-9319-fe3c21a92e95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7c7a06860>]}
[0m00:22:40.011331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c92b581f-38aa-4f3d-9319-fe3c21a92e95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7f1601330>]}
[0m00:22:40.012450 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:22:40.363714 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:22:40.573006 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m00:22:40.573891 [debug] [MainThread]: Partial parsing: added file: gasag://models/marts/power_forecasts.sql
[0m00:22:40.574490 [debug] [MainThread]: Partial parsing: deleted file: gasag://models/marts/arima_predictions.sql
[0m00:22:41.134619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c92b581f-38aa-4f3d-9319-fe3c21a92e95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7c63557b0>]}
[0m00:22:41.265345 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:22:41.267981 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:22:41.284264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c92b581f-38aa-4f3d-9319-fe3c21a92e95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7c63558d0>]}
[0m00:22:41.285278 [info ] [MainThread]: Found 4 models, 1 source, 493 macros
[0m00:22:41.286212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c92b581f-38aa-4f3d-9319-fe3c21a92e95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7c790f940>]}
[0m00:22:41.288304 [info ] [MainThread]: 
[0m00:22:41.289015 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:22:41.289671 [info ] [MainThread]: 
[0m00:22:41.290545 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:22:41.291997 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:22:41.293197 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:22:43.416692 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:22:43.418855 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:22:44.012610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c92b581f-38aa-4f3d-9319-fe3c21a92e95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7c766ed10>]}
[0m00:22:44.014848 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:22:44.025765 [debug] [Thread-1 (]: Began running node model.gasag.power_forecasts
[0m00:22:44.027943 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.power_forecasts .......................... [RUN]
[0m00:22:44.029874 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.power_forecasts)
[0m00:22:44.031678 [debug] [Thread-1 (]: Began compiling node model.gasag.power_forecasts
[0m00:22:44.062622 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.power_forecasts"
[0m00:22:44.064477 [debug] [Thread-1 (]: Began executing node model.gasag.power_forecasts
[0m00:22:44.137688 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.power_forecasts"
[0m00:22:44.138779 [debug] [Thread-1 (]: On model.gasag.power_forecasts: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.power_forecasts"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`power_forecasts`
      
    
    

    OPTIONS()
    as (
      -- Generate simple predictions using historical hourly averages
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate historical hourly averages for each power plant
hourly_averages AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung,
        COUNT(*) as sample_count
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Generate missing hours for the last day
missing_hours AS (
    SELECT
        ha.Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS forecast_timestamp,
        ha.hour_of_day,
        ha.avg_hourly_leistung AS prognose
    FROM hourly_averages ha
    WHERE NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = ha.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m00:22:44.139657 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:22:44.905888 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:eeda598b-281b-4f4c-82b6-30c5c173a17b&page=queryresults
[0m00:22:47.738196 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c92b581f-38aa-4f3d-9319-fe3c21a92e95', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7c6354e50>]}
[0m00:22:47.739663 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.power_forecasts ..................... [[32mCREATE TABLE (40.0 rows, 180.1 KiB processed)[0m in 3.71s]
[0m00:22:47.740756 [debug] [Thread-1 (]: Finished running node model.gasag.power_forecasts
[0m00:22:47.742534 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:22:47.743533 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:22:47.744105 [debug] [MainThread]: Connection 'model.gasag.power_forecasts' was properly closed.
[0m00:22:47.744724 [info ] [MainThread]: 
[0m00:22:47.745337 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.45 seconds (6.45s).
[0m00:22:47.747210 [debug] [MainThread]: Command end result
[0m00:22:47.789807 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:22:47.792736 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:22:47.808132 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:22:47.809360 [info ] [MainThread]: 
[0m00:22:47.810732 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:22:47.811871 [info ] [MainThread]: 
[0m00:22:47.813306 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:22:47.816525 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.420542, "process_in_blocks": "0", "process_kernel_time": 0.508117, "process_mem_max_rss": "372060", "process_out_blocks": "3136", "process_user_time": 8.002108}
[0m00:22:47.819026 [debug] [MainThread]: Command `dbt run` succeeded at 00:22:47.818601 after 11.42 seconds
[0m00:22:47.820524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7f278bdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7f26e0c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df7f1601330>]}
[0m00:22:47.822347 [debug] [MainThread]: Flushing usage events
[0m00:22:48.823296 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:25:36.398599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1da0283e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1d9f0f6ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1d9f0f6f20>]}


============================== 00:25:36.403036 | 92f39601-8e06-48df-afd6-4ac9e509a780 ==============================
[0m00:25:36.403036 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:25:36.404114 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select today_power_data', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:25:39.813460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '92f39601-8e06-48df-afd6-4ac9e509a780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1d9f23d4e0>]}
[0m00:25:39.965576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '92f39601-8e06-48df-afd6-4ac9e509a780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1da01fdcc0>]}
[0m00:25:39.966635 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:25:40.280829 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:25:40.469842 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m00:25:40.470706 [debug] [MainThread]: Partial parsing: added file: gasag://models/marts/today_power_data.sql
[0m00:25:41.022073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '92f39601-8e06-48df-afd6-4ac9e509a780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1d74139e10>]}
[0m00:25:41.153917 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:25:41.156229 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:25:41.172838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '92f39601-8e06-48df-afd6-4ac9e509a780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1d74120700>]}
[0m00:25:41.173673 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m00:25:41.174312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92f39601-8e06-48df-afd6-4ac9e509a780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1d741207c0>]}
[0m00:25:41.177063 [info ] [MainThread]: 
[0m00:25:41.177878 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:25:41.178667 [info ] [MainThread]: 
[0m00:25:41.180678 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:25:41.183080 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:25:41.183889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:25:43.524723 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:25:43.526368 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:25:44.031611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '92f39601-8e06-48df-afd6-4ac9e509a780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1d9f0ba860>]}
[0m00:25:44.033837 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:25:44.040391 [debug] [Thread-1 (]: Began running node model.gasag.today_power_data
[0m00:25:44.042344 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.today_power_data ......................... [RUN]
[0m00:25:44.043859 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.today_power_data)
[0m00:25:44.045597 [debug] [Thread-1 (]: Began compiling node model.gasag.today_power_data
[0m00:25:44.064315 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.today_power_data"
[0m00:25:44.065449 [debug] [Thread-1 (]: Began executing node model.gasag.today_power_data
[0m00:25:44.134348 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.today_power_data"
[0m00:25:44.135445 [debug] [Thread-1 (]: On model.gasag.today_power_data: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.today_power_data"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`today_power_data`
      
    
    

    OPTIONS()
    as (
      -- Combined table with actual and predicted data for today
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate historical hourly averages for predictions
hourly_averages AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Get actual data for the last day
actual_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        hour_of_day,
        leistung as prognose,
        FALSE as is_forecast,
        'actual' as data_type
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE DATE(Timestamp) = (SELECT last_date FROM last_day_info)
      AND leistung IS NOT NULL
),

-- Generate predictions for missing hours
predicted_data AS (
    SELECT
        ha.Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS Timestamp,
        ha.hour_of_day,
        ha.avg_hourly_leistung AS prognose,
        TRUE as is_forecast,
        'predicted' as data_type
    FROM hourly_averages ha
    WHERE NOT EXISTS (
        SELECT 1 FROM actual_data existing
        WHERE existing.Kraftwerk = ha.Kraftwerk
        AND existing.hour_of_day = ha.hour_of_day
    )
)

-- Combine actual and predicted data
SELECT
    Kraftwerk,
    Timestamp,
    hour_of_day,
    prognose,
    is_forecast,
    data_type,
    -- Add some useful metadata
    (SELECT last_date FROM last_day_info) as forecast_date,
    CASE
        WHEN is_forecast THEN 'Predicted based on historical average'
        ELSE 'Actual measurement'
    END as data_source
FROM (
    SELECT * FROM actual_data
    UNION ALL
    SELECT * FROM predicted_data
)
ORDER BY Kraftwerk, Timestamp
    );
  
[0m00:25:44.136231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:25:44.987724 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:21a149ba-347b-46d2-a8ae-94992beca3e3&page=queryresults
[0m00:25:45.364559 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:21a149ba-347b-46d2-a8ae-94992beca3e3&page=queryresults
[0m00:25:45.375308 [debug] [Thread-1 (]: Database Error in model today_power_data (models/marts/today_power_data.sql)
  Column 2 in UNION ALL has incompatible types: TIMESTAMP, DATETIME at [83:5]
  compiled code at target/run/gasag/models/marts/today_power_data.sql
[0m00:25:45.380854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '92f39601-8e06-48df-afd6-4ac9e509a780', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1d752cb880>]}
[0m00:25:45.382597 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.today_power_data ................ [[31mERROR[0m in 1.33s]
[0m00:25:45.384207 [debug] [Thread-1 (]: Finished running node model.gasag.today_power_data
[0m00:25:45.385543 [debug] [Thread-7 (]: Marking all children of 'model.gasag.today_power_data' to be skipped because of status 'error'.  Reason: Database Error in model today_power_data (models/marts/today_power_data.sql)
  Column 2 in UNION ALL has incompatible types: TIMESTAMP, DATETIME at [83:5]
  compiled code at target/run/gasag/models/marts/today_power_data.sql.
[0m00:25:45.388460 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:25:45.389695 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:25:45.390619 [debug] [MainThread]: Connection 'model.gasag.today_power_data' was properly closed.
[0m00:25:45.391956 [info ] [MainThread]: 
[0m00:25:45.393463 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 4.21 seconds (4.21s).
[0m00:25:45.395625 [debug] [MainThread]: Command end result
[0m00:25:45.443191 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:25:45.446648 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:25:45.456017 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:25:45.456742 [info ] [MainThread]: 
[0m00:25:45.457652 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:25:45.459048 [info ] [MainThread]: 
[0m00:25:45.459894 [error] [MainThread]: [31mFailure in model today_power_data (models/marts/today_power_data.sql)[0m
[0m00:25:45.460651 [error] [MainThread]:   Database Error in model today_power_data (models/marts/today_power_data.sql)
  Column 2 in UNION ALL has incompatible types: TIMESTAMP, DATETIME at [83:5]
  compiled code at target/run/gasag/models/marts/today_power_data.sql
[0m00:25:45.462067 [info ] [MainThread]: 
[0m00:25:45.463518 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/today_power_data.sql
[0m00:25:45.464188 [info ] [MainThread]: 
[0m00:25:45.464895 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m00:25:45.466283 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 9.195411, "process_in_blocks": "0", "process_kernel_time": 0.506379, "process_mem_max_rss": "369272", "process_out_blocks": "3160", "process_user_time": 7.900313}
[0m00:25:45.467154 [debug] [MainThread]: Command `dbt run` failed at 00:25:45.467008 after 9.20 seconds
[0m00:25:45.467793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1da0283e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1da01c7d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1da05b9720>]}
[0m00:25:45.468444 [debug] [MainThread]: Flushing usage events
[0m00:25:46.592642 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:26:12.920809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a95373e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a941e96c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a941e9660>]}


============================== 00:26:12.924623 | 309b16bc-55e2-4df2-8d59-ccc7b4f1e591 ==============================
[0m00:26:12.924623 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:26:12.925427 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run --select today_power_data', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:26:16.292253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '309b16bc-55e2-4df2-8d59-ccc7b4f1e591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a96f3b760>]}
[0m00:26:16.494261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '309b16bc-55e2-4df2-8d59-ccc7b4f1e591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a941eb250>]}
[0m00:26:16.495427 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:26:16.839928 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:26:17.056642 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:26:17.057648 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/today_power_data.sql
[0m00:26:17.712570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '309b16bc-55e2-4df2-8d59-ccc7b4f1e591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a68f45de0>]}
[0m00:26:17.853648 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:26:17.856855 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:26:17.873727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '309b16bc-55e2-4df2-8d59-ccc7b4f1e591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a6a2c1f30>]}
[0m00:26:17.874584 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m00:26:17.875211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '309b16bc-55e2-4df2-8d59-ccc7b4f1e591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a6a2c2050>]}
[0m00:26:17.877312 [info ] [MainThread]: 
[0m00:26:17.877984 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:26:17.878563 [info ] [MainThread]: 
[0m00:26:17.879381 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:26:17.880804 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:26:17.882352 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:26:19.791332 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:26:19.792646 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:26:20.391016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '309b16bc-55e2-4df2-8d59-ccc7b4f1e591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a96f4d630>]}
[0m00:26:20.392707 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:26:20.399482 [debug] [Thread-1 (]: Began running node model.gasag.today_power_data
[0m00:26:20.401239 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.today_power_data ......................... [RUN]
[0m00:26:20.402317 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.today_power_data)
[0m00:26:20.403306 [debug] [Thread-1 (]: Began compiling node model.gasag.today_power_data
[0m00:26:20.418144 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.today_power_data"
[0m00:26:20.419284 [debug] [Thread-1 (]: Began executing node model.gasag.today_power_data
[0m00:26:20.487507 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.today_power_data"
[0m00:26:20.488703 [debug] [Thread-1 (]: On model.gasag.today_power_data: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.today_power_data"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`today_power_data`
      
    
    

    OPTIONS()
    as (
      -- Combined table with actual and predicted data for today
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate historical hourly averages for predictions
hourly_averages AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Get actual data for the last day
actual_data AS (
    SELECT
        Kraftwerk,
        CAST(Timestamp AS TIMESTAMP) as Timestamp,
        hour_of_day,
        leistung as prognose,
        FALSE as is_forecast,
        'actual' as data_type
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE DATE(Timestamp) = (SELECT last_date FROM last_day_info)
      AND leistung IS NOT NULL
),

-- Generate predictions for missing hours
predicted_data AS (
    SELECT
        ha.Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS Timestamp,
        ha.hour_of_day,
        ha.avg_hourly_leistung AS prognose,
        TRUE as is_forecast,
        'predicted' as data_type
    FROM hourly_averages ha
    WHERE NOT EXISTS (
        SELECT 1 FROM actual_data existing
        WHERE existing.Kraftwerk = ha.Kraftwerk
        AND existing.hour_of_day = ha.hour_of_day
    )
)

-- Combine actual and predicted data
SELECT
    Kraftwerk,
    Timestamp,
    hour_of_day,
    prognose,
    is_forecast,
    data_type,
    -- Add some useful metadata
    (SELECT last_date FROM last_day_info) as forecast_date,
    CASE
        WHEN is_forecast THEN 'Predicted based on historical average'
        ELSE 'Actual measurement'
    END as data_source
FROM (
    SELECT * FROM actual_data
    UNION ALL
    SELECT * FROM predicted_data
)
ORDER BY Kraftwerk, Timestamp
    );
  
[0m00:26:20.489549 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:26:21.467987 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:845b38a5-0be3-4587-a12a-3d0950695d25&page=queryresults
[0m00:26:21.818172 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:845b38a5-0be3-4587-a12a-3d0950695d25&page=queryresults
[0m00:26:21.829539 [debug] [Thread-1 (]: Database Error in model today_power_data (models/marts/today_power_data.sql)
  Column 2 in UNION ALL has incompatible types: TIMESTAMP, DATETIME at [83:5]
  compiled code at target/run/gasag/models/marts/today_power_data.sql
[0m00:26:21.835305 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '309b16bc-55e2-4df2-8d59-ccc7b4f1e591', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a6a2c14e0>]}
[0m00:26:21.837131 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model analysis.today_power_data ................ [[31mERROR[0m in 1.43s]
[0m00:26:21.838954 [debug] [Thread-1 (]: Finished running node model.gasag.today_power_data
[0m00:26:21.840317 [debug] [Thread-7 (]: Marking all children of 'model.gasag.today_power_data' to be skipped because of status 'error'.  Reason: Database Error in model today_power_data (models/marts/today_power_data.sql)
  Column 2 in UNION ALL has incompatible types: TIMESTAMP, DATETIME at [83:5]
  compiled code at target/run/gasag/models/marts/today_power_data.sql.
[0m00:26:21.843903 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:26:21.845065 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:26:21.845708 [debug] [MainThread]: Connection 'model.gasag.today_power_data' was properly closed.
[0m00:26:21.846377 [info ] [MainThread]: 
[0m00:26:21.847577 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.97 seconds (3.97s).
[0m00:26:21.849512 [debug] [MainThread]: Command end result
[0m00:26:21.886804 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:26:21.889645 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:26:21.901566 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:26:21.902286 [info ] [MainThread]: 
[0m00:26:21.903109 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m00:26:21.903796 [info ] [MainThread]: 
[0m00:26:21.904615 [error] [MainThread]: [31mFailure in model today_power_data (models/marts/today_power_data.sql)[0m
[0m00:26:21.905361 [error] [MainThread]:   Database Error in model today_power_data (models/marts/today_power_data.sql)
  Column 2 in UNION ALL has incompatible types: TIMESTAMP, DATETIME at [83:5]
  compiled code at target/run/gasag/models/marts/today_power_data.sql
[0m00:26:21.906013 [info ] [MainThread]: 
[0m00:26:21.906794 [info ] [MainThread]:   compiled code at target/compiled/gasag/models/marts/today_power_data.sql
[0m00:26:21.907367 [info ] [MainThread]: 
[0m00:26:21.908050 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=1
[0m00:26:21.909425 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 9.112615, "process_in_blocks": "0", "process_kernel_time": 0.508363, "process_mem_max_rss": "369276", "process_out_blocks": "3136", "process_user_time": 8.165771}
[0m00:26:21.910517 [debug] [MainThread]: Command `dbt run` failed at 00:26:21.910350 after 9.11 seconds
[0m00:26:21.911172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a95373e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a96f4d630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2a6a1719f0>]}
[0m00:26:21.911856 [debug] [MainThread]: Flushing usage events
[0m00:26:23.046590 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:26:51.977560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79485b57fdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79485a3f9690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79485a3f9630>]}


============================== 00:26:51.981378 | 4beac942-1394-4ebb-b9af-4363f7ab122b ==============================
[0m00:26:51.981378 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:26:51.982459 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select today_power_data', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:26:55.252331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4beac942-1394-4ebb-b9af-4363f7ab122b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794830ae2c50>]}
[0m00:26:55.403286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4beac942-1394-4ebb-b9af-4363f7ab122b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79485a60d5d0>]}
[0m00:26:55.404455 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:26:55.727407 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:26:55.909151 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:26:55.910206 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/today_power_data.sql
[0m00:26:56.439530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4beac942-1394-4ebb-b9af-4363f7ab122b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7948303f1d80>]}
[0m00:26:56.571693 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:26:56.575342 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:26:56.592230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4beac942-1394-4ebb-b9af-4363f7ab122b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79482f234dc0>]}
[0m00:26:56.593085 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m00:26:56.593756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4beac942-1394-4ebb-b9af-4363f7ab122b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79482f2366e0>]}
[0m00:26:56.595905 [info ] [MainThread]: 
[0m00:26:56.596743 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:26:56.597372 [info ] [MainThread]: 
[0m00:26:56.598523 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:26:56.600217 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:26:56.601114 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:26:58.492059 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:26:58.493979 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:26:59.401332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4beac942-1394-4ebb-b9af-4363f7ab122b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79485a3ba800>]}
[0m00:26:59.403472 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:26:59.411289 [debug] [Thread-1 (]: Began running node model.gasag.today_power_data
[0m00:26:59.413291 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.today_power_data ......................... [RUN]
[0m00:26:59.414554 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.today_power_data)
[0m00:26:59.415604 [debug] [Thread-1 (]: Began compiling node model.gasag.today_power_data
[0m00:26:59.444990 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.today_power_data"
[0m00:26:59.446070 [debug] [Thread-1 (]: Began executing node model.gasag.today_power_data
[0m00:26:59.522634 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.today_power_data"
[0m00:26:59.524274 [debug] [Thread-1 (]: On model.gasag.today_power_data: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.today_power_data"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`today_power_data`
      
    
    

    OPTIONS()
    as (
      -- Combined table with actual and predicted data for today
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate historical hourly averages for predictions
hourly_averages AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Get actual data for the last day
actual_data AS (
    SELECT
        Kraftwerk,
        CAST(Timestamp AS TIMESTAMP) as Timestamp,
        hour_of_day,
        leistung as prognose,
        FALSE as is_forecast,
        'actual' as data_type
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE DATE(Timestamp) = (SELECT last_date FROM last_day_info)
      AND leistung IS NOT NULL
),

-- Generate predictions for missing hours
predicted_data AS (
    SELECT
        ha.Kraftwerk,
        CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS TIMESTAMP) AS Timestamp,
        ha.hour_of_day,
        ha.avg_hourly_leistung AS prognose,
        TRUE as is_forecast,
        'predicted' as data_type
    FROM hourly_averages ha
    WHERE NOT EXISTS (
        SELECT 1 FROM actual_data existing
        WHERE existing.Kraftwerk = ha.Kraftwerk
        AND existing.hour_of_day = ha.hour_of_day
    )
)

-- Combine actual and predicted data
SELECT
    Kraftwerk,
    Timestamp,
    hour_of_day,
    prognose,
    is_forecast,
    data_type,
    -- Add some useful metadata
    (SELECT last_date FROM last_day_info) as forecast_date,
    CASE
        WHEN is_forecast THEN 'Predicted based on historical average'
        ELSE 'Actual measurement'
    END as data_source
FROM (
    SELECT * FROM actual_data
    UNION ALL
    SELECT * FROM predicted_data
)
ORDER BY Kraftwerk, Timestamp
    );
  
[0m00:26:59.525132 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:27:00.308477 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:71d74554-0572-490a-8063-44733805eb72&page=queryresults
[0m00:27:03.235237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4beac942-1394-4ebb-b9af-4363f7ab122b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7948358ec4f0>]}
[0m00:27:03.236668 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.today_power_data .................... [[32mCREATE TABLE (120.0 rows, 180.1 KiB processed)[0m in 3.82s]
[0m00:27:03.238904 [debug] [Thread-1 (]: Finished running node model.gasag.today_power_data
[0m00:27:03.241161 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:27:03.242241 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:27:03.242833 [debug] [MainThread]: Connection 'model.gasag.today_power_data' was properly closed.
[0m00:27:03.243587 [info ] [MainThread]: 
[0m00:27:03.244213 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.65 seconds (6.65s).
[0m00:27:03.245854 [debug] [MainThread]: Command end result
[0m00:27:03.283715 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:27:03.286509 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:27:03.296999 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:27:03.297729 [info ] [MainThread]: 
[0m00:27:03.298426 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:27:03.299017 [info ] [MainThread]: 
[0m00:27:03.299671 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:27:03.301886 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.446402, "process_in_blocks": "0", "process_kernel_time": 0.511668, "process_mem_max_rss": "372116", "process_out_blocks": "3144", "process_user_time": 7.864536}
[0m00:27:03.303095 [debug] [MainThread]: Command `dbt run` succeeded at 00:27:03.302934 after 11.45 seconds
[0m00:27:03.304277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79485b57fdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7948303e4520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794830ae31c0>]}
[0m00:27:03.306244 [debug] [MainThread]: Flushing usage events
[0m00:27:04.318594 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:33:15.845488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc364f8bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc363e02ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc363e02f20>]}


============================== 00:33:15.849099 | e50a1fea-5879-48ab-8af0-fa9312494c26 ==============================
[0m00:33:15.849099 [info ] [MainThread]: Running with dbt=1.10.3
[0m00:33:15.849911 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/home/anton/.dbt', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select today_power_data', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:33:19.362817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e50a1fea-5879-48ab-8af0-fa9312494c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc33a206c50>]}
[0m00:33:19.527380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e50a1fea-5879-48ab-8af0-fa9312494c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc36401d5d0>]}
[0m00:33:19.528422 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m00:33:19.858661 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m00:33:20.057926 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m00:33:20.058916 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/today_power_data.sql
[0m00:33:20.658228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e50a1fea-5879-48ab-8af0-fa9312494c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc338b3dd80>]}
[0m00:33:20.809072 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:33:20.811481 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:33:20.827791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e50a1fea-5879-48ab-8af0-fa9312494c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc338b2b250>]}
[0m00:33:20.829355 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m00:33:20.830710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e50a1fea-5879-48ab-8af0-fa9312494c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc338b29930>]}
[0m00:33:20.832896 [info ] [MainThread]: 
[0m00:33:20.834228 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:33:20.835533 [info ] [MainThread]: 
[0m00:33:20.836914 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m00:33:20.840044 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m00:33:20.840942 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:33:22.703033 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m00:33:22.704479 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:33:23.267291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e50a1fea-5879-48ab-8af0-fa9312494c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc363dc6800>]}
[0m00:33:23.268247 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:33:23.272299 [debug] [Thread-1 (]: Began running node model.gasag.today_power_data
[0m00:33:23.273284 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.today_power_data ......................... [RUN]
[0m00:33:23.274124 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.today_power_data)
[0m00:33:23.275120 [debug] [Thread-1 (]: Began compiling node model.gasag.today_power_data
[0m00:33:23.288699 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.today_power_data"
[0m00:33:23.289889 [debug] [Thread-1 (]: Began executing node model.gasag.today_power_data
[0m00:33:23.311268 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:33:23.946104 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.today_power_data"
[0m00:33:23.947255 [debug] [Thread-1 (]: On model.gasag.today_power_data: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.today_power_data"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`today_power_data`
      
    
    

    OPTIONS()
    as (
      -- Combined table with actual and predicted data for today
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate historical hourly averages for predictions
hourly_averages AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Get actual data for the last day
actual_data AS (
    SELECT
        Kraftwerk,
        CAST(Timestamp AS TIMESTAMP) as Timestamp,
        hour_of_day,
        leistung as Leistung,
        NULL as Prognose
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE DATE(Timestamp) = (SELECT last_date FROM last_day_info)
      AND leistung IS NOT NULL
),

-- Generate predictions for missing hours
predicted_data AS (
    SELECT
        ha.Kraftwerk,
        CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS TIMESTAMP) AS Timestamp,
        ha.hour_of_day,
        NULL as Leistung,
        ha.avg_hourly_leistung AS Prognose
    FROM hourly_averages ha
    WHERE NOT EXISTS (
        SELECT 1 FROM actual_data existing
        WHERE existing.Kraftwerk = ha.Kraftwerk
        AND existing.hour_of_day = ha.hour_of_day
    )
)

-- Combine actual and predicted data
SELECT
    Kraftwerk,
    Timestamp,
    hour_of_day,
    Leistung,
    Prognose,
    -- Add some useful metadata
    (SELECT last_date FROM last_day_info) as forecast_date
FROM (
    SELECT * FROM actual_data
    UNION ALL
    SELECT * FROM predicted_data
)
ORDER BY Kraftwerk, Timestamp
    );
  
[0m00:33:24.515399 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:73ef3d00-1db0-46ef-a8d9-ebf38b55986c&page=queryresults
[0m00:33:27.334995 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e50a1fea-5879-48ab-8af0-fa9312494c26', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc33f0104f0>]}
[0m00:33:27.336878 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.today_power_data .................... [[32mCREATE TABLE (120.0 rows, 180.1 KiB processed)[0m in 4.06s]
[0m00:33:27.338431 [debug] [Thread-1 (]: Finished running node model.gasag.today_power_data
[0m00:33:27.340484 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:33:27.341489 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:33:27.342054 [debug] [MainThread]: Connection 'model.gasag.today_power_data' was properly closed.
[0m00:33:27.342776 [info ] [MainThread]: 
[0m00:33:27.343465 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.51 seconds (6.51s).
[0m00:33:27.345138 [debug] [MainThread]: Command end result
[0m00:33:27.380919 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m00:33:27.384085 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m00:33:27.394670 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m00:33:27.395454 [info ] [MainThread]: 
[0m00:33:27.396308 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:33:27.396979 [info ] [MainThread]: 
[0m00:33:27.397777 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m00:33:27.399653 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.682786, "process_in_blocks": "0", "process_kernel_time": 0.529675, "process_mem_max_rss": "372248", "process_out_blocks": "3144", "process_user_time": 8.134665}
[0m00:33:27.400809 [debug] [MainThread]: Command `dbt run` succeeded at 00:33:27.400637 after 11.68 seconds
[0m00:33:27.401550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc364f8bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc36401d5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc364e57640>]}
[0m00:33:27.402971 [debug] [MainThread]: Flushing usage events
[0m00:33:28.303184 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:17:07.795508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ad2948bdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ad28302ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ad28302f20>]}


============================== 08:17:07.800995 | 5d5f9211-1a77-4801-a453-db0251a0b64e ==============================
[0m08:17:07.800995 [info ] [MainThread]: Running with dbt=1.10.3
[0m08:17:07.802168 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'profiles_dir': '/home/anton/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select today_power_data', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True'}
[0m08:17:11.115396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d5f9211-1a77-4801-a453-db0251a0b64e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74acfe60a860>]}
[0m08:17:11.259089 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d5f9211-1a77-4801-a453-db0251a0b64e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ad28301330>]}
[0m08:17:11.260614 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m08:17:11.596448 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m08:17:11.787197 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m08:17:11.788730 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/today_power_data.sql
[0m08:17:12.341828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d5f9211-1a77-4801-a453-db0251a0b64e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74acfcf41d80>]}
[0m08:17:12.469827 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m08:17:12.473003 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m08:17:12.489683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d5f9211-1a77-4801-a453-db0251a0b64e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74acfcf2f100>]}
[0m08:17:12.490669 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m08:17:12.492323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d5f9211-1a77-4801-a453-db0251a0b64e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74acfcf2f1c0>]}
[0m08:17:12.494729 [info ] [MainThread]: 
[0m08:17:12.495434 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:17:12.496005 [info ] [MainThread]: 
[0m08:17:12.496862 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:17:12.498378 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m08:17:12.499210 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:17:14.334126 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m08:17:14.335177 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:17:15.085853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d5f9211-1a77-4801-a453-db0251a0b64e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ad282c67a0>]}
[0m08:17:15.089286 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:17:15.100611 [debug] [Thread-1 (]: Began running node model.gasag.today_power_data
[0m08:17:15.102239 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.today_power_data ......................... [RUN]
[0m08:17:15.103989 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.today_power_data)
[0m08:17:15.106064 [debug] [Thread-1 (]: Began compiling node model.gasag.today_power_data
[0m08:17:15.126141 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.today_power_data"
[0m08:17:15.127809 [debug] [Thread-1 (]: Began executing node model.gasag.today_power_data
[0m08:17:15.149602 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:17:15.740402 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.today_power_data"
[0m08:17:15.742324 [debug] [Thread-1 (]: On model.gasag.today_power_data: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.today_power_data"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`today_power_data`
      
    
    

    OPTIONS()
    as (
      -- Combined table with actual and predicted data for today
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Get the last actual measurement time for each power plant
last_measurements AS (
    SELECT
        Kraftwerk,
        MAX(Timestamp) as last_actual_time
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk
),

-- Calculate historical hourly averages for predictions
hourly_averages AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Get actual data for the last day
actual_data AS (
    SELECT
        Kraftwerk,
        CAST(Timestamp AS TIMESTAMP) as Timestamp,
        hour_of_day,
        leistung as Leistung,
        NULL as Prognose
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE DATE(Timestamp) = (SELECT last_date FROM last_day_info)
      AND leistung IS NOT NULL
),

-- Generate predictions only for hours AFTER the last actual measurement
predicted_data AS (
    SELECT
        ha.Kraftwerk,
        CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS TIMESTAMP) AS Timestamp,
        ha.hour_of_day,
        NULL as Leistung,
        ha.avg_hourly_leistung AS Prognose
    FROM hourly_averages ha
    JOIN last_measurements lm ON ha.Kraftwerk = lm.Kraftwerk
    WHERE ha.hour_of_day > EXTRACT(HOUR FROM lm.last_actual_time)
      AND NOT EXISTS (
        SELECT 1 FROM actual_data existing
        WHERE existing.Kraftwerk = ha.Kraftwerk
        AND existing.hour_of_day = ha.hour_of_day
    )
)

-- Combine actual and predicted data
SELECT
    Kraftwerk,
    Timestamp,
    hour_of_day,
    Leistung,
    Prognose,
    -- Add some useful metadata
    (SELECT last_date FROM last_day_info) as forecast_date
FROM (
    SELECT * FROM actual_data
    UNION ALL
    SELECT * FROM predicted_data
)
ORDER BY Kraftwerk, Timestamp
    );
  
[0m08:17:16.413254 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:0594ab3a-6409-4c54-bec0-560f6616e99b&page=queryresults
[0m08:17:19.369481 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5d5f9211-1a77-4801-a453-db0251a0b64e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ad03414220>]}
[0m08:17:19.371178 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.today_power_data .................... [[32mCREATE TABLE (119.0 rows, 180.1 KiB processed)[0m in 4.26s]
[0m08:17:19.372534 [debug] [Thread-1 (]: Finished running node model.gasag.today_power_data
[0m08:17:19.375128 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:17:19.376300 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:17:19.376873 [debug] [MainThread]: Connection 'model.gasag.today_power_data' was properly closed.
[0m08:17:19.377718 [info ] [MainThread]: 
[0m08:17:19.378652 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.88 seconds (6.88s).
[0m08:17:19.380399 [debug] [MainThread]: Command end result
[0m08:17:19.415418 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m08:17:19.417655 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m08:17:19.427963 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m08:17:19.428872 [info ] [MainThread]: 
[0m08:17:19.429702 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:17:19.430315 [info ] [MainThread]: 
[0m08:17:19.430938 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m08:17:19.432348 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.761311, "process_in_blocks": "0", "process_kernel_time": 0.512755, "process_mem_max_rss": "372300", "process_out_blocks": "3144", "process_user_time": 8.006567}
[0m08:17:19.433214 [debug] [MainThread]: Command `dbt run` succeeded at 08:17:19.433068 after 11.76 seconds
[0m08:17:19.433856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ad2948bdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74acfe0f4eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ad28301330>]}
[0m08:17:19.434569 [debug] [MainThread]: Flushing usage events
[0m08:17:20.991705 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:19:26.999047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e8238bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e81202ec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e81202f20>]}


============================== 08:19:27.002947 | f54e18e5-3f82-41a5-b6d1-de6791d14a94 ==============================
[0m08:19:27.002947 [info ] [MainThread]: Running with dbt=1.10.3
[0m08:19:27.003999 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'profiles_dir': '/home/anton/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m08:19:30.258190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e57761ed0>]}
[0m08:19:30.401472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e81201330>]}
[0m08:19:30.402635 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m08:19:30.735343 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m08:19:30.924465 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:19:30.925524 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:19:30.991216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e5726f7f0>]}
[0m08:19:31.129252 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m08:19:31.131891 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m08:19:31.147437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e5710ffa0>]}
[0m08:19:31.148403 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m08:19:31.149125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e5710df60>]}
[0m08:19:31.151678 [info ] [MainThread]: 
[0m08:19:31.152365 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:19:31.152944 [info ] [MainThread]: 
[0m08:19:31.153762 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:19:31.162094 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m08:19:31.163103 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:19:32.916912 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m08:19:32.919513 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:19:33.529942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e811c2770>]}
[0m08:19:33.532252 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:19:33.543642 [debug] [Thread-1 (]: Began running node model.gasag.stg_kraftwerksdaten
[0m08:19:33.546748 [info ] [Thread-1 (]: 1 of 5 START sql table model analysis.stg_kraftwerksdaten ...................... [RUN]
[0m08:19:33.549414 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.stg_kraftwerksdaten)
[0m08:19:33.551727 [debug] [Thread-1 (]: Began compiling node model.gasag.stg_kraftwerksdaten
[0m08:19:33.609577 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.stg_kraftwerksdaten"
[0m08:19:33.612994 [debug] [Thread-1 (]: Began executing node model.gasag.stg_kraftwerksdaten
[0m08:19:33.639326 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:19:34.189228 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.stg_kraftwerksdaten"
[0m08:19:34.190546 [debug] [Thread-1 (]: On model.gasag.stg_kraftwerksdaten: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.stg_kraftwerksdaten"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Flag decreasing meter readings
        CASE
            WHEN LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))
            > Zaehlerstand
            THEN TRUE
            ELSE FALSE
        END AS is_decreasing_zaehlerstand
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

max_date AS (
    SELECT MAX(DATE(PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp))) as last_date
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

cleaned_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        Zaehlerstand,
        is_decreasing_zaehlerstand,
        -- Flag last day dynamically
        CASE
            WHEN DATE(Timestamp) = (SELECT last_date FROM max_date) THEN TRUE
            ELSE FALSE
        END AS is_last_day,
        -- Calculate Leistung (NULL for decreasing readings or first timestamp)
        CASE
            WHEN is_decreasing_zaehlerstand THEN NULL
            ELSE Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY Timestamp)
        END AS leistung
    FROM raw_data
)

SELECT
    Kraftwerk,
    Timestamp,
    EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
    Zaehlerstand,
    is_decreasing_zaehlerstand,
    is_last_day,
    leistung,
    -- Flag peak loads > 50MW (only for non-NULL Leistung)
    CASE
        WHEN leistung IS NOT NULL AND leistung > 50 THEN TRUE
        ELSE FALSE
    END AS is_peak_load,
    -- Flag for forecast data (will be populated by ARIMA model)
    FALSE AS is_forecast,
    -- Prognose will be populated by ARIMA model
    NULL AS prognose
FROM cleaned_data
WHERE Timestamp > TIMESTAMP('2024-01-01 00:00:00')
ORDER BY Kraftwerk, Timestamp
    );
  
[0m08:19:34.739242 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:e943fa5c-bd43-458c-987d-663bba36aff1&page=queryresults
[0m08:19:37.825858 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e604146d0>]}
[0m08:19:37.828540 [info ] [Thread-1 (]: 1 of 5 OK created sql table model analysis.stg_kraftwerksdaten ................. [[32mCREATE TABLE (5.0k rows, 190.4 KiB processed)[0m in 4.27s]
[0m08:19:37.830843 [debug] [Thread-1 (]: Finished running node model.gasag.stg_kraftwerksdaten
[0m08:19:37.833618 [debug] [Thread-3 (]: Began running node model.gasag.all_exceptions
[0m08:19:37.834844 [debug] [Thread-4 (]: Began running node model.gasag.kraftwerke_metrics
[0m08:19:37.836225 [info ] [Thread-3 (]: 2 of 5 START sql table model analysis.all_exceptions ........................... [RUN]
[0m08:19:37.837417 [debug] [Thread-2 (]: Began running node model.gasag.power_forecasts
[0m08:19:37.838456 [debug] [Thread-1 (]: Began running node model.gasag.today_power_data
[0m08:19:37.840128 [info ] [Thread-4 (]: 3 of 5 START sql table model analysis.kraftwerke_metrics ....................... [RUN]
[0m08:19:37.842450 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.gasag.all_exceptions'
[0m08:19:37.844531 [info ] [Thread-2 (]: 4 of 5 START sql table model analysis.power_forecasts .......................... [RUN]
[0m08:19:37.846636 [info ] [Thread-1 (]: 5 of 5 START sql table model analysis.today_power_data ......................... [RUN]
[0m08:19:37.848763 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.gasag.kraftwerke_metrics'
[0m08:19:37.849821 [debug] [Thread-3 (]: Began compiling node model.gasag.all_exceptions
[0m08:19:37.851409 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.gasag.power_forecasts'
[0m08:19:37.852446 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.gasag.stg_kraftwerksdaten, now model.gasag.today_power_data)
[0m08:19:37.853536 [debug] [Thread-4 (]: Began compiling node model.gasag.kraftwerke_metrics
[0m08:19:37.861252 [debug] [Thread-3 (]: Writing injected SQL for node "model.gasag.all_exceptions"
[0m08:19:37.862685 [debug] [Thread-2 (]: Began compiling node model.gasag.power_forecasts
[0m08:19:37.863764 [debug] [Thread-1 (]: Began compiling node model.gasag.today_power_data
[0m08:19:37.871350 [debug] [Thread-4 (]: Writing injected SQL for node "model.gasag.kraftwerke_metrics"
[0m08:19:37.880848 [debug] [Thread-2 (]: Writing injected SQL for node "model.gasag.power_forecasts"
[0m08:19:37.887341 [debug] [Thread-3 (]: Began executing node model.gasag.all_exceptions
[0m08:19:37.889797 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.today_power_data"
[0m08:19:37.891723 [debug] [Thread-4 (]: Began executing node model.gasag.kraftwerke_metrics
[0m08:19:37.892807 [debug] [Thread-2 (]: Began executing node model.gasag.power_forecasts
[0m08:19:37.898702 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m08:19:37.904110 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m08:19:37.905144 [debug] [Thread-1 (]: Began executing node model.gasag.today_power_data
[0m08:19:37.914626 [debug] [Thread-2 (]: Writing runtime sql for node "model.gasag.power_forecasts"
[0m08:19:37.926759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:19:37.930394 [debug] [Thread-2 (]: On model.gasag.power_forecasts: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.power_forecasts"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`power_forecasts`
      
    
    

    OPTIONS()
    as (
      -- Generate simple predictions using historical hourly averages
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Calculate historical hourly averages for each power plant
hourly_averages AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung,
        COUNT(*) as sample_count
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Generate missing hours for the last day
missing_hours AS (
    SELECT
        ha.Kraftwerk,
        TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS forecast_timestamp,
        ha.hour_of_day,
        ha.avg_hourly_leistung AS prognose
    FROM hourly_averages ha
    WHERE NOT EXISTS (
        SELECT 1 FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten` existing
        WHERE existing.Kraftwerk = ha.Kraftwerk
        AND CAST(existing.Timestamp AS TIMESTAMP) = CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS TIMESTAMP)
    )
)

SELECT
    Kraftwerk,
    forecast_timestamp AS Timestamp,
    hour_of_day,
    prognose,
    TRUE AS is_forecast
FROM missing_hours
ORDER BY Kraftwerk, forecast_timestamp
    );
  
[0m08:19:37.931819 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m08:19:38.552437 [debug] [Thread-4 (]: Writing runtime sql for node "model.gasag.kraftwerke_metrics"
[0m08:19:38.566070 [debug] [Thread-3 (]: Writing runtime sql for node "model.gasag.all_exceptions"
[0m08:19:38.564964 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.today_power_data"
[0m08:19:38.572222 [debug] [Thread-4 (]: On model.gasag.kraftwerke_metrics: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.kraftwerke_metrics"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`kraftwerke_metrics`
      
    
    

    OPTIONS()
    as (
      WITH staging_data AS (
    SELECT * FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Daily aggregations first
daily_metrics AS (
    SELECT
        Kraftwerk,
        DATE(Timestamp) as date,
        -- Daily total load (sum of all Leistung for the day)
        SUM(leistung) AS daily_total_load,
        -- Daily average load (average of all Leistung for the day)
        AVG(leistung) AS daily_avg_load,
        -- Count of peak loads for the day
        COUNT(CASE WHEN is_peak_load THEN 1 END) AS daily_peak_loads,
        -- Count of decreasing meter readings for the day
        COUNT(CASE WHEN is_decreasing_zaehlerstand THEN 1 END) AS daily_decreasing_readings,
        -- Total hours with data for the day
        COUNT(*) AS daily_total_hours
    FROM staging_data
    WHERE NOT is_last_day
    GROUP BY Kraftwerk, DATE(Timestamp)
),

-- Historical metrics (averages across all days)
historical_metrics AS (
    SELECT
        s.Kraftwerk,
        -- Durchschnittliche Grundlast (average base load per hour, excluding NULLs)
        AVG(CASE WHEN NOT s.is_peak_load THEN s.leistung END) AS durchschnittliche_grundlast,

        -- Durchschnittliche Spitzenlast (average peak load per hour, excluding NULLs)
        AVG(CASE WHEN s.is_peak_load THEN s.leistung END) AS durchschnittliche_spitzenlast,

        -- Durchschnittliche Gesamtlast pro Tag (average daily total load)
        AVG(d.daily_total_load) AS durchschnittliche_gesamtlast_pro_tag,

        -- Quote an Spitzenlasten (percentage of peak loads across all days)
        SUM(d.daily_peak_loads) * 100.0 / SUM(d.daily_total_hours) AS quote_spitzenlasten_prozent,

        -- Quote an Rückläufigen Zählerständen (percentage of decreasing meter readings across all days)
        SUM(d.daily_decreasing_readings) * 100.0 / SUM(d.daily_total_hours) AS quote_ruecklaeufige_zaehlerstaende_prozent

    FROM staging_data s
    LEFT JOIN daily_metrics d ON s.Kraftwerk = d.Kraftwerk AND DATE(s.Timestamp) = d.date
    WHERE NOT s.is_last_day
    GROUP BY s.Kraftwerk
),

-- Last day metrics
last_day_metrics AS (
    SELECT
        Kraftwerk,
        -- Sum of Leistung for the last day (excluding NULLs)
        SUM(leistung) AS last_day_leistung_sum,
        -- Count of hours with valid data for the last day
        COUNT(CASE WHEN leistung IS NOT NULL THEN 1 END) AS last_day_hours_with_data,
        -- Average Leistung for the last day (excluding NULLs)
        AVG(leistung) AS last_day_durchschnitt_leistung
    FROM staging_data
    WHERE is_last_day
    GROUP BY Kraftwerk
),

-- Expected vs actual comparison for last day
last_day_deviation AS (
    SELECT
        h.Kraftwerk,
        h.durchschnittliche_gesamtlast_pro_tag,
        l.last_day_leistung_sum,
        l.last_day_hours_with_data,
        l.last_day_durchschnitt_leistung,
        -- Expected Leistung (summierte Leistung * 24 / überlieferte Stunden)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN (l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data
            ELSE NULL
        END AS erwartete_leistung,
        -- Tagesabweichung (Expected - Actual average)
        CASE
            WHEN l.last_day_hours_with_data > 0
            THEN ((l.last_day_leistung_sum * 24.0) / l.last_day_hours_with_data) - h.durchschnittliche_gesamtlast_pro_tag
            ELSE NULL
        END AS tagesabweichung
    FROM historical_metrics h
    LEFT JOIN last_day_metrics l ON h.Kraftwerk = l.Kraftwerk
)

SELECT
    h.Kraftwerk,
    h.durchschnittliche_grundlast,
    h.durchschnittliche_spitzenlast,
    h.durchschnittliche_gesamtlast_pro_tag,
    h.quote_spitzenlasten_prozent,
    h.quote_ruecklaeufige_zaehlerstaende_prozent,
    l.erwartete_leistung,
    l.tagesabweichung
FROM historical_metrics h
LEFT JOIN last_day_deviation l ON h.Kraftwerk = l.Kraftwerk
    );
  
[0m08:19:38.583663 [debug] [Thread-3 (]: On model.gasag.all_exceptions: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.all_exceptions"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`all_exceptions`
      
    
    

    OPTIONS()
    as (
      WITH raw_data AS (
    SELECT
        Kraftwerk,
        -- Parse German date format and convert to TIMESTAMP
        PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp) as Timestamp,
        Zaehlerstand,
        -- Calculate raw Leistung (including negative values)
        Zaehlerstand - LAG(Zaehlerstand) OVER (PARTITION BY Kraftwerk ORDER BY PARSE_TIMESTAMP('%d.%m.%Y %H:%M', Timestamp)) AS raw_leistung
    FROM `gasag-465208`.`raw`.`kraftwerksdaten_raw`
),

staging_data AS (
    SELECT
        Kraftwerk,
        Timestamp,
        leistung,
        is_peak_load
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

all_exceptions AS (
    -- Peak loads from cleaned staging data
    SELECT
        s.Kraftwerk,
        s.Timestamp,
        s.leistung,
        TRUE AS is_peak_load,
        FALSE AS is_negative_leistung
    FROM staging_data s
    WHERE s.is_peak_load = TRUE AND s.leistung IS NOT NULL

    UNION ALL

    -- Negative spikes from raw data
    SELECT
        r.Kraftwerk,
        r.Timestamp,
        r.raw_leistung AS leistung,
        FALSE AS is_peak_load,
        TRUE AS is_negative_leistung
    FROM raw_data r
    WHERE r.raw_leistung < 0 AND r.raw_leistung IS NOT NULL
)

SELECT
    Kraftwerk,
    Timestamp,
    EXTRACT(HOUR FROM Timestamp) AS hour_of_day,
    EXTRACT(DATE FROM Timestamp) AS date,
    is_peak_load,
    is_negative_leistung,
    leistung
FROM all_exceptions
ORDER BY Timestamp DESC, Kraftwerk
    );
  
[0m08:19:38.587034 [debug] [Thread-1 (]: On model.gasag.today_power_data: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.today_power_data"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`today_power_data`
      
    
    

    OPTIONS()
    as (
      -- Combined table with actual and predicted data for today
WITH last_day_info AS (
    SELECT
        MAX(DATE(Timestamp)) as last_date,
        MAX(Timestamp) as last_timestamp
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Get the last actual measurement time for each power plant
last_measurements AS (
    SELECT
        Kraftwerk,
        MAX(Timestamp) as last_actual_time
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk
),

-- Calculate historical hourly averages for predictions
hourly_averages AS (
    SELECT
        Kraftwerk,
        hour_of_day,
        AVG(leistung) as avg_hourly_leistung
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE leistung IS NOT NULL
    GROUP BY Kraftwerk, hour_of_day
),

-- Get actual data for the last day
actual_data AS (
    SELECT
        Kraftwerk,
        CAST(Timestamp AS TIMESTAMP) as Timestamp,
        hour_of_day,
        leistung as Leistung,
        NULL as Prognose
    FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
    WHERE DATE(Timestamp) = (SELECT last_date FROM last_day_info)
      AND leistung IS NOT NULL
),

-- Generate predictions only for hours AFTER the last actual measurement
predicted_data AS (
    SELECT
        ha.Kraftwerk,
        CAST(TIMESTAMP_ADD(
            TIMESTAMP_TRUNC((SELECT last_date FROM last_day_info), DAY),
            INTERVAL ha.hour_of_day HOUR
        ) AS TIMESTAMP) AS Timestamp,
        ha.hour_of_day,
        NULL as Leistung,
        ha.avg_hourly_leistung AS Prognose
    FROM hourly_averages ha
    JOIN last_measurements lm ON ha.Kraftwerk = lm.Kraftwerk
    WHERE ha.hour_of_day > EXTRACT(HOUR FROM lm.last_actual_time)
      AND NOT EXISTS (
        SELECT 1 FROM actual_data existing
        WHERE existing.Kraftwerk = ha.Kraftwerk
        AND existing.hour_of_day = ha.hour_of_day
    )
)

-- Combine actual and predicted data
SELECT
    Kraftwerk,
    Timestamp,
    hour_of_day,
    Leistung,
    Prognose,
    -- Add some useful metadata
    (SELECT last_date FROM last_day_info) as forecast_date
FROM (
    SELECT * FROM actual_data
    UNION ALL
    SELECT * FROM predicted_data
)
ORDER BY Kraftwerk, Timestamp
    );
  
[0m08:19:38.701415 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:db682f28-81b6-43d1-aa2f-31c298bfc5b5&page=queryresults
[0m08:19:39.064080 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:ae6fcb39-5ca6-45a1-97e8-d1397b602ba1&page=queryresults
[0m08:19:39.119558 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:3646a9dd-4c51-454e-a9f6-7438f7f4aba3&page=queryresults
[0m08:19:39.232785 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:72489857-0dff-4944-b40b-24b61bfbd389&page=queryresults
[0m08:19:41.368670 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e54332470>]}
[0m08:19:41.373348 [info ] [Thread-2 (]: 4 of 5 OK created sql table model analysis.power_forecasts ..................... [[32mCREATE TABLE (40.0 rows, 180.1 KiB processed)[0m in 3.52s]
[0m08:19:41.378985 [debug] [Thread-2 (]: Finished running node model.gasag.power_forecasts
[0m08:19:41.520575 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e5442d3c0>]}
[0m08:19:41.525480 [info ] [Thread-3 (]: 2 of 5 OK created sql table model analysis.all_exceptions ...................... [[32mCREATE TABLE (153.0 rows, 336.3 KiB processed)[0m in 3.68s]
[0m08:19:41.529411 [debug] [Thread-3 (]: Finished running node model.gasag.all_exceptions
[0m08:19:41.831414 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e57571cf0>]}
[0m08:19:41.835758 [info ] [Thread-1 (]: 5 of 5 OK created sql table model analysis.today_power_data .................... [[32mCREATE TABLE (119.0 rows, 180.1 KiB processed)[0m in 3.98s]
[0m08:19:41.840914 [debug] [Thread-1 (]: Finished running node model.gasag.today_power_data
[0m08:19:42.853575 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f54e18e5-3f82-41a5-b6d1-de6791d14a94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e54315ba0>]}
[0m08:19:42.859445 [info ] [Thread-4 (]: 3 of 5 OK created sql table model analysis.kraftwerke_metrics .................. [[32mCREATE TABLE (5.0 rows, 155.7 KiB processed)[0m in 5.00s]
[0m08:19:42.864326 [debug] [Thread-4 (]: Finished running node model.gasag.kraftwerke_metrics
[0m08:19:42.870249 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:19:42.874557 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:19:42.877109 [debug] [MainThread]: Connection 'model.gasag.today_power_data' was properly closed.
[0m08:19:42.880187 [debug] [MainThread]: Connection 'model.gasag.all_exceptions' was properly closed.
[0m08:19:42.883433 [debug] [MainThread]: Connection 'model.gasag.kraftwerke_metrics' was properly closed.
[0m08:19:42.886090 [debug] [MainThread]: Connection 'model.gasag.power_forecasts' was properly closed.
[0m08:19:42.889403 [info ] [MainThread]: 
[0m08:19:42.892751 [info ] [MainThread]: Finished running 5 table models in 0 hours 0 minutes and 11.74 seconds (11.74s).
[0m08:19:42.901609 [debug] [MainThread]: Command end result
[0m08:19:42.990056 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m08:19:42.993169 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m08:19:43.003196 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m08:19:43.004000 [info ] [MainThread]: 
[0m08:19:43.005385 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:19:43.006141 [info ] [MainThread]: 
[0m08:19:43.006911 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=5
[0m08:19:43.014287 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 16.144892, "process_in_blocks": "0", "process_kernel_time": 0.532822, "process_mem_max_rss": "372816", "process_out_blocks": "2272", "process_user_time": 8.538138}
[0m08:19:43.016004 [debug] [MainThread]: Command `dbt run` succeeded at 08:19:43.015532 after 16.15 seconds
[0m08:19:43.017001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e8238bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e57120640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x710e57761ed0>]}
[0m08:19:43.017755 [debug] [MainThread]: Flushing usage events
[0m08:19:44.072832 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:29:59.613720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dc04b4bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dc0399d630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dc0399d5d0>]}


============================== 08:29:59.617289 | 74f74658-e24b-4a74-be30-c208a91342d0 ==============================
[0m08:29:59.617289 [info ] [MainThread]: Running with dbt=1.10.3
[0m08:29:59.618096 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select kraftwerke_metrics', 'send_anonymous_usage_stats': 'True'}
[0m08:30:02.885987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '74f74658-e24b-4a74-be30-c208a91342d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dc06683700>]}
[0m08:30:03.043245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '74f74658-e24b-4a74-be30-c208a91342d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dc0399f1c0>]}
[0m08:30:03.044569 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m08:30:03.347364 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m08:30:03.548768 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m08:30:03.549716 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/kraftwerke_metrics.sql
[0m08:30:04.094659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '74f74658-e24b-4a74-be30-c208a91342d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd98f1e40>]}
[0m08:30:04.226934 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m08:30:04.229389 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m08:30:04.246889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '74f74658-e24b-4a74-be30-c208a91342d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd9bd48b0>]}
[0m08:30:04.247818 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m08:30:04.248469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '74f74658-e24b-4a74-be30-c208a91342d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd9bd5e70>]}
[0m08:30:04.250460 [info ] [MainThread]: 
[0m08:30:04.251089 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:30:04.251668 [info ] [MainThread]: 
[0m08:30:04.252454 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:30:04.253798 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m08:30:04.255359 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:30:06.366585 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m08:30:06.367679 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:30:06.895935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '74f74658-e24b-4a74-be30-c208a91342d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dc03b5a7d0>]}
[0m08:30:06.897704 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:30:06.902945 [debug] [Thread-1 (]: Began running node model.gasag.kraftwerke_metrics
[0m08:30:06.904611 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.kraftwerke_metrics ....................... [RUN]
[0m08:30:06.905999 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.kraftwerke_metrics)
[0m08:30:06.907099 [debug] [Thread-1 (]: Began compiling node model.gasag.kraftwerke_metrics
[0m08:30:06.925455 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.kraftwerke_metrics"
[0m08:30:06.927165 [debug] [Thread-1 (]: Began executing node model.gasag.kraftwerke_metrics
[0m08:30:06.952586 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:30:07.598231 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.kraftwerke_metrics"
[0m08:30:07.599623 [debug] [Thread-1 (]: On model.gasag.kraftwerke_metrics: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.kraftwerke_metrics"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`kraftwerke_metrics`
      
    
    

    OPTIONS()
    as (
      WITH staging_data AS (
    SELECT * FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Daily aggregations first
daily_metrics AS (
    SELECT
        Kraftwerk,
        DATE(Timestamp) as date,
        -- Daily total load (sum of all Leistung for the day)
        SUM(leistung) AS daily_total_load,
        -- Daily average load (average of all Leistung for the day)
        AVG(leistung) AS daily_avg_load,
        -- Count of peak loads for the day
        COUNT(CASE WHEN is_peak_load THEN 1 END) AS daily_peak_loads,
        -- Count of decreasing meter readings for the day
        COUNT(CASE WHEN is_decreasing_zaehlerstand THEN 1 END) AS daily_decreasing_readings,
        -- Total hours with data for the day
        COUNT(*) AS daily_total_hours
    FROM staging_data
    WHERE NOT is_last_day
    GROUP BY Kraftwerk, DATE(Timestamp)
),

-- Historical metrics (averages across all days)
historical_metrics AS (
    SELECT
        s.Kraftwerk,
        -- Durchschnittliche Grundlast (average base load per hour, excluding NULLs)
        AVG(CASE WHEN NOT s.is_peak_load THEN s.leistung END) AS durchschnittliche_grundlast,

        -- Durchschnittliche Spitzenlast (average peak load per hour, excluding NULLs)
        AVG(CASE WHEN s.is_peak_load THEN s.leistung END) AS durchschnittliche_spitzenlast,

        -- Quote an Spitzenlasten (percentage of peak loads across all days)
        SUM(d.daily_peak_loads) * 100.0 / SUM(d.daily_total_hours) AS quote_spitzenlasten_prozent,

        -- Quote an Rückläufigen Zählerständen (percentage of decreasing meter readings across all days)
        SUM(d.daily_decreasing_readings) * 100.0 / SUM(d.daily_total_hours) AS quote_ruecklaeufige_zaehlerstaende_prozent

    FROM staging_data s
    LEFT JOIN daily_metrics d ON s.Kraftwerk = d.Kraftwerk AND DATE(s.Timestamp) = d.date
    WHERE NOT s.is_last_day
    GROUP BY s.Kraftwerk
),

-- Expected performance from today_power_data (sum of actual + predicted)
today_expected AS (
    SELECT
        Kraftwerk,
        -- Sum all values (Leistung + Prognose) for the day
        SUM(COALESCE(Leistung, 0) + COALESCE(Prognose, 0)) AS erwartete_leistung
    FROM `gasag-465208`.`analysis`.`today_power_data`
    GROUP BY Kraftwerk
)

SELECT
    h.Kraftwerk,
    h.durchschnittliche_grundlast,
    h.durchschnittliche_spitzenlast,
    h.quote_spitzenlasten_prozent,
    h.quote_ruecklaeufige_zaehlerstaende_prozent,
    t.erwartete_leistung
FROM historical_metrics h
LEFT JOIN today_expected t ON h.Kraftwerk = t.Kraftwerk
    );
  
[0m08:30:08.625674 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:dc9ef05b-a6ae-48e8-8b1b-9ecd8d519a9c&page=queryresults
[0m08:30:11.726219 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '74f74658-e24b-4a74-be30-c208a91342d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbdedd4520>]}
[0m08:30:11.727486 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.kraftwerke_metrics .................. [[32mCREATE TABLE (5.0 rows, 158.1 KiB processed)[0m in 4.82s]
[0m08:30:11.728644 [debug] [Thread-1 (]: Finished running node model.gasag.kraftwerke_metrics
[0m08:30:11.730532 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:30:11.731872 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:30:11.732498 [debug] [MainThread]: Connection 'model.gasag.kraftwerke_metrics' was properly closed.
[0m08:30:11.733115 [info ] [MainThread]: 
[0m08:30:11.733775 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 7.48 seconds (7.48s).
[0m08:30:11.734933 [debug] [MainThread]: Command end result
[0m08:30:11.780644 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m08:30:11.782972 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m08:30:11.796146 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m08:30:11.797029 [info ] [MainThread]: 
[0m08:30:11.797929 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:30:11.798691 [info ] [MainThread]: 
[0m08:30:11.799411 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m08:30:11.800818 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.315571, "process_in_blocks": "0", "process_kernel_time": 0.492544, "process_mem_max_rss": "372100", "process_out_blocks": "3136", "process_user_time": 7.891684}
[0m08:30:11.801915 [debug] [MainThread]: Command `dbt run` succeeded at 08:30:11.801689 after 12.32 seconds
[0m08:30:11.803616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dc04b4bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd9949210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76dbd9fb95a0>]}
[0m08:30:11.804989 [debug] [MainThread]: Flushing usage events
[0m08:30:12.626669 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m08:35:38.962304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77004694bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77004579aec0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77004579af20>]}


============================== 08:35:38.968778 | 791a706e-fe1a-4d48-95c0-c481f8c6d2b2 ==============================
[0m08:35:38.968778 [info ] [MainThread]: Running with dbt=1.10.3
[0m08:35:38.969851 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/home/anton/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/home/anton/code/gasag/dbt_gasag/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select kraftwerke_metrics', 'send_anonymous_usage_stats': 'True'}
[0m08:35:42.667526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '791a706e-fe1a-4d48-95c0-c481f8c6d2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77001bddac50>]}
[0m08:35:42.849095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '791a706e-fe1a-4d48-95c0-c481f8c6d2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7700459b55d0>]}
[0m08:35:42.850323 [info ] [MainThread]: Registered adapter: bigquery=1.9.2
[0m08:35:43.204462 [debug] [MainThread]: checksum: 1bfacb87e6914c9942cfa2c4badfc1df19d859fe8ec086286ef238a7d920f97b, vars: {}, profile: , target: , version: 1.10.3
[0m08:35:43.422222 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m08:35:43.423436 [debug] [MainThread]: Partial parsing: updated file: gasag://models/marts/kraftwerke_metrics.sql
[0m08:35:44.036894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '791a706e-fe1a-4d48-95c0-c481f8c6d2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77001b6ede70>]}
[0m08:35:44.200329 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m08:35:44.203739 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m08:35:44.222816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '791a706e-fe1a-4d48-95c0-c481f8c6d2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77001b9dec80>]}
[0m08:35:44.223832 [info ] [MainThread]: Found 5 models, 1 source, 493 macros
[0m08:35:44.225524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '791a706e-fe1a-4d48-95c0-c481f8c6d2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77001b9df190>]}
[0m08:35:44.228089 [info ] [MainThread]: 
[0m08:35:44.230086 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m08:35:44.231256 [info ] [MainThread]: 
[0m08:35:44.232379 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m08:35:44.234004 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_gasag-465208'
[0m08:35:44.234907 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:35:46.259216 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_gasag-465208, now list_gasag-465208_analysis)
[0m08:35:46.260732 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:35:46.817623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '791a706e-fe1a-4d48-95c0-c481f8c6d2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77004595a800>]}
[0m08:35:46.819083 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:35:46.825397 [debug] [Thread-1 (]: Began running node model.gasag.kraftwerke_metrics
[0m08:35:46.827147 [info ] [Thread-1 (]: 1 of 1 START sql table model analysis.kraftwerke_metrics ....................... [RUN]
[0m08:35:46.830126 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_gasag-465208_analysis, now model.gasag.kraftwerke_metrics)
[0m08:35:46.831738 [debug] [Thread-1 (]: Began compiling node model.gasag.kraftwerke_metrics
[0m08:35:46.852906 [debug] [Thread-1 (]: Writing injected SQL for node "model.gasag.kraftwerke_metrics"
[0m08:35:46.854620 [debug] [Thread-1 (]: Began executing node model.gasag.kraftwerke_metrics
[0m08:35:46.888902 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:35:47.489622 [debug] [Thread-1 (]: Writing runtime sql for node "model.gasag.kraftwerke_metrics"
[0m08:35:47.492387 [debug] [Thread-1 (]: On model.gasag.kraftwerke_metrics: /* {"app": "dbt", "dbt_version": "1.10.3", "profile_name": "gasag", "target_name": "dev", "node_id": "model.gasag.kraftwerke_metrics"} */

  
    

    create or replace table `gasag-465208`.`analysis`.`kraftwerke_metrics`
      
    
    

    OPTIONS()
    as (
      WITH staging_data AS (
    SELECT * FROM `gasag-465208`.`analysis`.`stg_kraftwerksdaten`
),

-- Daily aggregations first
daily_metrics AS (
    SELECT
        Kraftwerk,
        DATE(Timestamp) as date,
        -- Daily total load (sum of all Leistung for the day)
        SUM(leistung) AS daily_total_load,
        -- Daily average load (average of all Leistung for the day)
        AVG(leistung) AS daily_avg_load,
        -- Count of peak loads for the day
        COUNT(CASE WHEN is_peak_load THEN 1 END) AS daily_peak_loads,
        -- Count of decreasing meter readings for the day
        COUNT(CASE WHEN is_decreasing_zaehlerstand THEN 1 END) AS daily_decreasing_readings,
        -- Total hours with data for the day
        COUNT(*) AS daily_total_hours
    FROM staging_data
    WHERE NOT is_last_day
    GROUP BY Kraftwerk, DATE(Timestamp)
),

-- Historical metrics (averages across all days)
historical_metrics AS (
    SELECT
        s.Kraftwerk,
        -- Durchschnittliche Grundlast (average base load per hour, excluding NULLs)
        AVG(CASE WHEN NOT s.is_peak_load THEN s.leistung END) AS durchschnittliche_grundlast,

        -- Durchschnittliche Spitzenlast (average peak load per hour, excluding NULLs)
        AVG(CASE WHEN s.is_peak_load THEN s.leistung END) AS durchschnittliche_spitzenlast,

        -- Durchschnittliche Gesamtlast pro Tag (average daily total load)
        AVG(d.daily_total_load) AS durchschnittliche_gesamtlast_pro_tag,

        -- Quote an Spitzenlasten (percentage of peak loads across all days)
        SUM(d.daily_peak_loads) * 100.0 / SUM(d.daily_total_hours) AS quote_spitzenlasten_prozent,

        -- Quote an Rückläufigen Zählerständen (percentage of decreasing meter readings across all days)
        SUM(d.daily_decreasing_readings) * 100.0 / SUM(d.daily_total_hours) AS quote_ruecklaeufige_zaehlerstaende_prozent

    FROM staging_data s
    LEFT JOIN daily_metrics d ON s.Kraftwerk = d.Kraftwerk AND DATE(s.Timestamp) = d.date
    WHERE NOT s.is_last_day
    GROUP BY s.Kraftwerk
),

-- Expected performance from today_power_data (sum of actual + predicted)
today_expected AS (
    SELECT
        Kraftwerk,
        -- Sum all values (Leistung + Prognose) for the day
        SUM(COALESCE(Leistung, 0) + COALESCE(Prognose, 0)) AS erwartete_leistung
    FROM `gasag-465208`.`analysis`.`today_power_data`
    GROUP BY Kraftwerk
)

SELECT
    h.Kraftwerk,
    h.durchschnittliche_grundlast,
    h.durchschnittliche_spitzenlast,
    h.durchschnittliche_gesamtlast_pro_tag,
    h.quote_spitzenlasten_prozent,
    h.quote_ruecklaeufige_zaehlerstaende_prozent,
    t.erwartete_leistung
FROM historical_metrics h
LEFT JOIN today_expected t ON h.Kraftwerk = t.Kraftwerk
    );
  
[0m08:35:48.158745 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=gasag-465208&j=bq:US:3bcb3ba1-f33c-4e5b-8166-8e5b209df294&page=queryresults
[0m08:35:51.021032 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '791a706e-fe1a-4d48-95c0-c481f8c6d2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770024bed630>]}
[0m08:35:51.022378 [info ] [Thread-1 (]: 1 of 1 OK created sql table model analysis.kraftwerke_metrics .................. [[32mCREATE TABLE (5.0 rows, 158.1 KiB processed)[0m in 4.19s]
[0m08:35:51.025046 [debug] [Thread-1 (]: Finished running node model.gasag.kraftwerke_metrics
[0m08:35:51.028074 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m08:35:51.029566 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:35:51.030307 [debug] [MainThread]: Connection 'model.gasag.kraftwerke_metrics' was properly closed.
[0m08:35:51.031369 [info ] [MainThread]: 
[0m08:35:51.032092 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 6.80 seconds (6.80s).
[0m08:35:51.033326 [debug] [MainThread]: Command end result
[0m08:35:51.077391 [debug] [MainThread]: Wrote artifact WritableManifest to /home/anton/code/gasag/dbt_gasag/target/manifest.json
[0m08:35:51.081013 [debug] [MainThread]: Wrote artifact SemanticManifest to /home/anton/code/gasag/dbt_gasag/target/semantic_manifest.json
[0m08:35:51.092505 [debug] [MainThread]: Wrote artifact RunExecutionResult to /home/anton/code/gasag/dbt_gasag/target/run_results.json
[0m08:35:51.093419 [info ] [MainThread]: 
[0m08:35:51.095082 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:35:51.095979 [info ] [MainThread]: 
[0m08:35:51.096871 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=1
[0m08:35:51.099199 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.283061, "process_in_blocks": "0", "process_kernel_time": 0.552105, "process_mem_max_rss": "372328", "process_out_blocks": "3136", "process_user_time": 8.689918}
[0m08:35:51.100965 [debug] [MainThread]: Command `dbt run` succeeded at 08:35:51.100705 after 12.29 seconds
[0m08:35:51.101795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77004694bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77001b6b1690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77001bddb1c0>]}
[0m08:35:51.103077 [debug] [MainThread]: Flushing usage events
[0m08:35:52.073490 [debug] [MainThread]: An error was encountered while trying to flush usage events
